// config/verifier_bots.php
<?php
return [
    'bots' => [
        'cliiip_caption' => [
            'token' => 'TOKEN_BOT_VERIFIER_1',
            'username' => 'VerifierBot1',
            'channels' => ['cliiip_caption', 'LOVEMOVE11']
        ],
        'backup' => [
            'token' => 'TOKEN_BOT_VERIFIER_2', 
            'username' => 'VerifierBot2',
            'channels' => ['cliiip_caption', 'LOVEMOVE11']
        ]
    ]
];
?>// Ø§Ø¯Ù…ÛŒÙ† Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ú©Ø§Ù†Ø§Ù„ Ø¬Ø¯ÛŒØ¯ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†Ø¯
elseif ($text == "ğŸ“¢ Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ù†Ø§Ù„ Ø¬Ø¯ÛŒØ¯") {
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "ğŸ“¢ Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ù†Ø§Ù„ Ø¬Ø¯ÛŒØ¯\n\nÙ„Ø·ÙØ§Ù‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø±Ø§ Ø¨Ù‡ ÙØ±Ù…Øª Ø²ÛŒØ± Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯:\n\nÚ©Ø§Ù†Ø§Ù„|ØªÙˆÚ©Ù† Ø±Ø¨Ø§Øª ÙˆØ§Ø³Ø·\n\nğŸ“ Ù…Ø«Ø§Ù„:\nmy_channel|123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11",
        'reply_to_message_id' => $message_id,
        'reply_markup' => $back
    ]);
    $MySQLi->query("UPDATE `user` SET `step` = 'add_new_channel' WHERE `id` = '{$from_id}' LIMIT 1");
}// Ø§Ø¯Ù…ÛŒÙ† Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ú©Ø§Ù†Ø§Ù„ Ø­Ø°Ù Ú©Ù†Ø¯
elseif ($text == "ğŸ—‘ Ø­Ø°Ù Ú©Ø§Ù†Ø§Ù„") {
    $channels = mysqli_query($MySQLi,
        "SELECT * FROM `channel_verification` WHERE `is_active` = 1"
    );
    
    if (mysqli_num_rows($channels) > 0) {
        $keyboard = ['inline_keyboard' => []];
        
        while ($channel = mysqli_fetch_assoc($channels)) {
            $keyboard['inline_keyboard'][] = [
                [
                    'text' => "âŒ Ø­Ø°Ù @{$channel['channel_username']}",
                    'callback_data' => "delete_channel_{$channel['id']}"
                ]
            ];
        }
        
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "ğŸ—‘ Ø­Ø°Ù Ú©Ø§Ù†Ø§Ù„ Ø§Ø² Ù„ÛŒØ³Øª Ø¬ÙˆÛŒÙ† Ø§Ø¬Ø¨Ø§Ø±ÛŒ\n\nÙ„Ø·ÙØ§Ù‹ Ú©Ø§Ù†Ø§Ù„ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:",
            'reply_to_message_id' => $message_id,
            'reply_markup' => json_encode($keyboard)
        ]);
    }
}

// Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø­Ø°Ù Ú©Ø§Ù†Ø§Ù„
elseif (strpos($data, "delete_channel_") === 0) {
    $channel_id = str_replace("delete_channel_", "", $data);
    
    mysqli_query($MySQLi,
        "UPDATE `channel_verification` SET `is_active` = 0 WHERE `id` = '{$channel_id}'"
    );
    
    WSBot('editmessagetext', [
        'chat_id' => $chatid,
        'message_id' => $messageid,
        'text' => "âœ… Ú©Ø§Ù†Ø§Ù„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯!",
        'reply_markup' => json_encode(['inline_keyboard' => []])
    ]);
}// Ø§Ø¯Ù…ÛŒÙ† Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§ Ø±Ø§ ÙØ¹Ø§Ù„/ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ù†Ø¯
elseif ($text == "âš™ï¸ ÙØ¹Ø§Ù„/ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù†") {
    $channels = mysqli_query($MySQLi,
        "SELECT * FROM `channel_verification` ORDER BY `is_active` DESC"
    );
    
    $keyboard = ['inline_keyboard' => []];
    
    while ($channel = mysqli_fetch_assoc($channels)) {
        $status = $channel['is_active'] ? "âœ… ÙØ¹Ø§Ù„" : "âŒ ØºÛŒØ±ÙØ¹Ø§Ù„";
        $action = $channel['is_active'] ? "ØºÛŒØ±ÙØ¹Ø§Ù„" : "ÙØ¹Ø§Ù„";
        
        $keyboard['inline_keyboard'][] = [
            [
                'text' => "{$action} @{$channel['channel_username']} ({$status})",
                'callback_data' => "toggle_channel_{$channel['id']}"
            ]
        ];
    }
    
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "âš™ï¸ Ù…Ø¯ÛŒØ±ÛŒØª ÙˆØ¶Ø¹ÛŒØª Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§\n\nÚ©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ø¬ÙˆÛŒÙ† Ø§Ø¬Ø¨Ø§Ø±ÛŒ:",
        'reply_to_message_id' => $message_id,
        'reply_markup' => json_encode($keyboard)
    ]);
}// Ø§Ø¯Ù…ÛŒÙ† Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ù„ÛŒØ³Øª Ú©Ø§Ù…Ù„ Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø¨ÛŒÙ†Ø¯
elseif ($text == "ğŸ“‹ Ù„ÛŒØ³Øª Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§") {
    $channels = mysqli_query($MySQLi,
        "SELECT * FROM `channel_verification` ORDER BY `is_active` DESC, `created_at` DESC"
    );
    
    $message = "ğŸ“‹ Ù„ÛŒØ³Øª Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ø¬ÙˆÛŒÙ† Ø§Ø¬Ø¨Ø§Ø±ÛŒ:\n\n";
    
    while ($channel = mysqli_fetch_assoc($channels)) {
        $status = $channel['is_active'] ? "âœ… ÙØ¹Ø§Ù„" : "âŒ ØºÛŒØ±ÙØ¹Ø§Ù„";
        $message .= "{$status} @{$channel['channel_username']}\n";
        $message .= "   ğŸ“… Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡ Ø¯Ø±: {$channel['created_at']}\n";
        $message .= "   â–â–â–â–â–â–â–\n";
    }
    
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => $message,
        'reply_to_message_id' => $message_id
    ]);
}// Ø§Ø¯Ù…ÛŒÙ† Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ ÙˆØ¶Ø¹ÛŒØª Ø¹Ø¶ÙˆÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø±Ø§ ØªØ³Øª Ú©Ù†Ø¯
elseif ($text == "ğŸ”„ ØªØ³Øª Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¶ÙˆÛŒØª") {
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "ğŸ”„ ØªØ³Øª Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¶ÙˆÛŒØª\n\nÙ„Ø·ÙØ§Ù‹ Ø¢ÛŒØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø± Ø±Ø§ Ø¨Ø±Ø§ÛŒ ØªØ³Øª Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯:",
        'reply_to_message_id' => $message_id,
        'reply_markup' => $back
    ]);
    $MySQLi->query("UPDATE `user` SET `step` = 'test_membership' WHERE `id` = '{$from_id}' LIMIT 1");
}$channel_management = json_encode(['keyboard' => [
    [['text' => "ğŸ“¢ Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ù†Ø§Ù„ Ø¬Ø¯ÛŒØ¯"], ['text' => "ğŸ—‘ Ø­Ø°Ù Ú©Ø§Ù†Ø§Ù„"]],
    [['text' => "ğŸ“‹ Ù„ÛŒØ³Øª Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§"], ['text' => "ğŸ”§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±Ø¨Ø§Øª ÙˆØ§Ø³Ø·"]],
    [['text' => "ğŸ”„ ØªØ³Øª Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¶ÙˆÛŒØª"], ['text' => "âš™ï¸ ÙØ¹Ø§Ù„/ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù†"]],
    [['text' => "ğŸ”™ Ø¨Ø±Ú¯Ø´Øª"]]
    ], 'resize_keyboard' => true
]);// Ø¯Ø± Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ Ø§Ø¯Ù…ÛŒÙ† Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡:
if (isAdmin($from_id)) {
    $menu = json_encode(['keyboard' => [
        [['text' => "ğŸ“‚ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø§Ù¾Ù„ÙˆØ¯"], ['text' =>"ğŸ« Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ"]],
        [['text' => "ğŸ“¦ Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡"], ['text' => "ğŸ“º Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø±ÛŒØ§Ù„â€ŒÙ‡Ø§"]],
        [['text' => "ğŸ–¼ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§ÙˆØ± ÙˆÛŒØ¯ÛŒÙˆÙ‡Ø§"], ['text' => "ğŸ“ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ØªÙˆÙ† Ø±Ø¨Ø§Øª"]],
        [['text' => "ğŸ“¢ Ù…Ø¯ÛŒØ±ÛŒØª Ø¬ÙˆÛŒÙ† Ø§Ø¬Ø¨Ø§Ø±ÛŒ"], ['text' => "ğŸ›  Ù…Ø¯ÛŒØ±ÛŒØª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§"]], // â† Ø§ÛŒÙ†Ø¬Ø§
        // ... Ø¨Ù‚ÛŒÙ‡ Ù…Ù†Ùˆ
    ]]);
}// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø¨Ø®Ø´ Ø§ÛŒØ¬Ø§Ø¯ Ø¬Ø¯Ø§ÙˆÙ„
if ($MySQLi->query("SELECT * FROM `backup_settings`") == false) {
    mysqli_query($MySQLi, "CREATE TABLE `backup_settings` (
        `id` int(11) NOT NULL AUTO_INCREMENT PRIMARY KEY,
        `backup_channel` varchar(100) DEFAULT NULL,
        `backup_bot_token` varchar(100) DEFAULT NULL,
        `is_enabled` tinyint(1) DEFAULT 0,
        `backup_file_data` tinyint(1) DEFAULT 1,
        `backup_metadata` tinyint(1) DEFAULT 1,
        `created_at` timestamp DEFAULT CURRENT_TIMESTAMP,
        `updated_at` timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
    )");
    
    // Ø§ÛŒØ¬Ø§Ø¯ Ø¬Ø¯ÙˆÙ„ Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø´Ø¯Ù‡
    mysqli_query($MySQLi, "CREATE TABLE `backup_logs` (
        `id` int(11) NOT NULL AUTO_INCREMENT PRIMARY KEY,
        `file_code` varchar(50) NOT NULL,
        `file_type` varchar(20) NOT NULL,
        `backup_message_id` bigint(20) NOT NULL,
        `backup_channel` varchar(100) NOT NULL,
        `backup_date` timestamp DEFAULT CURRENT_TIMESTAMP,
        `file_size` bigint(20) DEFAULT 0,
        `user_id` bigint(20) NOT NULL
    )");
}// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø¨Ø®Ø´ ØªÙˆØ§Ø¨Ø¹
function getBackupSettings() {
    global $MySQLi;
    
    $result = mysqli_fetch_assoc(mysqli_query($MySQLi,
        "SELECT * FROM `backup_settings` ORDER BY `id` DESC LIMIT 1"
    ));
    
    if (!$result) {
        // Ø§ÛŒØ¬Ø§Ø¯ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶
        mysqli_query($MySQLi,
            "INSERT INTO `backup_settings` (`is_enabled`) VALUES (0)"
        );
        $result = ['is_enabled' => 0];
    }
    
    return $result;
}

function updateBackupSettings($channel, $bot_token, $is_enabled, $backup_file_data = 1, $backup_metadata = 1) {
    global $MySQLi;
    
    $channel = mysqli_real_escape_string($MySQLi, $channel);
    $bot_token = mysqli_real_escape_string($MySQLi, $bot_token);
    
    return mysqli_query($MySQLi,
        "UPDATE `backup_settings` 
         SET `backup_channel` = '{$channel}', 
             `backup_bot_token` = '{$bot_token}',
             `is_enabled` = '{$is_enabled}',
             `backup_file_data` = '{$backup_file_data}',
             `backup_metadata` = '{$backup_metadata}',
             `updated_at` = CURRENT_TIMESTAMP"
    );
}

function sendToBackupChannel($file_type, $file_id, $caption, $file_code, $file_size, $user_id) {
    $settings = getBackupSettings();
    
    if (!$settings['is_enabled'] || !$settings['backup_channel'] || !$settings['backup_bot_token']) {
        return false;
    }
    
    $backup_caption = "ğŸ’¾ Ù¾Ø´ØªÛŒØ¨Ø§Ù† ÙØ§ÛŒÙ„\n\n";
    $backup_caption .= "ğŸ”‘ Ú©Ø¯ ÙØ§ÛŒÙ„: `{$file_code}`\n";
    $backup_caption .= "ğŸ“ Ù†ÙˆØ¹: " . doc($file_type) . "\n";
    $backup_caption .= "ğŸ’¾ Ø­Ø¬Ù…: " . convert($file_size) . "\n";
    $backup_caption .= "ğŸ‘¤ Ø¢Ù¾Ù„ÙˆØ¯Ú©Ù†Ù†Ø¯Ù‡: {$user_id}\n";
    $backup_caption .= "ğŸ“… ØªØ§Ø±ÛŒØ®: " . date('Y-m-d H:i:s') . "\n\n";
    $backup_caption .= "ğŸ“ ØªÙˆØ¶ÛŒØ­Ø§Øª:\n{$caption}\n\n";
    $backup_caption .= "#Ø¨Ú©Ø§Ù¾ #{$file_type} #{$file_code}";
    
    try {
        $method = 'send' . $file_type;
        $result = backupBotApi($method, [
            'chat_id' => $settings['backup_channel'],
            $file_type => $file_id,
            'caption' => $backup_caption,
            'parse_mode' => 'HTML'
        ], $settings['backup_bot_token']);
        
        if ($result && $result->ok) {
            // Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù†
            logBackup($file_code, $file_type, $result->result->message_id, $settings['backup_channel'], $file_size, $user_id);
            return $result->result->message_id;
        }
    } catch (Exception $e) {
        error_log("Backup failed: " . $e->getMessage());
    }
    
    return false;
}

function backupBotApi($method, $datas = [], $bot_token) {
    $url = 'https://api.telegram.org/bot'.$bot_token.'/'.$method;
    $ch = curl_init();
    curl_setopt_array($ch, [
        CURLOPT_URL => $url,
        CURLOPT_RETURNTRANSFER => true,
        CURLOPT_POSTFIELDS => $datas,
        CURLOPT_CUSTOMREQUEST => 'POST',
        CURLOPT_TIMEOUT => 30
    ]);
    $response = json_decode(curl_exec($ch));
    curl_close($ch);
    return $response;
}

function logBackup($file_code, $file_type, $message_id, $channel, $file_size, $user_id) {
    global $MySQLi;
    
    return mysqli_query($MySQLi,
        "INSERT INTO `backup_logs` 
         (`file_code`, `file_type`, `backup_message_id`, `backup_channel`, `file_size`, `user_id`)
         VALUES ('{$file_code}', '{$file_type}', '{$message_id}', '{$channel}', '{$file_size}', '{$user_id}')"
    );
}

function getBackupStats() {
    global $MySQLi;
    
    $stats = mysqli_fetch_assoc(mysqli_query($MySQLi,
        "SELECT COUNT(*) as total_files, 
                SUM(file_size) as total_size,
                COUNT(DISTINCT file_type) as file_types
         FROM `backup_logs`"
    ));
    
    return $stats ?: ['total_files' => 0, 'total_size' => 0, 'file_types' => 0];
}// Ù…Ù†ÙˆÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ
$backup_management = json_encode(['keyboard' => [
    [['text' => "âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ"], ['text' => "ğŸ“Š Ø¢Ù…Ø§Ø± Ù¾Ø´ØªÛŒØ¨Ø§Ù†"]],
    [['text' => "ğŸ”§ ØªØ³Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ"], ['text' => "ğŸ”„ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø¯Ø³ØªÛŒ"]],
    [['text' => "ğŸ“¤ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø² Ù¾Ø´ØªÛŒØ¨Ø§Ù†"], ['text' => "ğŸ—‘ Ù…Ø¯ÛŒØ±ÛŒØª Ù„Ø§Ú¯â€ŒÙ‡Ø§"]],
    [['text' => "ğŸ”™ Ø¨Ø±Ú¯Ø´Øª"]]
    ], 'resize_keyboard' => true
]);// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§Ø¯Ù…ÛŒÙ†
elseif ($text == "ğŸ’¾ Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ") {
    $settings = getBackupSettings();
    $stats = getBackupStats();
    
    $status_text = $settings['is_enabled'] ? "âœ… ÙØ¹Ø§Ù„" : "âŒ ØºÛŒØ±ÙØ¹Ø§Ù„";
    $channel_text = $settings['backup_channel'] ? "@" . $settings['backup_channel'] : "ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯Ù‡";
    
    $message = "ğŸ’¾ Ø³ÛŒØ³ØªÙ… Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø±\n\n";
    $message .= "ğŸ”§ ÙˆØ¶Ø¹ÛŒØª: {$status_text}\n";
    $message .= "ğŸ“¢ Ú©Ø§Ù†Ø§Ù„ Ù¾Ø´ØªÛŒØ¨Ø§Ù†: {$channel_text}\n\n";
    $message .= "ğŸ“Š Ø¢Ù…Ø§Ø± Ù¾Ø´ØªÛŒØ¨Ø§Ù†:\n";
    $message .= "ğŸ“ ØªØ¹Ø¯Ø§Ø¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§: " . number_format($stats['total_files']) . "\n";
    $message .= "ğŸ’¾ Ø­Ø¬Ù… Ú©Ù„: " . convert($stats['total_size']) . "\n";
    $message .= "ğŸ¬ Ø§Ù†ÙˆØ§Ø¹ ÙØ§ÛŒÙ„: {$stats['file_types']}\n\n";
    $message .= "Ø§Ø² Ù…Ù†ÙˆÛŒ Ø²ÛŒØ± Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯:";
    
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => $message,
        'reply_to_message_id' => $message_id,
        'reply_markup' => $backup_management
    ]);
    $MySQLi->query("UPDATE `user` SET `step` = 'backup_management' WHERE `id` = '{$from_id}' LIMIT 1");
}

// ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ
elseif ($text == "âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ") {
    $settings = getBackupSettings();
    
    $keyboard = json_encode(['inline_keyboard' => [
        [
            ['text' => ($settings['is_enabled'] ? "âŒ ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù†" : "âœ… ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù†"), 
             'callback_data' => "toggle_backup"]
        ],
        [
            ['text' => "ğŸ“¢ ØªÙ†Ø¸ÛŒÙ… Ú©Ø§Ù†Ø§Ù„ Ù¾Ø´ØªÛŒØ¨Ø§Ù†", 
             'callback_data' => "set_backup_channel"]
        ],
        [
            ['text' => "ğŸ¤– ØªÙ†Ø¸ÛŒÙ… ØªÙˆÚ©Ù† Ø±Ø¨Ø§Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù†", 
             'callback_data' => "set_backup_token"]
        ],
        [
            ['text' => "âš¡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ´Ø±ÙØªÙ‡", 
             'callback_data' => "advanced_backup_settings"]
        ]
    ]]);
    
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ\n\nÙ„Ø·ÙØ§Ù‹ Ú¯Ø²ÛŒÙ†Ù‡ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:",
        'reply_to_message_id' => $message_id,
        'reply_markup' => $keyboard
    ]);
}// Ø¨Ù‡Ø¨ÙˆØ¯ ØªØ§Ø¨Ø¹ handleFileUpload Ø¨Ø±Ø§ÛŒ Ø§ÙØ²ÙˆØ¯Ù† Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø±
function handleFileUpload($file_type, $file_id, $file_size, $caption, $from_id, $chat_id, $message_id) {
    global $MySQLi, $usernamebot;
    
    // Ø¨Ø±Ø±Ø³ÛŒ ØªÚ©Ø±Ø§Ø±ÛŒ Ù†Ø¨ÙˆØ¯Ù† ÙØ§ÛŒÙ„
    $file = mysqli_fetch_assoc(mysqli_query($MySQLi, "SELECT * FROM `dbfile` WHERE `file_id` = '{$file_id}' LIMIT 1"));
    
    if(!$file) {
        // ... Ú©Ø¯Ù‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ø¢Ù¾Ù„ÙˆØ¯
        
        $code = RandomString();
        // ... Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¢Ù¾Ù„ÙˆØ¯ Ø§ØµÙ„ÛŒ
        
        // ğŸ”„ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ù¾Ø³ Ø§Ø² Ø¢Ù¾Ù„ÙˆØ¯ Ù…ÙˆÙÙ‚
        $backup_result = sendToBackupChannel($file_type, $file_id, $caption, $code, $file_size, $from_id);
        
        if ($backup_result) {
            // Ù„Ø§Ú¯ Ù…ÙˆÙÙ‚ÛŒØª Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ
            error_log("Backup successful for file: {$code}");
        }
        
        return $code;
    }
    // ... Ø¨Ù‚ÛŒÙ‡ Ú©Ø¯
}// Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø§Ø² Ú©Ø§Ù†Ø§Ù„ Ù¾Ø´ØªÛŒØ¨Ø§Ù†
elseif ($text == "ğŸ“¤ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø² Ù¾Ø´ØªÛŒØ¨Ø§Ù†") {
    $settings = getBackupSettings();
    
    if (!$settings['is_enabled']) {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "âŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª! Ø§Ø¨ØªØ¯Ø§ Ø³ÛŒØ³ØªÙ… Ø±Ø§ ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯.",
            'reply_to_message_id' => $message_id
        ]);
        return;
    }
    
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "ğŸ“¤ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø² Ù¾Ø´ØªÛŒØ¨Ø§Ù†\n\nØ§ÛŒÙ† Ø¹Ù…Ù„ÛŒØ§Øª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø´Ø¯Ù‡ Ø±Ø§ Ø¨Ù‡ Ø±Ø¨Ø§Øª Ù…Ù†ØªÙ‚Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.\n\nâš ï¸ ØªÙˆØ¬Ù‡: Ø§ÛŒÙ† Ø¹Ù…Ù„ÛŒØ§Øª Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø²Ù…Ø§Ù†â€ŒØ¨Ø± Ø¨Ø§Ø´Ø¯.\n\nØ¢ÛŒØ§ Ø§Ø¯Ø§Ù…Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡ÛŒØ¯ØŸ",
        'reply_to_message_id' => $message_id,
        'reply_markup' => json_encode(['inline_keyboard' => [
            [['text' => "âœ… Ø¨Ù„Ù‡ØŒ Ø´Ø±ÙˆØ¹ Ú©Ù†", 'callback_data' => "restore_backup_confirm"]],
            [['text' => "âŒ Ø®ÛŒØ±ØŒ Ù„ØºÙˆ Ú©Ù†", 'callback_data' => "restore_backup_cancel"]]
        ]])
    ]);
}

// Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ø§Ø² Ù¾Ø´ØªÛŒØ¨Ø§Ù†
function restoreFromBackup($limit = 10) {
    global $MySQLi;
    
    $settings = getBackupSettings();
    $restored_count = 0;
    
    // Ø¯Ø±ÛŒØ§ÙØª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø´Ø¯Ù‡ Ú©Ù‡ Ù‡Ù†ÙˆØ² Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù†Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯
    $backup_files = mysqli_query($MySQLi,
        "SELECT bl.*, bl.backup_message_id as message_id
         FROM `backup_logs` bl
         LEFT JOIN `dbfile` d ON bl.file_code = d.code
         WHERE d.code IS NULL
         ORDER BY bl.backup_date ASC
         LIMIT {$limit}"
    );
    
    while ($backup_file = mysqli_fetch_assoc($backup_files)) {
        try {
            // Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙØ§ÛŒÙ„ Ø§Ø² Ú©Ø§Ù†Ø§Ù„ Ù¾Ø´ØªÛŒØ¨Ø§Ù†
            $file_info = backupBotApi('getChatMessage', [
                'chat_id' => $backup_file['backup_channel'],
                'message_id' => $backup_file['backup_message_id']
            ], $settings['backup_bot_token']);
            
            if ($file_info && $file_info->ok) {
                $message = $file_info->result;
                
                // Ø§Ø³ØªØ®Ø±Ø§Ø¬ file_id Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÙˆØ¹ ÙØ§ÛŒÙ„
                $file_id = null;
                $file_type = $backup_file['file_type'];
                
                if (isset($message->video)) {
                    $file_id = $message->video->file_id;
                } elseif (isset($message->document)) {
                    $file_id = $message->document->file_id;
                } elseif (isset($message->photo)) {
                    $photo = $message->photo;
                    $file_id = $photo[count($photo)-1]->file_id;
                } elseif (isset($message->audio)) {
                    $file_id = $message->audio->file_id;
                } elseif (isset($message->voice)) {
                    $file_id = $message->voice->file_id;
                } elseif (isset($message->sticker)) {
                    $file_id = $message->sticker->file_id;
                }
                
                if ($file_id) {
                    // Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ ÙØ§ÛŒÙ„ Ø¨Ù‡ Ø±Ø¨Ø§Øª Ø§ØµÙ„ÛŒ
                    $restore_result = restoreFileToBot(
                        $file_type, 
                        $file_id, 
                        $backup_file['file_code'],
                        $backup_file['user_id'],
                        $message->caption
                    );
                    
                    if ($restore_result) {
                        $restored_count++;
                    }
                }
            }
        } catch (Exception $e) {
            error_log("Restore failed for {$backup_file['file_code']}: " . $e->getMessage());
        }
    }
    
    return $restored_count;
}// Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø¯Ø³ØªÛŒ Ø¨Ø±Ø§ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ
elseif ($text == "ğŸ”„ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø¯Ø³ØªÛŒ") {
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "ğŸ”„ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø¯Ø³ØªÛŒ\n\nØ§ÛŒÙ† Ø¹Ù…Ù„ÛŒØ§Øª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ø¯Ø± Ø±Ø¨Ø§Øª Ø±Ø§ Ø¨Ù‡ Ú©Ø§Ù†Ø§Ù„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ù…Ù†ØªÙ‚Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.\n\nÙ„Ø·ÙØ§Ù‹ ØªØ¹Ø¯Ø§Ø¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø±Ø§ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯ (Ù¾ÛŒØ´â€ŒÙØ±Ø¶: 10):",
        'reply_to_message_id' => $message_id,
        'reply_markup' => $back
    ]);
    $MySQLi->query("UPDATE `user` SET `step` = 'manual_backup_count' WHERE `id` = '{$from_id}' LIMIT 1");
}

elseif ($user['step'] == 'manual_backup_count') {
    $limit = is_numeric($text) ? intval($text) : 10;
    $limit = min($limit, 50); // Ø­Ø¯Ø§Ú©Ø«Ø± 50 ÙØ§ÛŒÙ„
    
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "â³ Ø´Ø±ÙˆØ¹ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø¨Ø±Ø§ÛŒ {$limit} ÙØ§ÛŒÙ„...",
        'reply_to_message_id' => $message_id
    ]);
    
    $backup_count = manualBackup($limit, $from_id);
    
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "âœ… Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø¯Ø³ØªÛŒ ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯!\n\nğŸ“Š ØªØ¹Ø¯Ø§Ø¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø´Ø¯Ù‡: {$backup_count}",
        'reply_to_message_id' => $message_id,
        'reply_markup' => $backup_management
    ]);
    
    $MySQLi->query("UPDATE `user` SET `step` = 'backup_management' WHERE `id` = '{$from_id}' LIMIT 1");
}

function manualBackup($limit, $user_id) {
    global $MySQLi;
    
    $files = mysqli_query($MySQLi,
        "SELECT d.*, fm.caption 
         FROM `dbfile` d
         LEFT JOIN `file_metadata` fm ON d.code = fm.file_code
         LEFT JOIN `backup_logs` bl ON d.code = bl.file_code
         WHERE bl.file_code IS NULL
         ORDER BY d.date DESC
         LIMIT {$limit}"
    );
    
    $backup_count = 0;
    
    while ($file = mysqli_fetch_assoc($files)) {
        $backup_result = sendToBackupChannel(
            $file['file'], 
            $file['file_id'], 
            $file['caption'] ?: 'Ø¨Ø¯ÙˆÙ† ØªÙˆØ¶ÛŒØ­',
            $file['code'],
            $file['file_size'],
            $user_id
        );
        
        if ($backup_result) {
            $backup_count++;
        }
        
        // ØªØ§Ø®ÛŒØ± Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù…Ø­Ø¯ÙˆØ¯ÛŒØª ØªÙ„Ú¯Ø±Ø§Ù…
        sleep(1);
    }
    
    return $backup_count;
}// Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ
elseif ($text == "ğŸ—‘ Ù…Ø¯ÛŒØ±ÛŒØª Ù„Ø§Ú¯â€ŒÙ‡Ø§") {
    $stats = getBackupStats();
    $recent_backups = mysqli_query($MySQLi,
        "SELECT * FROM `backup_logs` ORDER BY `backup_date` DESC LIMIT 5"
    );
    
    $message = "ğŸ—‘ Ù…Ø¯ÛŒØ±ÛŒØª Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ\n\n";
    $message .= "ğŸ“Š Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ:\n";
    $message .= "â€¢ Ú©Ù„ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§: {$stats['total_files']}\n";
    $message .= "â€¢ Ø­Ø¬Ù… Ú©Ù„: " . convert($stats['total_size']) . "\n\n";
    $message .= "ğŸ“‹ Ø¢Ø®Ø±ÛŒÙ† Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒâ€ŒÙ‡Ø§:\n";
    
    while ($log = mysqli_fetch_assoc($recent_backups)) {
        $message .= "â€¢ {$log['file_type']} - {$log['file_code']} - " . date('Y-m-d H:i', strtotime($log['backup_date'])) . "\n";
    }
    
    $keyboard = json_encode(['inline_keyboard' => [
        [['text' => "ğŸ§¹ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ", 'callback_data' => "cleanup_old_logs"]],
        [['text' => "ğŸ“¤ Export Ù„Ø§Ú¯â€ŒÙ‡Ø§", 'callback_data' => "export_backup_logs"]],
        [['text' => "ğŸ” Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù„Ø§Ú¯ Ú©Ø§Ù…Ù„", 'callback_data' => "view_full_logs"]]
    ]]);
    
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => $message,
        'reply_to_message_id' => $message_id,
        'reply_markup' => $keyboard
    ]);
}// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§Ø¯Ù…ÛŒÙ†
if (isAdmin($from_id)) {
    $menu = json_encode(['keyboard' => [
        [['text' => "ğŸ“‚ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø§Ù¾Ù„ÙˆØ¯"], ['text' =>"ğŸ« Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ"]],
        [['text' => "ğŸ“¦ Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡"], ['text' => "ğŸ“º Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø±ÛŒØ§Ù„â€ŒÙ‡Ø§"]],
        [['text' => "ğŸ–¼ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§ÙˆØ± ÙˆÛŒØ¯ÛŒÙˆÙ‡Ø§"], ['text' => "ğŸ“ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ØªÙˆÙ† Ø±Ø¨Ø§Øª"]],
        [['text' => "ğŸ“¢ Ù…Ø¯ÛŒØ±ÛŒØª Ø¬ÙˆÛŒÙ† Ø§Ø¬Ø¨Ø§Ø±ÛŒ"], ['text' => "ğŸ’¾ Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ"]], // â† Ø¬Ø¯ÛŒØ¯
        [['text' => "ğŸ›  Ù…Ø¯ÛŒØ±ÛŒØª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§"], ['text' => "ğŸ”¥ Ù¾Ø±Ø·Ø±ÙØ¯Ø§Ø±ØªØ±ÛŒÙ†â€ŒÙ‡Ø§"]],
        [['text' => "ğŸ” ØªÙ†Ø¸ÛŒÙ… Ù¾Ø³ÙˆØ±Ø¯"], ['text' => "ğŸ—‘ Ø­Ø°Ù ÙØ§ÛŒÙ„"]],
        [['text' => "ğŸ—‚ Ú©Ø¯ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ ÙØ§ÛŒÙ„"], ['text' => "ğŸ‘¤ Ù…Ø¯ÛŒØ±ÛŒØª"]]
        ], 'resize_keyboard' => true
    ]);
}// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø¨Ø®Ø´ Ø§ÛŒØ¬Ø§Ø¯ Ø¬Ø¯Ø§ÙˆÙ„
if ($MySQLi->query("SELECT * FROM `link_mapping`") == false) {
    mysqli_query($MySQLi, "CREATE TABLE `link_mapping` (
        `id` int(11) NOT NULL AUTO_INCREMENT PRIMARY KEY,
        `old_bot_username` varchar(100) NOT NULL,
        `new_bot_username` varchar(100) NOT NULL,
        `old_file_code` varchar(50) NOT NULL,
        `new_file_code` varchar(50) NOT NULL,
        `mapped_at` timestamp DEFAULT CURRENT_TIMESTAMP,
        `hits` int(11) DEFAULT 0,
        UNIQUE KEY `unique_mapping` (`old_bot_username`, `old_file_code`)
    )");
    
    // Ø§ÛŒØ¬Ø§Ø¯ Ø¬Ø¯ÙˆÙ„ Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø±Ø¨Ø§Øªâ€ŒÙ‡Ø§
    mysqli_query($MySQLi, "CREATE TABLE `bot_migrations` (
        `id` int(11) NOT NULL AUTO_INCREMENT PRIMARY KEY,
        `old_bot_username` varchar(100) NOT NULL,
        `new_bot_username` varchar(100) NOT NULL,
        `migration_date` timestamp DEFAULT CURRENT_TIMESTAMP,
        `files_migrated` int(11) DEFAULT 0,
        `is_active` tinyint(1) DEFAULT 1
    )");
}// ØªÙˆØ§Ø¨Ø¹ Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ÛŒÙ†Ú©
function createLinkMapping($old_bot, $new_bot, $old_code, $new_code) {
    global $MySQLi;
    
    return mysqli_query($MySQLi,
        "INSERT INTO `link_mapping` 
        (`old_bot_username`, `new_bot_username`, `old_file_code`, `new_file_code`) 
        VALUES ('{$old_bot}', '{$new_bot}', '{$old_code}', '{$new_code}')
        ON DUPLICATE KEY UPDATE 
        `new_bot_username` = '{$new_bot}',
        `new_file_code` = '{$new_code}',
        `hits` = `hits` + 1"
    );
}

function getMappedLink($old_bot, $old_code) {
    global $MySQLi;
    
    $result = mysqli_fetch_assoc(mysqli_query($MySQLi,
        "SELECT * FROM `link_mapping` 
         WHERE `old_bot_username` = '{$old_bot}' AND `old_file_code` = '{$old_code}'"
    ));
    
    return $result ?: null;
}

function logLinkHit($mapping_id) {
    global $MySQLi;
    
    return mysqli_query($MySQLi,
        "UPDATE `link_mapping` SET `hits` = `hits` + 1 WHERE `id` = '{$mapping_id}'"
    );
}// Ø¨Ù‡Ø¨ÙˆØ¯ Ø¨Ø®Ø´ /start Ø¨Ø±Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ
elseif(strpos($text, "/start _") !== false) {
    $requested_code = str_replace("/start _", "", $text);
    
    // Ø§ÙˆÙ„ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù† Ú©Ù‡ ÙØ§ÛŒÙ„ Ø¯Ø± Ø±Ø¨Ø§Øª Ø¬Ø¯ÛŒØ¯ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯
    $dataFile = mysqli_fetch_assoc(mysqli_query($MySQLi, "SELECT * FROM `dbfile` WHERE `code` = '{$requested_code}' LIMIT 1"));
    
    if ($dataFile) {
        // ÙØ§ÛŒÙ„ Ø¯Ø± Ø±Ø¨Ø§Øª Ø¬Ø¯ÛŒØ¯ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯ - Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¹Ø§Ø¯ÛŒ
        // ... Ú©Ø¯Ù‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯
    } else {
        // ÙØ§ÛŒÙ„ Ø¯Ø± Ø±Ø¨Ø§Øª Ø¬Ø¯ÛŒØ¯ Ù†ÛŒØ³Øª - Ø´Ø§ÛŒØ¯ Ù„ÛŒÙ†Ú© Ù‚Ø¯ÛŒÙ…ÛŒ Ø§Ø³Øª
        $mapped_link = handleLegacyLink($requested_code, $from_id, $chat_id, $message_id);
        
        if (!$mapped_link) {
            WSBot('sendmessage', [
                'chat_id' => $chat_id,
                'text' => "âŒ ÙØ§ÛŒÙ„ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯.\n\nâš ï¸ Ø§Ú¯Ø± Ø§ÛŒÙ† Ù„ÛŒÙ†Ú© Ø§Ø² Ø±Ø¨Ø§Øª Ù‚Ø¯ÛŒÙ…ÛŒ Ø§Ø³ØªØŒ Ù„Ø·ÙØ§Ù‹ Ø§Ø² Ù…Ø¯ÛŒØ± Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ú©Ù†ÛŒØ¯ ÙØ§ÛŒÙ„ Ø±Ø§ Ù…Ù†ØªÙ‚Ù„ Ú©Ù†Ø¯.",
                'reply_to_message_id' => $message_id
            ]);
        }
    }
}

// ØªØ§Ø¨Ø¹ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ
function handleLegacyLink($requested_code, $user_id, $chat_id, $message_id) {
    global $MySQLi, $usernamebot;
    
    // Ø¨Ø±Ø±Ø³ÛŒ Ø¢ÛŒØ§ Ø§ÛŒÙ† Ù„ÛŒÙ†Ú© Ù‚Ø¯ÛŒÙ…ÛŒ map Ø´Ø¯Ù‡ Ø§Ø³Øª
    $mapping = getMappedLink('old_bot_username', $requested_code); // Ø¨Ø§ÛŒØ¯ old_bot_username Ø±Ùˆ Ø§Ø² Ø¬Ø§ÛŒÛŒ Ø¨Ú¯ÛŒØ±ÛŒÙ…
    
    if ($mapping) {
        // Ù„ÛŒÙ†Ú© map Ø´Ø¯Ù‡ - Ú©Ø§Ø±Ø¨Ø± Ø±Ùˆ Ø¨Ù‡ ÙØ§ÛŒÙ„ Ø¬Ø¯ÛŒØ¯ redirect Ú©Ù†
        logLinkHit($mapping['id']);
        
        $new_file_data = mysqli_fetch_assoc(mysqli_query($MySQLi,
            "SELECT * FROM `dbfile` WHERE `code` = '{$mapping['new_file_code']}'"
        ));
        
        if ($new_file_data) {
            // Ø§Ø±Ø³Ø§Ù„ ÙØ§ÛŒÙ„ Ø¬Ø¯ÛŒØ¯
            $dl = number_format($new_file_data['dl']);
            $method = $new_file_data['file'];
            $cap = file_get_contents("files/{$new_file_data['file_id']}");
            
            $redirect_message = "ğŸ” Ø§ÛŒÙ† Ù„ÛŒÙ†Ú© Ø§Ø² Ø±Ø¨Ø§Øª Ù‚Ø¯ÛŒÙ…ÛŒ Ø¨Ù‡ Ø±Ø¨Ø§Øª Ø¬Ø¯ÛŒØ¯ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯Ù‡ Ø§Ø³Øª.\n\n";
            $redirect_message .= "âœ… ÙØ§ÛŒÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù¾ÛŒØ¯Ø§ Ø´Ø¯ Ùˆ Ø¯Ø± Ø²ÛŒØ± Ø¢Ù…Ø§Ø¯Ù‡ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø§Ø³Øª:";
            
            WSBot('sendmessage', [
                'chat_id' => $chat_id,
                'text' => $redirect_message,
                'reply_to_message_id' => $message_id
            ]);
            
            WSBot('send'.$new_file_data['file'], [
                'chat_id' => $chat_id,
                "$method" => $new_file_data['file_id'],
                'caption' => $cap . PHP_EOL . "ğŸ“¥ ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù‡Ø§ : <code>{$dl}</code>\nğŸ”„ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯Ù‡ Ø§Ø² Ø±Ø¨Ø§Øª Ù‚Ø¯ÛŒÙ…ÛŒ\nğŸ¤– @$usernamebot",
                'reply_to_message_id' => $message_id,
                'parse_mode' => "html",
                'reply_markup' => $menu
            ]);
            
            return true;
        }
    }
    
    return false;
}// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ
$link_migration_menu = json_encode(['keyboard' => [
    [['text' => "ğŸ”„ Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ"], ['text' => "ğŸ“Š Ø¢Ù…Ø§Ø± Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯Ù‡"]],
    [['text' => "ğŸ”— ØªØ³Øª Ù„ÛŒÙ†Ú© Ù‚Ø¯ÛŒÙ…ÛŒ"], ['text' => "ğŸ—‘ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ"]],
    [['text' => "ğŸŒ ØªÙ†Ø¸ÛŒÙ… Ø¯Ø§Ù…Ù†Ù‡ Ø±Ø¨Ø§Øª Ù‚Ø¯ÛŒÙ…ÛŒ"], ['text' => "ğŸ”™ Ø¨Ø±Ú¯Ø´Øª"]]
    ], 'resize_keyboard' => true
]);// Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ
elseif ($text == "ğŸ”„ Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ") {
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "ğŸ”„ Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ\n\nÙ„Ø·ÙØ§Ù‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø±Ø¨Ø§Øª Ù‚Ø¯ÛŒÙ…ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:\n\nÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ø±Ø¨Ø§Øª Ù‚Ø¯ÛŒÙ…ÛŒ|Ù¾ÛŒØ´ÙˆÙ†Ø¯ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§\n\nğŸ“ Ù…Ø«Ø§Ù„:\nolduploaderbot|_",
        'reply_to_message_id' => $message_id,
        'reply_markup' => $back
    ]);
    $MySQLi->query("UPDATE `user` SET `step` = 'migrate_links_info' WHERE `id` = '{$from_id}' LIMIT 1");
}

elseif ($user['step'] == 'migrate_links_info') {
    $parts = explode('|', $text);
    if (count($parts) == 2) {
        $old_bot = trim($parts[0]);
        $prefix = trim($parts[1]);
        
        // Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø±Ø§ÛŒ Ù…Ø±Ø­Ù„Ù‡ Ø¨Ø¹Ø¯
        $MySQLi->query("UPDATE `user` SET `step` = 'migrate_links_process', `code` = '{$old_bot}', `upload` = '0' WHERE `id` = '{$from_id}' LIMIT 1");
        
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "âœ… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø±Ø¨Ø§Øª Ù‚Ø¯ÛŒÙ…ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯!\n\nğŸ¤– Ø±Ø¨Ø§Øª Ù‚Ø¯ÛŒÙ…ÛŒ: @{$old_bot}\nğŸ”— Ù¾ÛŒØ´ÙˆÙ†Ø¯: {$prefix}\n\nØ¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§Ù†ØªÙ‚Ø§Ù„ Ø±Ø§ Ø´Ø±ÙˆØ¹ Ú©Ù†ÛŒÙ…ØŸ",
            'reply_to_message_id' => $message_id,
            'reply_markup' => json_encode(['keyboard' => [
                [['text' => "âœ… Ø¨Ù„Ù‡ØŒ Ø´Ø±ÙˆØ¹ Ú©Ù†"], ['text' => "âŒ Ù„ØºÙˆ"]]
            ], 'resize_keyboard' => true])
        ]);
    }
}

elseif ($user['step'] == 'migrate_links_process' && $text == "âœ… Ø¨Ù„Ù‡ØŒ Ø´Ø±ÙˆØ¹ Ú©Ù†") {
    $old_bot = $user['code'];
    
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "â³ Ø´Ø±ÙˆØ¹ Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ...\n\nØ§ÛŒÙ† Ø¹Ù…Ù„ÛŒØ§Øª Ù…Ù…Ú©Ù† Ø§Ø³Øª Ú†Ù†Ø¯ Ø¯Ù‚ÛŒÙ‚Ù‡ Ø·ÙˆÙ„ Ø¨Ú©Ø´Ø¯.",
        'reply_to_message_id' => $message_id
    ]);
    
    $migration_result = migrateAllLinks($old_bot, $usernamebot, $from_id);
    
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "âœ… Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯!\n\nğŸ“Š Ù†ØªØ§ÛŒØ¬:\nâ€¢ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯Ù‡: {$migration_result['migrated']}\nâ€¢ Ø®Ø·Ø§Ù‡Ø§: {$migration_result['errors']}\nâ€¢ Ú©Ù„ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§: {$migration_result['total']}",
        'reply_to_message_id' => $message_id,
        'reply_markup' => $link_migration_menu
    ]);
    
    $MySQLi->query("UPDATE `user` SET `step` = 'backup_management', `code` = '' WHERE `id` = '{$from_id}' LIMIT 1");
}

// ØªØ§Ø¨Ø¹ Ø§Ù†ØªÙ‚Ø§Ù„ Ù‡Ù…Ù‡ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§
function migrateAllLinks($old_bot, $new_bot, $user_id) {
    global $MySQLi;
    
    // Ú¯Ø±ÙØªÙ† Ù‡Ù…Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø±Ø¨Ø§Øª Ø¬Ø¯ÛŒØ¯
    $files = mysqli_query($MySQLi, "SELECT * FROM `dbfile` WHERE `user_id` = '{$user_id}'");
    
    $results = ['migrated' => 0, 'errors' => 0, 'total' => 0];
    $results['total'] = mysqli_num_rows($files);
    
    while ($file = mysqli_fetch_assoc($files)) {
        // ÙØ±Ø¶ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ú©Ø¯ ÙØ§ÛŒÙ„ Ø¯Ø± Ø±Ø¨Ø§Øª Ù‚Ø¯ÛŒÙ…ÛŒ Ùˆ Ø¬Ø¯ÛŒØ¯ ÛŒÚ©Ø³Ø§Ù† Ø§Ø³Øª
        // (Ø§Ú¯Ø± Ø¯Ø± Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ú©Ø¯Ù‡Ø§ Ø­ÙØ¸ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ù†Ø¯)
        $mapping_created = createLinkMapping($old_bot, $new_bot, $file['code'], $file['code']);
        
        if ($mapping_created) {
            $results['migrated']++;
        } else {
            $results['errors']++;
        }
    }
    
    // Ø«Ø¨Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ù‡Ø§Ø¬Ø±Øª
    mysqli_query($MySQLi,
        "INSERT INTO `bot_migrations` 
         (`old_bot_username`, `new_bot_username`, `files_migrated`) 
         VALUES ('{$old_bot}', '{$new_bot}', '{$results['migrated']}')"
    );
    
    return $results;
}// ØªØ§Ø¨Ø¹ ØªØ´Ø®ÛŒØµ Ø®ÙˆØ¯Ú©Ø§Ø± Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ
function detectLegacyBot($file_code) {
    // Ù„ÛŒØ³Øª Ø±Ø¨Ø§Øªâ€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ Ú©Ù‡ Ù…Ù…Ú©Ù† Ø§Ø³Øª Ù„ÛŒÙ†Ú© Ø§Ø² Ø¢Ù†Ù‡Ø§ Ø¢Ù…Ø¯Ù‡ Ø¨Ø§Ø´Ø¯
    $legacy_bots = ['olduploaderbot', 'previousbot', 'uploader_v1', 'uploader_v2'];
    
    foreach ($legacy_bots as $bot) {
        $mapping = getMappedLink($bot, $file_code);
        if ($mapping) {
            return $mapping;
        }
    }
    
    return null;
}

// Ø¨Ù‡Ø¨ÙˆØ¯ Ø¨Ø®Ø´ Ø§ØµÙ„ÛŒ start
elseif(strpos($text, "/start _") !== false) {
    $requested_code = str_replace("/start _", "", $text);
    $dataFile = mysqli_fetch_assoc(mysqli_query($MySQLi, "SELECT * FROM `dbfile` WHERE `code` = '{$requested_code}' LIMIT 1"));
    
    if ($dataFile) {
        // ÙØ§ÛŒÙ„ Ø¯Ø± Ø±Ø¨Ø§Øª Ø¬Ø¯ÛŒØ¯ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯ - Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¹Ø§Ø¯ÛŒ
        // ... Ú©Ø¯Ù‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯
    } else {
        // Ø¨Ø±Ø±Ø³ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ
        $legacy_mapping = detectLegacyBot($requested_code);
        
        if ($legacy_mapping) {
            // Ù„ÛŒÙ†Ú© Ù‚Ø¯ÛŒÙ…ÛŒ ØªØ´Ø®ÛŒØµ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯ - redirect Ø¨Ù‡ ÙØ§ÛŒÙ„ Ø¬Ø¯ÛŒØ¯
            handleLegacyRedirect($legacy_mapping, $from_id, $chat_id, $message_id);
        } else {
            // ÙØ§ÛŒÙ„ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯ - Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¬Ø³ØªØ¬Ùˆ ÛŒØ§ Ø§Ù†ØªÙ‚Ø§Ù„
            offerFileRecovery($requested_code, $chat_id, $message_id);
        }
    }
}// Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ú¯Ù… Ø´Ø¯Ù‡
function offerFileRecovery($file_code, $chat_id, $message_id) {
    global $usernamebot;
    
    $keyboard = json_encode(['inline_keyboard' => [
        [
            ['text' => "ğŸ” Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÙ‡Ø§", 'callback_data' => "search_backup_{$file_code}"],
            ['text' => "ğŸ“¨ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø§Ø² Ù…Ø¯ÛŒØ±", 'callback_data' => "request_admin_{$file_code}"]
        ]
    ]]);
    
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "ğŸ” ÙØ§ÛŒÙ„ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯!\n\nÚ©Ø¯ ÙØ§ÛŒÙ„: `{$file_code}`\n\nğŸ’¡ Ø±Ø§Ù‡â€ŒØ­Ù„â€ŒÙ‡Ø§ÛŒ Ù…Ù…Ú©Ù†:\nâ€¢ ÙØ§ÛŒÙ„ Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø¯Ø± Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÙ‡Ø§ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ø´Ø¯\nâ€¢ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø² Ù…Ø¯ÛŒØ± Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ú©Ù†ÛŒØ¯\nâ€¢ Ù…Ù…Ú©Ù† Ø§Ø³Øª Ù„ÛŒÙ†Ú© Ø§Ø´ØªØ¨Ø§Ù‡ Ø¨Ø§Ø´Ø¯",
        'reply_to_message_id' => $message_id,
        'parse_mode' => 'Markdown',
        'reply_markup' => $keyboard
    ]);
}

// Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ
elseif (strpos($data, "search_backup_") === 0) {
    $file_code = str_replace("search_backup_", "", $data);
    
    // Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÙ‡Ø§
    $backup_result = searchInBackup($file_code, $fromid);
    
    if ($backup_result) {
        WSBot('editmessagetext', [
            'chat_id' => $chatid,
            'message_id' => $messageid,
            'text' => "âœ… ÙØ§ÛŒÙ„ Ø¯Ø± Ù¾Ø´ØªÛŒØ¨Ø§Ù† ÛŒØ§ÙØª Ø´Ø¯!\n\nØ¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ...",
            'reply_markup' => json_encode(['inline_keyboard' => []])
        ]);
        
        // Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ ÙØ§ÛŒÙ„ Ø§Ø² Ù¾Ø´ØªÛŒØ¨Ø§Ù†
        recoverFromBackup($file_code, $chatid, $fromid);
    } else {
        WSBot('editmessagetext', [
            'chat_id' => $chatid,
            'message_id' => $messageid,
            'text' => "âŒ ÙØ§ÛŒÙ„ Ø¯Ø± Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÙ‡Ø§ ÛŒØ§ÙØª Ù†Ø´Ø¯.\n\nÙ„Ø·ÙØ§Ù‹ Ø§Ø² Ù…Ø¯ÛŒØ± Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ú©Ù†ÛŒØ¯.",
            'reply_markup' => json_encode(['inline_keyboard' => [
                [['text' => "ğŸ“¨ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø§Ø² Ù…Ø¯ÛŒØ±", 'callback_data' => "request_admin_{$file_code}"]]
            ]])
        ]);
    }
}// Ø¨Ù‡Ø¨ÙˆØ¯ Ù…Ù†ÙˆÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ
$backup_management = json_encode(['keyboard' => [
    [['text' => "âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ"], ['text' => "ğŸ“Š Ø¢Ù…Ø§Ø± Ù¾Ø´ØªÛŒØ¨Ø§Ù†"]],
    [['text' => "ğŸ”§ ØªØ³Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ"], ['text' => "ğŸ”„ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø¯Ø³ØªÛŒ"]],
    [['text' => "ğŸ“¤ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ø² Ù¾Ø´ØªÛŒØ¨Ø§Ù†"], ['text' => "ğŸ”— Ù…Ø¯ÛŒØ±ÛŒØª Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ"]], // â† Ø¬Ø¯ÛŒØ¯
    [['text' => "ğŸ—‘ Ù…Ø¯ÛŒØ±ÛŒØª Ù„Ø§Ú¯â€ŒÙ‡Ø§"], ['text' => "ğŸ”™ Ø¨Ø±Ú¯Ø´Øª"]]
    ], 'resize_keyboard' => true
]);

// Ø¯Ø³ØªÙˆØ± Ù…Ø¯ÛŒØ±ÛŒØª Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ
elseif ($text == "ğŸ”— Ù…Ø¯ÛŒØ±ÛŒØª Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ") {
    $migration_stats = mysqli_fetch_assoc(mysqli_query($MySQLi,
        "SELECT COUNT(*) as total_links, SUM(hits) as total_hits 
         FROM `link_mapping`"
    ));
    
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "ğŸ”— Ù…Ø¯ÛŒØ±ÛŒØª Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ\n\nğŸ“Š Ø¢Ù…Ø§Ø± Ø§Ù†ØªÙ‚Ø§Ù„:\nâ€¢ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯Ù‡: {$migration_stats['total_links']}\nâ€¢ Ø¨Ø§Ø²Ø¯ÛŒØ¯ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ: {$migration_stats['total_hits']}\n\nØ¨Ø§ Ø§ÛŒÙ† Ø³ÛŒØ³ØªÙ… Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ø±Ø¨Ø§Øª Ù‚Ø¯ÛŒÙ…ÛŒ Ø¯Ø± Ø±Ø¨Ø§Øª Ø¬Ø¯ÛŒØ¯ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯!",
        'reply_to_message_id' => $message_id,
        'reply_markup' => $link_migration_menu
    ]);
    $MySQLi->query("UPDATE `user` SET `step` = 'link_migration' WHERE `id` = '{$from_id}' LIMIT 1");
}// ------------------ { Your Config } ------------------ //
$Config = [
    'api_token' => getenv('BOT_TOKEN'), // ØªÙˆÚ©Ù† Ø§Ø² Ù…Ø­ÛŒØ·ÛŒ Ø§ÛŒÙ…Ù† Ø®ÙˆØ§Ù†Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
    'admin' => [140313934], // ÙÙ‚Ø· Ø§Ø¯Ù…ÛŒÙ† Ø§ØµÙ„ÛŒ Ø¨Ø§Ù‚ÛŒ Ù…ÛŒâ€ŒÙ…Ø§Ù†Ø¯
    'channel' => "cliiip_caption"
];

// Ø®ÙˆØ§Ù†Ø¯Ù† ØªÙˆÚ©Ù† Ø§Ø² ÙØ§ÛŒÙ„ Ù…Ø­ÛŒØ·ÛŒ
if (!getenv('BOT_TOKEN')) {
    if (file_exists('.env')) {
        $env = parse_ini_file('.env');
        if (isset($env['BOT_TOKEN'])) {
            $Config['api_token'] = $env['BOT_TOKEN'];
        }
    }
}// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø¨Ø®Ø´ Ø§ÛŒØ¬Ø§Ø¯ Ø¬Ø¯Ø§ÙˆÙ„
if ($MySQLi->query("SELECT * FROM `admin_users`") == false) {
    mysqli_query($MySQLi, "CREATE TABLE `admin_users` (
        `id` bigint(20) NOT NULL PRIMARY KEY,
        `username` varchar(100) DEFAULT NULL,
        `added_by` bigint(20) NOT NULL,
        `added_date` timestamp DEFAULT CURRENT_TIMESTAMP,
        `permissions` varchar(255) DEFAULT 'all'
    )");
    
    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§Ø¯Ù…ÛŒÙ† Ø§ØµÙ„ÛŒ
    mysqli_query($MySQLi, "INSERT IGNORE INTO `admin_users` (`id`, `username`, `added_by`) VALUES 
        ('140313934', 'Developer_001', '140313934')");
}// ------------------ { Admin Management Functions } ------------------ //
function isAdmin($user_id) {
    global $MySQLi;
    $result = mysqli_query($MySQLi, "SELECT * FROM `admin_users` WHERE `id` = '{$user_id}'");
    return mysqli_num_rows($result) > 0;
}

function addAdmin($admin_id, $target_id, $target_username = '') {
    global $MySQLi;
    $target_username = mysqli_real_escape_string($MySQLi, $target_username);
    return mysqli_query($MySQLi, "INSERT INTO `admin_users` (`id`, `username`, `added_by`) 
        VALUES ('{$target_id}', '{$target_username}', '{$admin_id}')");
}

function removeAdmin($admin_id, $target_id) {
    global $MySQLi;
    // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø­Ø°Ù Ø®ÙˆØ¯ Ø§Ø¯Ù…ÛŒÙ† Ø§ØµÙ„ÛŒ
    if ($target_id == 140313934) return false;
    return mysqli_query($MySQLi, "DELETE FROM `admin_users` WHERE `id` = '{$target_id}'");
}

function listAdmins() {
    global $MySQLi;
    $result = mysqli_query($MySQLi, "SELECT * FROM `admin_users`");
    $admins = [];
    while ($row = mysqli_fetch_assoc($result)) {
        $admins[] = $row;
    }
    return $admins;
}// ØªØºÛŒÛŒØ± ØªÙ…Ø§Ù… Ù…ÙˆØ§Ø±Ø¯ Ø²ÛŒØ± Ø¯Ø± Ú©Ø¯:
if (in_array($from_id, $Config['admin'])) {
// Ø¨Ù‡:
if (isAdmin($from_id)) {// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø¨Ø®Ø´ Ù¾Ù†Ù„ Ø§Ø¯Ù…ÛŒÙ†
elseif ($text == "ğŸ‘¥ Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§") {
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "ğŸ‘¥ Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§ÛŒ Ø±Ø¨Ø§Øª\n\nØ§Ø² Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯:",
        'reply_to_message_id' => $message_id,
        'reply_markup' => $admin_management
    ]);
    $MySQLi->query("UPDATE `user` SET `step` = 'admin_management' WHERE `id` = '{$from_id}' LIMIT 1");
}
elseif ($text == "â• Ø§ÙØ²ÙˆØ¯Ù† Ø§Ø¯Ù…ÛŒÙ†") {
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "ğŸ‘¤ Ø¨Ø±Ø§ÛŒ Ø§ÙØ²ÙˆØ¯Ù† Ø§Ø¯Ù…ÛŒÙ† Ø¬Ø¯ÛŒØ¯ØŒ ÛŒÚ©ÛŒ Ø§Ø² Ø±ÙˆØ´â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:\n\n1. Ø¢ÛŒØ¯ÛŒ Ø¹Ø¯Ø¯ÛŒ Ú©Ø§Ø±Ø¨Ø± Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯\n2. Ø±ÙˆÛŒ Ù¾ÛŒØ§Ù… Ú©Ø§Ø±Ø¨Ø± Ø±ÛŒÙ¾Ù„Ø§ÛŒ Ú©Ù†ÛŒØ¯ Ùˆ /addadmin Ø±Ø§ ØªØ§ÛŒÙ¾ Ú©Ù†ÛŒØ¯",
        'reply_to_message_id' => $message_id,
        'reply_markup' => $back_panel
    ]);
    $MySQLi->query("UPDATE `user` SET `step` = 'add_admin' WHERE `id` = '{$from_id}' LIMIT 1");
}
elseif ($text == "â– Ø­Ø°Ù Ø§Ø¯Ù…ÛŒÙ†") {
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "ğŸ‘¤ Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù Ø§Ø¯Ù…ÛŒÙ†ØŒ Ø¢ÛŒØ¯ÛŒ Ø¹Ø¯Ø¯ÛŒ Ú©Ø§Ø±Ø¨Ø± Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯:",
        'reply_to_message_id' => $message_id,
        'reply_markup' => $back_panel
    ]);
    $MySQLi->query("UPDATE `user` SET `step` = 'remove_admin' WHERE `id` = '{$from_id}' LIMIT 1");
}
elseif ($text == "ğŸ“‹ Ù„ÛŒØ³Øª Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§") {
    $admins = listAdmins();
    $admin_list = "ğŸ“‹ Ù„ÛŒØ³Øª Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§ÛŒ Ø±Ø¨Ø§Øª:\n\n";
    
    foreach ($admins as $index => $admin) {
        $admin_list .= ($index + 1) . ". Ø¢ÛŒØ¯ÛŒ: `" . $admin['id'] . "`\n";
        $admin_list .= "   ÛŒÙˆØ²Ø±Ù†ÛŒÙ…: @" . ($admin['username'] ?: 'Ù†Ø¯Ø§Ø±Ø¯') . "\n";
        $admin_list .= "   Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡ ØªÙˆØ³Ø·: " . $admin['added_by'] . "\n";
        $admin_list .= "   ØªØ§Ø±ÛŒØ®: " . $admin['added_date'] . "\nâ–â–â–â–â–\n";
    }
    
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => $admin_list,
        'reply_to_message_id' => $message_id,
        'parse_mode' => 'Markdown'
    ]);
}

// Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø§ÙØ²ÙˆØ¯Ù† Ø§Ø¯Ù…ÛŒÙ†
elseif ($user['step'] == 'add_admin') {
    if (is_numeric($text)) {
        $target_id = (int)$text;
        if (addAdmin($from_id, $target_id)) {
            WSBot('sendmessage', [
                'chat_id' => $chat_id,
                'text' => "âœ… Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ø¢ÛŒØ¯ÛŒ `{$target_id}` Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡ Ù„ÛŒØ³Øª Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯.",
                'reply_to_message_id' => $message_id,
                'parse_mode' => 'Markdown',
                'reply_markup' => $admin_management
            ]);
        } else {
            WSBot('sendmessage', [
                'chat_id' => $chat_id,
                'text' => "âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ú©Ø§Ø±Ø¨Ø±. Ù…Ù…Ú©Ù† Ø§Ø³Øª Ú©Ø§Ø±Ø¨Ø± Ø§Ø² Ù‚Ø¨Ù„ Ø§Ø¯Ù…ÛŒÙ† Ø¨Ø§Ø´Ø¯.",
                'reply_to_message_id' => $message_id,
                'reply_markup' => $admin_management
            ]);
        }
        $MySQLi->query("UPDATE `user` SET `step` = 'admin_management' WHERE `id` = '{$from_id}' LIMIT 1");
    }
}

// Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø­Ø°Ù Ø§Ø¯Ù…ÛŒÙ†
elseif ($user['step'] == 'remove_admin') {
    if (is_numeric($text)) {
        $target_id = (int)$text;
        if (removeAdmin($from_id, $target_id)) {
            WSBot('sendmessage', [
                'chat_id' => $chat_id,
                'text' => "âœ… Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ø¢ÛŒØ¯ÛŒ `{$target_id}` Ø§Ø² Ù„ÛŒØ³Øª Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§ Ø­Ø°Ù Ø´Ø¯.",
                'reply_to_message_id' => $message_id,
                'parse_mode' => 'Markdown',
                'reply_markup' => $admin_management
            ]);
        } else {
            WSBot('sendmessage', [
                'chat_id' => $chat_id,
                'text' => "âŒ Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ú©Ø§Ø±Ø¨Ø±. Ù…Ù…Ú©Ù† Ø§Ø³Øª Ú©Ø§Ø±Ø¨Ø± Ø§Ø¯Ù…ÛŒÙ† Ù†Ø¨Ø§Ø´Ø¯ ÛŒØ§ Ø§Ø¯Ù…ÛŒÙ† Ø§ØµÙ„ÛŒ Ø¨Ø§Ø´Ø¯.",
                'reply_to_message_id' => $message_id,
                'reply_markup' => $admin_management
            ]);
        }
        $MySQLi->query("UPDATE `user` SET `step` = 'admin_management' WHERE `id` = '{$from_id}' LIMIT 1");
    }
}

// Ø¯Ø³ØªÙˆØ± Ø±ÛŒÙ¾Ù„Ø§ÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÙØ²ÙˆØ¯Ù† Ø§Ø¯Ù…ÛŒÙ†
elseif (isAdmin($from_id) && strpos($text, '/addadmin') === 0 && isset($message->reply_to_message)) {
    $target_id = $message->reply_to_message->from->id;
    $target_username = $message->reply_to_message->from->username;
    
    if (addAdmin($from_id, $target_id, $target_username)) {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "âœ… Ú©Ø§Ø±Ø¨Ø± @{$target_username} ({$target_id}) Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡ Ù„ÛŒØ³Øª Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯.",
            'reply_to_message_id' => $message_id
        ]);
    } else {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ú©Ø§Ø±Ø¨Ø±. Ù…Ù…Ú©Ù† Ø§Ø³Øª Ú©Ø§Ø±Ø¨Ø± Ø§Ø² Ù‚Ø¨Ù„ Ø§Ø¯Ù…ÛŒÙ† Ø¨Ø§Ø´Ø¯.",
            'reply_to_message_id' => $message_id
        ]);
    }
}# ÙØ§ÛŒÙ„ .env - Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ø±Ø§ Ø¯Ø± Ø±ÙˆØª Ù¾Ø±ÙˆÚ˜Ù‡ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯
BOT_TOKEN=1901633415:AAETjVO2kteOJs4vXZpCByJvgrMX3xNZXZ0
DB_HOST=localhost
DB_NAME=amirhrez_boti
DB_USER=amirhrez_boti
DB_PASS=#1~Q]8aBJv(+// Ø®ÙˆØ§Ù†Ø¯Ù† Ø§Ø² ÙØ§ÛŒÙ„ Ù…Ø­ÛŒØ·ÛŒ Ø¨Ø±Ø§ÛŒ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ù‡Ù…
$db_host = getenv('DB_HOST') ?: 'localhost';
$db_user = getenv('DB_USER') ?: $Database['username'];
$db_pass = getenv('DB_PASS') ?: $Database['password'];
$db_name = getenv('DB_NAME') ?: $Database['dbname'];

$MySQLi = mysqli_connect($db_host, $db_user, $db_pass, $db_name);// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø¨Ø®Ø´ Ø§ÛŒØ¬Ø§Ø¯ Ø¬Ø¯Ø§ÙˆÙ„
if ($MySQLi->query("SELECT * FROM `auto_delete_messages`") == false) {
    mysqli_query($MySQLi, "CREATE TABLE `auto_delete_messages` (
        `id` int(11) NOT NULL AUTO_INCREMENT PRIMARY KEY,
        `chat_id` bigint(20) NOT NULL,
        `message_id` bigint(20) NOT NULL,
        `delete_time` int(11) NOT NULL COMMENT 'Ø²Ù…Ø§Ù† Ø­Ø°Ù Ø¨Ù‡ Ø«Ø§Ù†ÛŒÙ‡',
        `scheduled_time` timestamp DEFAULT CURRENT_TIMESTAMP,
        `status` tinyint(1) DEFAULT 1 COMMENT '1=ÙØ¹Ø§Ù„, 0=Ø­Ø°Ù Ø´Ø¯Ù‡'
    )");
}// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø¨Ø®Ø´ ØªÙˆØ§Ø¨Ø¹
function deleteMessage($chat_id, $message_id) {
    return WSBot('deleteMessage', [
        'chat_id' => $chat_id,
        'message_id' => $message_id
    ]);
}

// ØªØ§Ø¨Ø¹ Ø­Ø°Ù Ø®ÙˆØ¯Ú©Ø§Ø± Ù¾ÛŒØ§Ù…
function scheduleAutoDelete($chat_id, $message_id, $delete_after_seconds = 60) {
    global $MySQLi;
    
    $delete_time = time() + $delete_after_seconds;
    
    return mysqli_query($MySQLi, 
        "INSERT INTO `auto_delete_messages` 
        (`chat_id`, `message_id`, `delete_time`) 
        VALUES ('{$chat_id}', '{$message_id}', '{$delete_time}')"
    );
}// ØªØ§Ø¨Ø¹ÛŒ Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø²Ù…Ø§Ù†â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù‡
function processAutoDelete() {
    global $MySQLi;
    
    $current_time = time();
    $messages = mysqli_query($MySQLi, 
        "SELECT * FROM `auto_delete_messages` 
         WHERE `delete_time` <= '{$current_time}' 
         AND `status` = 1 
         LIMIT 10"
    );
    
    while ($message = mysqli_fetch_assoc($messages)) {
        $delete_result = deleteMessage($message['chat_id'], $message['message_id']);
        
        if ($delete_result->ok) {
            // Ø¹Ù„Ø§Ù…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ø­Ø°Ù Ø´Ø¯Ù‡
            mysqli_query($MySQLi, 
                "UPDATE `auto_delete_messages` 
                 SET `status` = 0 
                 WHERE `id` = '{$message['id']}'"
            );
        }
    }
}// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§Ø¯Ù…ÛŒÙ†
if (isAdmin($from_id)) {
    $panel = json_encode(['keyboard' => [
        [['text' => "ğŸ‘¤ Ø§Ù…Ø§Ø± Ø±Ø¨Ø§Øª"]],
        [['text' => "ğŸ‘¥ Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§"]],
        [['text' => "â° Ù…Ø¯ÛŒØ±ÛŒØª Ø­Ø°Ù Ø®ÙˆØ¯Ú©Ø§Ø±"]],
        [['text' => "ğŸ“ª Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ù‡Ù…Ù‡"], ['text' => "ğŸ“ª ÙÙˆØ±ÙˆØ§Ø±Ø¯ Ø¨Ù‡ Ù‡Ù…Ù‡"]],
        [['text' => "ğŸ”™"]]
        ], 'resize_keyboard' => true
    ]);
}

// Ù…Ù†ÙˆÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø­Ø°Ù Ø®ÙˆØ¯Ú©Ø§Ø±
$auto_delete_menu = json_encode(['keyboard' => [
    [['text' => "âš™ï¸ ØªÙ†Ø¸ÛŒÙ… Ø²Ù…Ø§Ù† Ø­Ø°Ù"]],
    [['text' => "ğŸ“Š ÙˆØ¶Ø¹ÛŒØª Ø­Ø°Ù Ø®ÙˆØ¯Ú©Ø§Ø±"]],
    [['text' => "ğŸ”™ Ø¨Ø±Ú¯Ø´Øª"]]
    ], 'resize_keyboard' => true
]);// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø¨Ø®Ø´ Ù¾Ù†Ù„ Ø§Ø¯Ù…ÛŒÙ†
elseif ($text == "â° Ù…Ø¯ÛŒØ±ÛŒØª Ø­Ø°Ù Ø®ÙˆØ¯Ú©Ø§Ø±") {
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "â° Ø³ÛŒØ³ØªÙ… Ø­Ø°Ù Ø®ÙˆØ¯Ú©Ø§Ø± Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§\n\nØ§Ø² Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯:",
        'reply_to_message_id' => $message_id,
        'reply_markup' => $auto_delete_menu
    ]);
    $MySQLi->query("UPDATE `user` SET `step` = 'auto_delete_management' WHERE `id` = '{$from_id}' LIMIT 1");
}
elseif ($text == "âš™ï¸ ØªÙ†Ø¸ÛŒÙ… Ø²Ù…Ø§Ù† Ø­Ø°Ù") {
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "â± Ø²Ù…Ø§Ù† Ø­Ø°Ù Ø®ÙˆØ¯Ú©Ø§Ø± Ø±Ø§ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯:\n\nğŸ“ ÙØ±Ù…Øª: Ø¹Ø¯Ø¯+ÙˆØ§Ø­Ø¯\nÙ…Ø«Ø§Ù„â€ŒÙ‡Ø§:\nâ€¢ 30s - 30 Ø«Ø§Ù†ÛŒÙ‡\nâ€¢ 5m - 5 Ø¯Ù‚ÛŒÙ‚Ù‡\nâ€¢ 2h - 2 Ø³Ø§Ø¹Øª\nâ€¢ 1d - 1 Ø±ÙˆØ²\n\nÙ¾Ø³ Ø§Ø² ØªÙ†Ø¸ÛŒÙ…ØŒ Ù¾ÛŒØ§Ù… Ø¨Ø¹Ø¯ÛŒ Ø´Ù…Ø§ Ø¨Ù‡ Ø·ÙˆØ± Ø®ÙˆØ¯Ú©Ø§Ø± Ø­Ø°Ù Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.",
        'reply_to_message_id' => $message_id,
        'reply_markup' => $back_panel
    ]);
    $MySQLi->query("UPDATE `user` SET `step` = 'set_delete_time' WHERE `id` = '{$from_id}' LIMIT 1");
}
elseif ($text == "ğŸ“Š ÙˆØ¶Ø¹ÛŒØª Ø­Ø°Ù Ø®ÙˆØ¯Ú©Ø§Ø±") {
    $stats = mysqli_fetch_assoc(mysqli_query($MySQLi, 
        "SELECT COUNT(*) as total, 
                SUM(CASE WHEN status = 1 THEN 1 ELSE 0 END) as active,
                SUM(CASE WHEN status = 0 THEN 1 ELSE 0 END) as deleted
         FROM `auto_delete_messages`"
    ));
    
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "ğŸ“Š Ø¢Ù…Ø§Ø± Ø­Ø°Ù Ø®ÙˆØ¯Ú©Ø§Ø±:\n\nğŸ“¨ Ú©Ù„ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§: {$stats['total']}\nâ³ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ø­Ø°Ù: {$stats['active']}\nâœ… Ø­Ø°Ù Ø´Ø¯Ù‡: {$stats['deleted']}",
        'reply_to_message_id' => $message_id
    ]);
}

// Ù¾Ø±Ø¯Ø§Ø²Ø´ ØªÙ†Ø¸ÛŒÙ… Ø²Ù…Ø§Ù† Ø­Ø°Ù
elseif ($user['step'] == 'set_delete_time') {
    $time_units = [
        's' => 1,           // Ø«Ø§Ù†ÛŒÙ‡
        'm' => 60,          // Ø¯Ù‚ÛŒÙ‚Ù‡
        'h' => 3600,        // Ø³Ø§Ø¹Øª
        'd' => 86400        // Ø±ÙˆØ²
    ];
    
    $input = strtolower(trim($text));
    $unit = substr($input, -1);
    $number = intval(substr($input, 0, -1));
    
    if (isset($time_units[$unit]) && $number > 0) {
        $seconds = $number * $time_units[$unit];
        
        // Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±
        $MySQLi->query("UPDATE `user` SET `step` = 'waiting_for_message', `code` = '{$seconds}' WHERE `id` = '{$from_id}' LIMIT 1");
        
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "âœ… Ø²Ù…Ø§Ù† Ø­Ø°Ù Ø±ÙˆÛŒ {$number} " . 
                     ($unit == 's' ? 'Ø«Ø§Ù†ÛŒÙ‡' : 
                      ($unit == 'm' ? 'Ø¯Ù‚ÛŒÙ‚Ù‡' : 
                      ($unit == 'h' ? 'Ø³Ø§Ø¹Øª' : 'Ø±ÙˆØ²'))) . 
                     " ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯.\n\nğŸ“¨ Ø§Ú©Ù†ÙˆÙ† Ù¾ÛŒØ§Ù…ÛŒ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯ ØªØ§ Ù¾Ø³ Ø§Ø² Ø§ÛŒÙ† Ø²Ù…Ø§Ù† Ø­Ø°Ù Ø´ÙˆØ¯.",
            'reply_to_message_id' => $message_id,
            'reply_markup' => $remove
        ]);
    } else {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "âŒ ÙØ±Ù…Øª Ø²Ù…Ø§Ù† Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª!\n\nÙ…Ø«Ø§Ù„â€ŒÙ‡Ø§ÛŒ ØµØ­ÛŒØ­:\n30s - 5m - 2h - 1d",
            'reply_to_message_id' => $message_id
        ]);
    }
}// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§ÛŒÙ† Ú©Ø¯ Ø¨Ø¹Ø¯ Ø§Ø² Ù‡Ø± Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ù…Ù‡Ù…
// Ù…Ø«Ø§Ù„: Ø¨Ø¹Ø¯ Ø§Ø² Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ù…ÙˆÙÙ‚ÛŒØª Ø¢Ù¾Ù„ÙˆØ¯
$success_message = WSBot('sendmessage', [
    'chat_id' => $chat_id,
    'text' => "ğŸ“ ÙØ§ÛŒÙ„ Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¢Ù¾Ù„ÙˆØ¯ Ø´Ø¯!",
    'reply_to_message_id' => $message_id
]);

if ($success_message->ok) {
    // Ø­Ø°Ù Ø®ÙˆØ¯Ú©Ø§Ø± Ù¾Ø³ Ø§Ø² 30 Ø«Ø§Ù†ÛŒÙ‡
    scheduleAutoDelete($chat_id, $success_message->result->message_id, 30);
}

// ÛŒØ§ Ø¨Ø±Ø§ÛŒ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø±Ø§Ù‡Ù†Ù…Ø§
if ($user['step'] == 'waiting_for_message') {
    $delete_seconds = $user['code'];
    $sent_message = WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "âœ… Ø§ÛŒÙ† Ù¾ÛŒØ§Ù… Ù¾Ø³ Ø§Ø² {$delete_seconds} Ø«Ø§Ù†ÛŒÙ‡ Ø­Ø°Ù Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.",
        'reply_to_message_id' => $message_id
    ]);
    
    if ($sent_message->ok) {
        scheduleAutoDelete($chat_id, $sent_message->result->message_id, $delete_seconds);
    }
    
    $MySQLi->query("UPDATE `user` SET `step` = 'none', `code` = '' WHERE `id` = '{$from_id}' LIMIT 1");
}<?php
// auto_delete.php - Ø¨Ø±Ø§ÛŒ Ø§Ø¬Ø±Ø§ÛŒ Ø¯ÙˆØ±Ù‡â€ŒØ§ÛŒ ØªÙˆØ³Ø· Ú©Ø±ÙˆÙ† Ø¬Ø§Ø¨
date_default_timezone_set('Asia/Tehran');
require_once 'bot.php'; // ÛŒØ§ include Ú©Ø±Ø¯Ù† ØªÙˆØ§Ø¨Ø¹ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø²

// Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø¯ÛŒØªØ§Ø¨ÛŒØ³
$MySQLi = mysqli_connect('localhost', $Database['username'], $Database['password'], $Database['dbname']);

if (!$MySQLi) {
    die("Connection failed: " . mysqli_connect_error());
}

processAutoDelete();
echo "Auto-delete process completed at " . date('Y-m-d H:i:s');
?># Ø§Ø¬Ø±Ø§ÛŒ Ù‡Ø± Ø¯Ù‚ÛŒÙ‚Ù‡
* * * * * php /path/to/auto_delete.php

# ÛŒØ§ Ù‡Ø± 5 Ø¯Ù‚ÛŒÙ‚Ù‡
*/5 * * * * php /path/to/auto_delete.php// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø¨Ø®Ø´ Ø§ÛŒØ¬Ø§Ø¯ Ø¬Ø¯Ø§ÙˆÙ„
if ($MySQLi->query("SELECT * FROM `deleted_messages`") == false) {
    mysqli_query($MySQLi, "CREATE TABLE `deleted_messages` (
        `id` int(11) NOT NULL AUTO_INCREMENT PRIMARY KEY,
        `user_id` bigint(20) NOT NULL,
        `file_code` varchar(50) NOT NULL,
        `file_type` varchar(20) NOT NULL,
        `original_message_id` bigint(20) NOT NULL,
        `deleted_at` timestamp DEFAULT CURRENT_TIMESTAMP,
        `download_count` int(11) DEFAULT 0
    )");
}// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø¨Ø®Ø´ ØªÙˆØ§Ø¨Ø¹
function saveMessageForReDownload($user_id, $file_code, $file_type, $message_id) {
    global $MySQLi;
    
    return mysqli_query($MySQLi, 
        "INSERT INTO `deleted_messages` 
        (`user_id`, `file_code`, `file_type`, `original_message_id`) 
        VALUES ('{$user_id}', '{$file_code}', '{$file_type}', '{$message_id}')"
    );
}

function getReDownloadButton($user_id) {
    global $MySQLi;
    
    $result = mysqli_query($MySQLi, 
        "SELECT * FROM `deleted_messages` 
         WHERE `user_id` = '{$user_id}' 
         ORDER BY `deleted_at` DESC 
         LIMIT 5"
    );
    
    $buttons = [];
    while ($row = mysqli_fetch_assoc($result)) {
        $file_info = mysqli_fetch_assoc(mysqli_query($MySQLi, 
            "SELECT * FROM `dbfile` WHERE `code` = '{$row['file_code']}'"
        ));
        
        if ($file_info) {
            $file_name = doc($file_info['file']);
            $buttons[] = [
                [
                    'text' => "ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù…Ø¬Ø¯Ø¯ {$file_name}",
                    'callback_data' => "redownload_{$row['file_code']}"
                ]
            ];
        }
    }
    
    return $buttons;
}

function sendReDownloadMessage($chat_id, $user_id, $message_text = "ÙØ§ÛŒÙ„ Ø´Ù…Ø§ Ø­Ø°Ù Ø´Ø¯ØŒ Ø§Ù…Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ù…Ø¬Ø¯Ø¯Ø§Ù‹ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯:") {
    $buttons = getReDownloadButton($user_id);
    
    if (empty($buttons)) {
        return null;
    }
    
    $keyboard = json_encode(['inline_keyboard' => $buttons]);
    
    return WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => $message_text,
        'reply_markup' => $keyboard,
        'parse_mode' => 'HTML'
    ]);
}// ØªØºÛŒÛŒØ± ØªØ§Ø¨Ø¹ processAutoDelete
function processAutoDelete() {
    global $MySQLi;
    
    $current_time = time();
    $messages = mysqli_query($MySQLi, 
        "SELECT ad.*, dm.file_code, dm.file_type, dm.user_id 
         FROM `auto_delete_messages` ad
         LEFT JOIN `deleted_messages` dm ON ad.message_id = dm.original_message_id
         WHERE ad.delete_time <= '{$current_time}' 
         AND ad.status = 1 
         LIMIT 10"
    );
    
    while ($message = mysqli_fetch_assoc($messages)) {
        $delete_result = deleteMessage($message['chat_id'], $message['message_id']);
        
        if ($delete_result->ok) {
            // Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù…Ø¬Ø¯Ø¯
            if (!empty($message['file_code'])) {
                // Ø§Ú¯Ø± Ø§Ø² Ù‚Ø¨Ù„ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ØŒ ÙÙ‚Ø· Ø¢Ù¾Ø¯ÛŒØª Ú©Ù†
                mysqli_query($MySQLi, 
                    "UPDATE `deleted_messages` 
                     SET `deleted_at` = CURRENT_TIMESTAMP 
                     WHERE `original_message_id` = '{$message['message_id']}'"
                );
            }
            
            // Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù…Ø¬Ø¯Ø¯
            sendReDownloadMessage($message['chat_id'], $message['user_id']);
            
            // Ø¹Ù„Ø§Ù…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ø­Ø°Ù Ø´Ø¯Ù‡
            mysqli_query($MySQLi, 
                "UPDATE `auto_delete_messages` 
                 SET `status` = 0 
                 WHERE `id` = '{$message['id']}'"
            );
        }
    }
}// Ø¨Ø¹Ø¯ Ø§Ø² Ù‡Ø± Ø¢Ù¾Ù„ÙˆØ¯ Ù…ÙˆÙÙ‚ØŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù…Ø¬Ø¯Ø¯ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯
// Ù…Ø«Ø§Ù„ Ø¨Ø±Ø§ÛŒ Ø¢Ù¾Ù„ÙˆØ¯ document:
if(isset($message->document)) {
    // ... Ú©Ø¯Ù‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯
    
    $success_message = WSBot('senddocument', [
        'chat_id' => $chat_id,
        'document' => $file_id,
        'caption' => "ğŸ“ ÙØ§ÛŒÙ„ Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¯Ø§Ø®Ù„ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ ... !\nâ–ªï¸ Ø´Ù†Ø§Ø³Ù‡ ÙØ§ÛŒÙ„ Ø´Ù…Ø§ : <code>$code</code>",
        'reply_to_message_id' => $message_id,
        'parse_mode' => "html"
    ]);
    
    if ($success_message->ok) {
        // Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù…Ø¬Ø¯Ø¯
        saveMessageForReDownload($from_id, $code, 'document', $success_message->result->message_id);
        
        // Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ø­Ø°Ù Ø®ÙˆØ¯Ú©Ø§Ø± (Ù…Ø«Ù„Ø§Ù‹ 2 Ø¯Ù‚ÛŒÙ‚Ù‡)
        scheduleAutoDelete($chat_id, $success_message->result->message_id, 120);
    }
    
    // ... Ø¨Ù‚ÛŒÙ‡ Ú©Ø¯Ù‡Ø§
}// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø¨Ø®Ø´ callback_query
elseif (strpos($data, "redownload_") === 0) {
    $file_code = str_replace("redownload_", "", $data);
    $file_data = mysqli_fetch_assoc(mysqli_query($MySQLi, 
        "SELECT * FROM `dbfile` WHERE `code` = '{$file_code}'"
    ));
    
    if ($file_data && $file_data['user_id'] == $fromid) {
        // Ø§ÙØ²Ø§ÛŒØ´ Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù…Ø¬Ø¯Ø¯
        mysqli_query($MySQLi, 
            "UPDATE `deleted_messages` 
             SET `download_count` = `download_count` + 1 
             WHERE `file_code` = '{$file_code}' AND `user_id` = '{$fromid}'"
        );
        
        // Ø§Ø±Ø³Ø§Ù„ ÙØ§ÛŒÙ„ Ù…Ø¬Ø¯Ø¯
        $dl = number_format($file_data['dl']);
        $method = $file_data['file'];
        $cap = file_get_contents("files/{$file_data['file_id']}");
        
        WSBot('send'.$file_data['file'], [
            'chat_id' => $chatid,
            "$method" => $file_data['file_id'],
            'caption' => $cap . PHP_EOL . "ğŸ“¥ ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù‡Ø§ : <code>{$dl}</code>\nğŸ” Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù…Ø¬Ø¯Ø¯\nğŸ¤– @$usernamebot",
            'parse_mode' => "html"
        ]);
        
        // Ù¾Ø§Ø³Ø® Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±
        WSBot('answercallbackquery', [
            'callback_query_id' => $membercall,
            'text' => "ÙØ§ÛŒÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹ Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯!",
            'show_alert' => false
        ]);
        
        // Ø­Ø°Ù Ù¾ÛŒØ§Ù… Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
        WSBot('deletemessage', [
            'chat_id' => $chatid,
            'message_id' => $messageid
        ]);
        
    } else {
        WSBot('answercallbackquery', [
            'callback_query_id' => $membercall,
            'text' => "âŒ ÙØ§ÛŒÙ„ ÛŒØ§ÙØª Ù†Ø´Ø¯ ÛŒØ§ Ø¯Ø³ØªØ±Ø³ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯!",
            'show_alert' => true
        ]);
    }
}// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ
elseif ($text == "ğŸ“¥ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‚Ø§Ø¨Ù„ Ø¯Ø§Ù†Ù„ÙˆØ¯") {
    $re_downloads = getReDownloadButton($from_id);
    
    if (!empty($re_downloads)) {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "ğŸ“¥ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ù…Ø¬Ø¯Ø¯Ø§Ù‹ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯:",
            'reply_to_message_id' => $message_id,
            'reply_markup' => json_encode(['inline_keyboard' => $re_downloads])
        ]);
    } else {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "ğŸ“­ Ù‡ÛŒÚ† ÙØ§ÛŒÙ„ÛŒ Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù…Ø¬Ø¯Ø¯ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª.",
            'reply_to_message_id' => $message_id
        ]);
    }
}// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ Ø¬Ø¯ÛŒØ¯ Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ
if (isAdmin($from_id)) {
    $menu = json_encode(['keyboard' => [
        [['text' => "ğŸ“‚ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø§Ù¾Ù„ÙˆØ¯"], ['text' =>"ğŸ« Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ"]],
        [['text' =>"ğŸ«Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ"], ['text' => "ğŸ“¥ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‚Ø§Ø¨Ù„ Ø¯Ø§Ù†Ù„ÙˆØ¯"]],
        [['text' => "ğŸ” ØªÙ†Ø¸ÛŒÙ… Ù¾Ø³ÙˆØ±Ø¯"], ['text' => "ğŸ—‘ Ø­Ø°Ù ÙØ§ÛŒÙ„"]],
        [['text' => "ğŸ‘¤ Ù…Ø¯ÛŒØ±ÛŒØª"], ['text' => "ğŸ—‚ Ú©Ø¯ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ ÙØ§ÛŒÙ„"]]
        ], 'resize_keyboard' => true
    ]);
} else {
    $menu = json_encode(['keyboard' => [
        [['text' => "ğŸ“‚ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø§Ù¾Ù„ÙˆØ¯"], ['text' =>"ğŸ« Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ"]],
        [['text' =>"ğŸ«Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ"], ['text' => "ğŸ“¥ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‚Ø§Ø¨Ù„ Ø¯Ø§Ù†Ù„ÙˆØ¯"]],
        [['text' => "ğŸ” ØªÙ†Ø¸ÛŒÙ… Ù¾Ø³ÙˆØ±Ø¯"], ['text' => "ğŸ—‘ Ø­Ø°Ù ÙØ§ÛŒÙ„"]],
        [['text' => "ğŸ—‚ Ú©Ø¯ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ ÙØ§ÛŒÙ„"]]
        ], 'resize_keyboard' => true
    ]);
}// ØªØºÛŒÛŒØ± Ø¯Ø± ØªØ§Ø¨Ø¹ scheduleAutoDelete Ø¨Ø±Ø§ÛŒ Ù¾ÛŒØ§Ù… Ø¨Ù‡ØªØ±
function scheduleAutoDelete($chat_id, $message_id, $delete_after_seconds = 60, $file_code = null, $user_id = null) {
    global $MySQLi;
    
    $delete_time = time() + $delete_after_seconds;
    
    // Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø§Ø·Ù„Ø§Ø¹â€ŒØ±Ø³Ø§Ù†ÛŒ
    $warning_message = WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "â° Ø§ÛŒÙ† Ù¾ÛŒØ§Ù… Ù¾Ø³ Ø§Ø² " . formatSeconds($delete_after_seconds) . " Ø­Ø°Ù Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.\n\nğŸ“¥ Ù†Ú¯Ø±Ø§Ù† Ù†Ø¨Ø§Ø´ÛŒØ¯ØŒ Ø¯Ø± ØµÙˆØ±Øª Ø­Ø°Ù Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø² Ø¨Ø®Ø´ Â«ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‚Ø§Ø¨Ù„ Ø¯Ø§Ù†Ù„ÙˆØ¯Â» Ù…Ø¬Ø¯Ø¯Ø§Ù‹ Ø¯Ø±ÛŒØ§ÙØª Ú©Ù†ÛŒØ¯.",
        'reply_to_message_id' => $message_id
    ]);
    
    // Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ø­Ø°Ù Ù¾ÛŒØ§Ù… Ø§Ø·Ù„Ø§Ø¹â€ŒØ±Ø³Ø§Ù†ÛŒ Ù‡Ù…
    if ($warning_message->ok) {
        mysqli_query($MySQLi, 
            "INSERT INTO `auto_delete_messages` 
            (`chat_id`, `message_id`, `delete_time`) 
            VALUES ('{$chat_id}', '{$warning_message->result->message_id}', '" . ($delete_time - 10) . "')"
        );
    }
    
    return mysqli_query($MySQLi, 
        "INSERT INTO `auto_delete_messages` 
        (`chat_id`, `message_id`, `delete_time`, `file_code`, `user_id`) 
        VALUES ('{$chat_id}', '{$message_id}', '{$delete_time}', '{$file_code}', '{$user_id}')"
    );
}

// ØªØ§Ø¨Ø¹ ÙØ±Ù…Øªâ€ŒØ¨Ù†Ø¯ÛŒ Ø²Ù…Ø§Ù†
function formatSeconds($seconds) {
    if ($seconds < 60) {
        return $seconds . " Ø«Ø§Ù†ÛŒÙ‡";
    } elseif ($seconds < 3600) {
        return floor($seconds / 60) . " Ø¯Ù‚ÛŒÙ‚Ù‡";
    } else {
        return floor($seconds / 3600) . " Ø³Ø§Ø¹Øª";
    }
}// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø¨Ø®Ø´ Ø§ÛŒØ¬Ø§Ø¯ Ø¬Ø¯Ø§ÙˆÙ„
if ($MySQLi->query("SELECT * FROM `file_interactions`") == false) {
    mysqli_query($MySQLi, "CREATE TABLE `file_interactions` (
        `id` int(11) NOT NULL AUTO_INCREMENT PRIMARY KEY,
        `file_code` varchar(50) NOT NULL,
        `user_id` bigint(20) NOT NULL,
        `interaction_type` enum('view','like','dislike') NOT NULL,
        `interacted_at` timestamp DEFAULT CURRENT_TIMESTAMP,
        INDEX `file_code` (`file_code`),
        INDEX `user_id` (`user_id`),
        UNIQUE KEY `unique_interaction` (`file_code`, `user_id`, `interaction_type`)
    )");
}// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø¨Ø®Ø´ ØªÙˆØ§Ø¨Ø¹
function recordInteraction($file_code, $user_id, $type = 'view') {
    global $MySQLi;
    
    // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø«Ø¨Øª ØªÚ©Ø±Ø§Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ù„Ø§ÛŒÚ©/Ø¯ÛŒØ³Ù„Ø§ÛŒÚ©
    if ($type == 'like' || $type == 'dislike') {
        // Ø­Ø°Ù ØªØ¹Ø§Ù…Ù„ Ù…Ø®Ø§Ù„Ù Ø§Ú¯Ø± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯
        mysqli_query($MySQLi, 
            "DELETE FROM `file_interactions` 
             WHERE `file_code` = '{$file_code}' 
             AND `user_id` = '{$user_id}' 
             AND `interaction_type` IN ('like', 'dislike')"
        );
    }
    
    return mysqli_query($MySQLi, 
        "INSERT INTO `file_interactions` 
        (`file_code`, `user_id`, `interaction_type`) 
        VALUES ('{$file_code}', '{$user_id}', '{$type}')
        ON DUPLICATE KEY UPDATE `interacted_at` = CURRENT_TIMESTAMP"
    );
}

function getFileStats($file_code) {
    global $MySQLi;
    
    $stats = mysqli_fetch_assoc(mysqli_query($MySQLi,
        "SELECT 
            COUNT(CASE WHEN interaction_type = 'view' THEN 1 END) as views,
            COUNT(CASE WHEN interaction_type = 'like' THEN 1 END) as likes,
            COUNT(CASE WHEN interaction_type = 'dislike' THEN 1 END) as dislikes
         FROM `file_interactions` 
         WHERE `file_code` = '{$file_code}'"
    ));
    
    return [
        'views' => $stats['views'] ?: 0,
        'likes' => $stats['likes'] ?: 0,
        'dislikes' => $stats['dislikes'] ?: 0
    ];
}

function getUserInteraction($file_code, $user_id) {
    global $MySQLi;
    
    $result = mysqli_fetch_assoc(mysqli_query($MySQLi,
        "SELECT `interaction_type` 
         FROM `file_interactions` 
         WHERE `file_code` = '{$file_code}' 
         AND `user_id` = '{$user_id}'
         AND `interaction_type` IN ('like', 'dislike')"
    ));
    
    return $result ? $result['interaction_type'] : null;
}

function formatNumber($number) {
    if ($number >= 1000000) {
        return round($number / 1000000, 1) . 'M';
    } elseif ($number >= 1000) {
        return round($number / 1000, 1) . 'K';
    }
    return $number;
}// ØªØ§Ø¨Ø¹ Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ¹Ø§Ù…Ù„
function getInteractionKeyboard($file_code, $user_id = null) {
    $stats = getFileStats($file_code);
    $user_interaction = $user_id ? getUserInteraction($file_code, $user_id) : null;
    
    // Ø§Ù†ØªØ®Ø§Ø¨ Ø§ÛŒÙ…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„/ØºÛŒØ±ÙØ¹Ø§Ù„ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ¹Ø§Ù…Ù„ Ú©Ø§Ø±Ø¨Ø±
    $like_emoji = ($user_interaction == 'like') ? 'ğŸ‘' : 'ğŸ‘†';
    $dislike_emoji = ($user_interaction == 'dislike') ? 'ğŸ‘' : 'ğŸ‘‡';
    
    $keyboard = [
        'inline_keyboard' => [
            [
                [
                    'text' => "{$like_emoji} " . formatNumber($stats['likes']),
                    'callback_data' => "like_{$file_code}"
                ],
                [
                    'text' => "ğŸ‘ " . formatNumber($stats['views']),
                    'callback_data' => "view_{$file_code}"
                ],
                [
                    'text' => "{$dislike_emoji} " . formatNumber($stats['dislikes']),
                    'callback_data' => "dislike_{$file_code}"
                ]
            ],
            [
                [
                    'text' => "ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù…Ø¬Ø¯Ø¯",
                    'callback_data' => "redownload_{$file_code}"
                ],
                [
                    'text' => "ğŸ”„ Ø§Ø´ØªØ±Ø§Ú© Ú¯Ø°Ø§Ø±ÛŒ",
                    'callback_data' => "share_{$file_code}"
                ]
            ]
        ]
    ];
    
    return json_encode($keyboard);
}// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø¨Ø®Ø´ callback_query
elseif (strpos($data, "like_") === 0) {
    $file_code = str_replace("like_", "", $data);
    recordInteraction($file_code, $fromid, 'like');
    
    // Ø¢Ù¾Ø¯ÛŒØª Ú©ÛŒØ¨ÙˆØ±Ø¯
    $new_keyboard = getInteractionKeyboard($file_code, $fromid);
    WSBot('editmessagereplymarkup', [
        'chat_id' => $chatid,
        'message_id' => $messageid,
        'reply_markup' => $new_keyboard
    ]);
    
    WSBot('answercallbackquery', [
        'callback_query_id' => $membercall,
        'text' => "ğŸ‘ Ù„Ø§ÛŒÚ© Ø´Ù…Ø§ Ø«Ø¨Øª Ø´Ø¯!",
        'show_alert' => false
    ]);
}
elseif (strpos($data, "dislike_") === 0) {
    $file_code = str_replace("dislike_", "", $data);
    recordInteraction($file_code, $fromid, 'dislike');
    
    $new_keyboard = getInteractionKeyboard($file_code, $fromid);
    WSBot('editmessagereplymarkup', [
        'chat_id' => $chatid,
        'message_id' => $messageid,
        'reply_markup' => $new_keyboard
    ]);
    
    WSBot('answercallbackquery', [
        'callback_query_id' => $membercall,
        'text' => "ğŸ‘ Ø¯ÛŒØ³Ù„Ø§ÛŒÚ© Ø´Ù…Ø§ Ø«Ø¨Øª Ø´Ø¯!",
        'show_alert' => false
    ]);
}
elseif (strpos($data, "share_") === 0) {
    $file_code = str_replace("share_", "", $data);
    $file_data = mysqli_fetch_assoc(mysqli_query($MySQLi, 
        "SELECT * FROM `dbfile` WHERE `code` = '{$file_code}'"
    ));
    
    if ($file_data) {
        $share_url = "https://t.me/" . $usernamebot . "?start=_" . $file_code;
        WSBot('answercallbackquery', [
            'callback_query_id' => $membercall,
            'text' => "ğŸ”— Ù„ÛŒÙ†Ú© Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ:\n" . $share_url,
            'show_alert' => true
        ]);
    }
}// ØªØºÛŒÛŒØ± Ø¯Ø± ØªÙ…Ø§Ù… Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ ÙØ§ÛŒÙ„ (Ù…Ø«Ø§Ù„ Ø¨Ø±Ø§ÛŒ document)
if(isset($message->document)) {
    // ... Ú©Ø¯Ù‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯
    
    $file_stats = getFileStats($code);
    recordInteraction($code, $from_id, 'view'); // Ø«Ø¨Øª Ø¨Ø§Ø²Ø¯ÛŒØ¯
    
    $interaction_keyboard = getInteractionKeyboard($code, $from_id);
    
    $success_message = WSBot('senddocument', [
        'chat_id' => $chat_id,
        'document' => $file_id,
        'caption' => "ğŸ“ ÙØ§ÛŒÙ„ Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¢Ù¾Ù„ÙˆØ¯ Ø´Ø¯!\n" .
                    "â–ªï¸ Ø´Ù†Ø§Ø³Ù‡: <code>{$code}</code>\n" .
                    "ğŸ‘ Ø¨Ø§Ø²Ø¯ÛŒØ¯: " . formatNumber($file_stats['views']) . "\n" .
                    "ğŸ‘ Ù„Ø§ÛŒÚ©: " . formatNumber($file_stats['likes']) . " | ğŸ‘ Ø¯ÛŒØ³Ù„Ø§ÛŒÚ©: " . formatNumber($file_stats['dislikes']) . "\n" .
                    "ğŸ“Š Ú©ÛŒÙÛŒØª: 480p BluRay\n" .
                    "ğŸ¬ Ø²ÛŒØ±Ù†ÙˆÛŒØ³: ÙØ§Ø±Ø³ÛŒ Ù‡Ø§Ø±Ø¯Ø³Ø§Ø¨\n\n" .
                    "ğŸ“¥ Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù…Ø¬Ø¯Ø¯ Ø§Ø² Ø¯Ú©Ù…Ù‡ Ø²ÛŒØ± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯:",
        'reply_to_message_id' => $message_id,
        'parse_mode' => "html",
        'reply_markup' => $interaction_keyboard
    ]);
    
    // ... Ø¨Ù‚ÛŒÙ‡ Ú©Ø¯Ù‡Ø§
}// ØªØ§Ø¨Ø¹ Ø§ÛŒØ¬Ø§Ø¯ caption Ù¾ÛŒØ´Ø±ÙØªÙ‡
function getAdvancedCaption($file_data, $include_stats = true) {
    global $usernamebot;
    
    $stats = $include_stats ? getFileStats($file_data['code']) : ['views' => 0, 'likes' => 0, 'dislikes' => 0];
    $file_size = convert($file_data['file_size']);
    $dl = number_format($file_data['dl']);
    
    $caption = "ğŸ¬ " . doc($file_data['file']) . "\n";
    $caption .= "ğŸ’¾ Ø­Ø¬Ù…: " . $file_size . "\n";
    $caption .= "â° Ù…Ø¯Øª Ø²Ù…Ø§Ù†: 1:34:59\n"; // Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø² Ù…ØªØ§Ø¯ÛŒØªØ§ ÙØ§ÛŒÙ„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
    $caption .= "ğŸ“º Ú©ÛŒÙÛŒØª: 480p BluRay\n";
    $caption .= "ğŸ Ø²ÛŒØ±Ù†ÙˆÛŒØ³: ÙØ§Ø±Ø³ÛŒ Ù‡Ø§Ø±Ø¯Ø³Ø§Ø¨\n\n";
    
    if ($include_stats) {
        $caption .= "ğŸ“Š Ø¢Ù…Ø§Ø± ØªØ¹Ø§Ù…Ù„:\n";
        $caption .= "ğŸ‘ Ø¨Ø§Ø²Ø¯ÛŒØ¯: " . formatNumber($stats['views']) . "\n";
        $caption .= "ğŸ‘ Ù„Ø§ÛŒÚ©: " . formatNumber($stats['likes']) . " | ğŸ‘ Ø¯ÛŒØ³Ù„Ø§ÛŒÚ©: " . formatNumber($stats['dislikes']) . "\n";
        $caption .= "ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯: " . $dl . "\n\n";
    }
    
    $caption .= "ğŸ’¡ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ù¾Ø®Ø´:\n";
    $caption .= "â€¢ Android: MX Player\n";
    $caption .= "â€¢ iOS: VLC Player\n";
    $caption .= "â€¢ Windows: Pot Player\n\n";
    
    $caption .= "ğŸ”— @" . $usernamebot . " | @LOVEMOVE11";
    
    return $caption;
}// ØªØ§Ø¨Ø¹ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø² ÙØ§ÛŒÙ„ (Ø¨Ø±Ø§ÛŒ ÙˆÛŒØ¯ÛŒÙˆÙ‡Ø§)
function getFileMetadata($file_id, $file_type) {
    // Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø§Ø·Ù„Ø§Ø¹Ø§ØªÛŒ Ù…Ø§Ù†Ù†Ø¯ Ù…Ø¯Øª Ø²Ù…Ø§Ù† ÙˆÛŒØ¯ÛŒÙˆ Ø±Ø§ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ú©Ù†Ø¯
    // Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ù…Ù‚Ø§Ø¯ÛŒØ± Ø«Ø§Ø¨Øª Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ø§ APIÙ‡Ø§ÛŒ Ø¯ÛŒÚ¯Ø± ØªÚ©Ù…ÛŒÙ„ Ú©Ù†ÛŒØ¯
    return [
        'duration' => '1:34:59',
        'quality' => '480p BluRay',
        'subtitle' => 'ÙØ§Ø±Ø³ÛŒ Ù‡Ø§Ø±Ø¯Ø³Ø§Ø¨'
    ];
}// ØªØ§Ø¨Ø¹ Ø§ÛŒØ¬Ø§Ø¯ Ù¾ÛŒØ§Ù… Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ
function getShareMessage($file_code) {
    global $usernamebot;
    $file_data = mysqli_fetch_assoc(mysqli_query($MySQLi, 
        "SELECT * FROM `dbfile` WHERE `code` = '{$file_code}'"
    ));
    
    if (!$file_data) return null;
    
    $stats = getFileStats($file_code);
    $metadata = getFileMetadata($file_data['file_id'], $file_data['file_type']);
    
    $message = "ğŸ¬ ÙÛŒÙ„Ù… Ø¬Ø¯ÛŒØ¯ Ø¯Ø± Ø¢Ù¾Ù„ÙˆØ¯Ø±!\n\n";
    $message .= "ğŸ“ " . doc($file_data['file']) . "\n";
    $message .= "â° " . $metadata['duration'] . "\n";
    $message .= "ğŸ“º " . $metadata['quality'] . "\n";
    $message .= "ğŸ " . $metadata['subtitle'] . "\n\n";
    $message .= "ğŸ“Š Ø¢Ù…Ø§Ø±: ğŸ‘ " . formatNumber($stats['views']) . " | ğŸ‘ " . formatNumber($stats['likes']) . "\n\n";
    $message .= "ğŸ‘‡ Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø±ÙˆÛŒ Ù„ÛŒÙ†Ú© Ø²ÛŒØ± Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯:\n";
    $message .= "https://t.me/" . $usernamebot . "?start=_" . $file_code;
    
    return $message;
}// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ
elseif ($text == "ğŸ”¥ Ù¾Ø±Ø·Ø±ÙØ¯Ø§Ø±ØªØ±ÛŒÙ†â€ŒÙ‡Ø§") {
    $popular_files = mysqli_query($MySQLi,
        "SELECT f.*, 
                COUNT(CASE WHEN i.interaction_type = 'like' THEN 1 END) as likes,
                COUNT(CASE WHEN i.interaction_type = 'view' THEN 1 END) as views
         FROM `dbfile` f
         LEFT JOIN `file_interactions` i ON f.code = i.file_code
         GROUP BY f.code
         ORDER BY likes DESC, views DESC
         LIMIT 10"
    );
    
    if (mysqli_num_rows($popular_files) > 0) {
        $message = "ğŸ”¥ Ù¾Ø±Ø·Ø±ÙØ¯Ø§Ø±ØªØ±ÛŒÙ† ÙØ§ÛŒÙ„â€ŒÙ‡Ø§:\n\n";
        $counter = 1;
        
        while ($file = mysqli_fetch_assoc($popular_files)) {
            $message .= "{$counter}. ğŸ“ " . doc($file['file']) . "\n";
            $message .= "   ğŸ‘ " . formatNumber($file['likes']) . " | ğŸ‘ " . formatNumber($file['views']) . "\n";
            $message .= "   ğŸ“¥ /dl_{$file['code']}\nâ–â–â–â–â–\n";
            $counter++;
        }
        
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => $message,
            'reply_to_message_id' => $message_id
        ]);
    } else {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "ğŸ“­ Ù‡Ù†ÙˆØ² Ù‡ÛŒÚ† ÙØ§ÛŒÙ„ Ù¾Ø±Ø·Ø±ÙØ¯Ø§Ø±ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.",
            'reply_to_message_id' => $message_id
        ]);
    }
}// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ Ø¬Ø¯ÛŒØ¯ Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ
$menu = json_encode(['keyboard' => [
    [['text' => "ğŸ“‚ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø§Ù¾Ù„ÙˆØ¯"], ['text' =>"ğŸ« Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ"]],
    [['text' =>"ğŸ«Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ"], ['text' => "ğŸ“¥ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‚Ø§Ø¨Ù„ Ø¯Ø§Ù†Ù„ÙˆØ¯"]],
    [['text' => "ğŸ”¥ Ù¾Ø±Ø·Ø±ÙØ¯Ø§Ø±ØªØ±ÛŒÙ†â€ŒÙ‡Ø§"], ['text' => "ğŸ” ØªÙ†Ø¸ÛŒÙ… Ù¾Ø³ÙˆØ±Ø¯"]],
    [['text' => "ğŸ—‘ Ø­Ø°Ù ÙØ§ÛŒÙ„"], ['text' => "ğŸ—‚ Ú©Ø¯ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ ÙØ§ÛŒÙ„"]]
    ], 'resize_keyboard' => true
]);if(isset($message->document)) {
    $file_id = $message->document->file_id;
    $file_size = $message->document->file_size;
    $file = mysqli_fetch_assoc(mysqli_query($MySQLi, "SELECT * FROM `dbfile` WHERE `file_id` = '{$file_id}' LIMIT 1"));
    
    // âŒ Ø­Ø°Ù Ø´Ø±Ø· Ù…Ø­Ø¯ÙˆØ¯ÛŒØª
    if(!$file) {
        file_put_contents("files/$file_id",$message->caption);
        $code = RandomString();
        $size = convert($file_size);
        $time = date('h:i:s');
        $date = date('Y/m/d');
        
        // Ø«Ø¨Øª ØªØ¹Ø§Ù…Ù„
        recordInteraction($code, $from_id, 'view');
        $interaction_keyboard = getInteractionKeyboard($code, $from_id);
        
        WSBot('senddocument', [
            'chat_id' => $chat_id,
            'document' => $file_id,
            'caption' => getAdvancedCaption([
                'code' => $code,
                'file' => 'document',
                'file_size' => $file_size,
                'dl' => 1
            ]),
            'reply_to_message_id' => $message_id,
            'parse_mode' => "html",
            'reply_markup' => $interaction_keyboard
        ]);
        
        $MySQLi->query("INSERT INTO `dbfile` (`code`, `file_id`, `file`, `password`, `file_size`, `user_id`, `date`, `time`, `dl`) VALUES ('{$code}', '{$file_id}', 'document', '', '{$file_size}', '{$from_id}', '{$date}', '{$time}', '1')");
        
        if (!$user) {
            $MySQLi->query("INSERT INTO `user` (`id`, `step`, `upload`, `code`) VALUES ('{$from_id}', 'none', '0', '')");
        } else {
            $MySQLi->query("UPDATE `user` SET `upload` = `upload` + 1 WHERE `id` = '{$from_id}' LIMIT 1");
        }
    } else {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "â–ªï¸ Ø®Ø·Ø§ , Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ù‚Ø¨Ù„Ø§ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø§Ù¾Ù„ÙˆØ¯ Ø´Ø¯Ù‡ Ø§Ø³Øª ... !",
            'reply_to_message_id' => $message_id
        ]);
    }
    // âŒ Ø­Ø°Ù else Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø­Ø¬Ù…
}if(isset($message->video)) {
    $file_id = $message->video->file_id;
    $file_size = $message->video->file_size;
    $file = mysqli_fetch_assoc(mysqli_query($MySQLi, "SELECT * FROM `dbfile` WHERE `file_id` = '{$file_id}' LIMIT 1"));
    
    // âŒ Ø­Ø°Ù Ø´Ø±Ø· Ù…Ø­Ø¯ÙˆØ¯ÛŒØª
    if(!$file) {
        file_put_contents("files/$file_id",$message->caption);
        $code = RandomString();
        $size = convert($file_size);
        $time = date('h:i:s');
        $date = date('Y/m/d');
        
        // Ø«Ø¨Øª ØªØ¹Ø§Ù…Ù„
        recordInteraction($code, $from_id, 'view');
        $interaction_keyboard = getInteractionKeyboard($code, $from_id);
        
        WSBot('sendvideo', [
            'chat_id' => $chat_id,
            'video' => $file_id,
            'caption' => getAdvancedCaption([
                'code' => $code,
                'file' => 'video',
                'file_size' => $file_size,
                'dl' => 1
            ]),
            'reply_to_message_id' => $message_id,
            'parse_mode' => "html",
            'reply_markup' => $interaction_keyboard
        ]);
        
        $MySQLi->query("INSERT INTO `dbfile` (`code`, `file_id`, `file`, `password`, `file_size`, `user_id`, `date`, `time`, `dl`) VALUES ('{$code}', '{$file_id}', 'video', '', '{$file_size}', '{$from_id}', '{$date}', '{$time}', '1')");
        
        if (!$user) {
            $MySQLi->query("INSERT INTO `user` (`id`, `step`, `upload`, `code`) VALUES ('{$from_id}', 'none', '0', '')");
        } else {
            $MySQLi->query("UPDATE `user` SET `upload` = `upload` + 1 WHERE `id` = '{$from_id}' LIMIT 1");
        }
    } else {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "â–ªï¸ Ø®Ø·Ø§ , Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ù‚Ø¨Ù„Ø§ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø§Ù¾Ù„ÙˆØ¯ Ø´Ø¯Ù‡ Ø§Ø³Øª ... !",
            'reply_to_message_id' => $message_id
        ]);
    }
    // âŒ Ø­Ø°Ù else Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø­Ø¬Ù…
}if(isset($message->photo)) {
    $photo = $message->photo;
    $file_id = $photo[count($photo)-1]->file_id;
    $file_size = $photo[count($photo)-1]->file_size;
    $file = mysqli_fetch_assoc(mysqli_query($MySQLi, "SELECT * FROM `dbfile` WHERE `file_id` = '{$file_id}' LIMIT 1"));
    
    // âŒ Ø­Ø°Ù Ø´Ø±Ø· Ù…Ø­Ø¯ÙˆØ¯ÛŒØª
    if(!$file) {
        file_put_contents("files/$file_id",$message->caption);
        $code = RandomString();
        $size = convert($file_size);
        $time = date('h:i:s');
        $date = date('Y/m/d');
        
        // Ø«Ø¨Øª ØªØ¹Ø§Ù…Ù„
        recordInteraction($code, $from_id, 'view');
        $interaction_keyboard = getInteractionKeyboard($code, $from_id);
        
        WSBot('sendphoto', [
            'chat_id' => $chat_id,
            'photo' => $file_id,
            'caption' => getAdvancedCaption([
                'code' => $code,
                'file' => 'photo',
                'file_size' => $file_size,
                'dl' => 1
            ]),
            'reply_to_message_id' => $message_id,
            'parse_mode' => "html",
            'reply_markup' => $interaction_keyboard
        ]);
        
        $MySQLi->query("INSERT INTO `dbfile` (`code`, `file_id`, `file`, `password`, `file_size`, `user_id`, `date`, `time`, `dl`) VALUES ('{$code}', '{$file_id}', 'photo', '', '{$file_size}', '{$from_id}', '{$date}', '{$time}', '1')");
        
        if (!$user) {
            $MySQLi->query("INSERT INTO `user` (`id`, `step`, `upload`, `code`) VALUES ('{$from_id}', 'none', '0', '')");
        } else {
            $MySQLi->query("UPDATE `user` SET `upload` = `upload` + 1 WHERE `id` = '{$from_id}' LIMIT 1");
        }
    } else {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "â–ªï¸ Ø®Ø·Ø§ , Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ù‚Ø¨Ù„Ø§ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø§Ù¾Ù„ÙˆØ¯ Ø´Ø¯Ù‡ Ø§Ø³Øª ... !",
            'reply_to_message_id' => $message_id
        ]);
    }
    // âŒ Ø­Ø°Ù else Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø­Ø¬Ù…
}if(isset($message->voice)) {
    $file_id = $message->voice->file_id;
    $file_size = $message->voice->file_size;
    $file = mysqli_fetch_assoc(mysqli_query($MySQLi, "SELECT * FROM `dbfile` WHERE `file_id` = '{$file_id}' LIMIT 1"));
    
    // âŒ Ø­Ø°Ù Ø´Ø±Ø· Ù…Ø­Ø¯ÙˆØ¯ÛŒØª
    if(!$file) {
        file_put_contents("files/$file_id",$message->caption);
        $code = RandomString();
        $size = convert($file_size);
        $time = date('h:i:s');
        $date = date('Y/m/d');
        
        // Ø«Ø¨Øª ØªØ¹Ø§Ù…Ù„
        recordInteraction($code, $from_id, 'view');
        $interaction_keyboard = getInteractionKeyboard($code, $from_id);
        
        WSBot('sendvoice', [
            'chat_id' => $chat_id,
            'voice' => $file_id,
            'caption' => getAdvancedCaption([
                'code' => $code,
                'file' => 'voice',
                'file_size' => $file_size,
                'dl' => 1
            ]),
            'reply_to_message_id' => $message_id,
            'parse_mode' => "html",
            'reply_markup' => $interaction_keyboard
        ]);
        
        $MySQLi->query("INSERT INTO `dbfile` (`code`, `file_id`, `file`, `password`, `file_size`, `user_id`, `date`, `time`, `dl`) VALUES ('{$code}', '{$file_id}', 'voice', '', '{$file_size}', '{$from_id}', '{$date}', '{$time}', '1')");
        
        if (!$user) {
            $MySQLi->query("INSERT INTO `user` (`id`, `step`, `upload`, `code`) VALUES ('{$from_id}', 'none', '0', '')");
        } else {
            $MySQLi->query("UPDATE `user` SET `upload` = `upload` + 1 WHERE `id` = '{$from_id}' LIMIT 1");
        }
    } else {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "â–ªï¸ Ø®Ø·Ø§ , Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ù‚Ø¨Ù„Ø§ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø§Ù¾Ù„ÙˆØ¯ Ø´Ø¯Ù‡ Ø§Ø³Øª ... !",
            'reply_to_message_id' => $message_id
        ]);
    }
    // âŒ Ø­Ø°Ù else Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø­Ø¬Ù…
}if(isset($message->audio)) {
    $file_id = $message->audio->file_id;
    $file_size = $message->audio->file_size;
    $file = mysqli_fetch_assoc(mysqli_query($MySQLi, "SELECT * FROM `dbfile` WHERE `file_id` = '{$file_id}' LIMIT 1"));
    
    // âŒ Ø­Ø°Ù Ø´Ø±Ø· Ù…Ø­Ø¯ÙˆØ¯ÛŒØª
    if(!$file) {
        file_put_contents("files/$file_id",$message->caption);
        $code = RandomString();
        $size = convert($file_size);
        $time = date('h:i:s');
        $date = date('Y/m/d');
        
        // Ø«Ø¨Øª ØªØ¹Ø§Ù…Ù„
        recordInteraction($code, $from_id, 'view');
        $interaction_keyboard = getInteractionKeyboard($code, $from_id);
        
        WSBot('sendaudio', [
            'chat_id' => $chat_id,
            'audio' => $file_id,
            'caption' => getAdvancedCaption([
                'code' => $code,
                'file' => 'audio',
                'file_size' => $file_size,
                'dl' => 1
            ]),
            'reply_to_message_id' => $message_id,
            'parse_mode' => "html",
            'reply_markup' => $interaction_keyboard
        ]);
        
        $MySQLi->query("INSERT INTO `dbfile` (`code`, `file_id`, `file`, `password`, `file_size`, `user_id`, `date`, `time`, `dl`) VALUES ('{$code}', '{$file_id}', 'audio', '', '{$file_size}', '{$from_id}', '{$date}', '{$time}', '1')");
        
        if (!$user) {
            $MySQLi->query("INSERT INTO `user` (`id`, `step`, `upload`, `code`) VALUES ('{$from_id}', 'none', '0', '')");
        } else {
            $MySQLi->query("UPDATE `user` SET `upload` = `upload` + 1 WHERE `id` = '{$from_id}' LIMIT 1");
        }
    } else {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "â–ªï¸ Ø®Ø·Ø§ , Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ù‚Ø¨Ù„Ø§ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø§Ù¾Ù„ÙˆØ¯ Ø´Ø¯Ù‡ Ø§Ø³Øª ... !",
            'reply_to_message_id' => $message_id
        ]);
    }
    // âŒ Ø­Ø°Ù else Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø­Ø¬Ù…
}if(isset($message->sticker)) {
    $file_id = $message->sticker->file_id;
    $file_size = $message->sticker->file_size;
    $file = mysqli_fetch_assoc(mysqli_query($MySQLi, "SELECT * FROM `dbfile` WHERE `file_id` = '{$file_id}' LIMIT 1"));
    
    // âŒ Ø­Ø°Ù Ø´Ø±Ø· Ù…Ø­Ø¯ÙˆØ¯ÛŒØª
    if(!$file) {
        $code = RandomString();
        $size = convert($file_size);
        $time = date('h:i:s');
        $date = date('Y/m/d');
        
        // Ø«Ø¨Øª ØªØ¹Ø§Ù…Ù„
        recordInteraction($code, $from_id, 'view');
        $interaction_keyboard = getInteractionKeyboard($code, $from_id);
        
        WSBot('sendsticker', [
            'chat_id' => $chat_id,
            'sticker' => $file_id,
            'reply_to_message_id' => $message_id
        ]);
        
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => getAdvancedCaption([
                'code' => $code,
                'file' => 'sticker',
                'file_size' => $file_size,
                'dl' => 1
            ]),
            'parse_mode' => "html",
            'reply_markup' => $interaction_keyboard
        ]);
        
        $MySQLi->query("INSERT INTO `dbfile` (`code`, `file_id`, `file`, `password`, `file_size`, `user_id`, `date`, `time`, `dl`) VALUES ('{$code}', '{$file_id}', 'sticker', '', '{$file_size}', '{$from_id}', '{$date}', '{$time}', '1')");
        
        if (!$user) {
            $MySQLi->query("INSERT INTO `user` (`id`, `step`, `upload`, `code`) VALUES ('{$from_id}', 'none', '0', '')");
        } else {
            $MySQLi->query("UPDATE `user` SET `upload` = `upload` + 1 WHERE `id` = '{$from_id}' LIMIT 1");
        }
    } else {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "â–ªï¸ Ø®Ø·Ø§ , Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ù‚Ø¨Ù„Ø§ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø§Ù¾Ù„ÙˆØ¯ Ø´Ø¯Ù‡ Ø§Ø³Øª ... !",
            'reply_to_message_id' => $message_id
        ]);
    }
    // âŒ Ø­Ø°Ù else Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø­Ø¬Ù…
}function convert($size){
    $units = ['B', 'KB', 'MB', 'GB', 'TB', 'PB'];
    $i = floor(log($size, 1024));
    
    // Ø¨Ø±Ø§ÛŒ Ø­Ø¬Ù…â€ŒÙ‡Ø§ÛŒ Ø¨Ø³ÛŒØ§Ø± Ø¨Ø²Ø±Ú¯
    if ($i >= 5) {
        return round($size / pow(1024, 5), 2) . ' PB';
    }
    
    return round($size / pow(1024, $i), 2) . ' ' . $units[$i];
}if (preg_match('/^\/(start)$/i', $text) or $text == "ğŸ”™") {
    $admin_status = "";
    if (isAdmin($from_id)) {
        if ($from_id == 414816264) {
            $admin_status = "\n\nğŸ‘‘ Ø´Ù…Ø§ Ø§Ø¯Ù…ÛŒÙ† Ø§ØµÙ„ÛŒ Ø§ÛŒÙ† Ø±Ø¨Ø§Øª Ù‡Ø³ØªÛŒØ¯!";
        } else {
            $admin_status = "\n\nâš¡ Ø´Ù…Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ø¯Ù…ÛŒÙ† Ø¯Ø§Ø±ÛŒØ¯!";
        }
    }
    
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "ğŸ‘¤ Ø³Ù„Ø§Ù… <code>$first_name</code>\nğŸ¤– Ø¨Ù‡ Ø±Ø¨Ø§Øª Ú©Ù„ÛŒÙ¾ Ú©Ù¾Ø´Ù† Ø®ÙˆØ´ Ø§Ù…Ø¯ÛŒØ¯!{$admin_status}\n\nğŸ· Ø§Ù¾Ù„ÙˆØ¯ Ø±Ø§ÛŒÚ¯Ø§Ù† Ùˆ Ø¯Ø§Ø¦Ù… ÙØ§ÛŒÙ„ Ù‡Ø§ Ø¨Ø¯ÙˆÙ† Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø­Ø¬Ù…ÛŒ!\n\nğŸš¦ Ø´Ù…Ø§ Ù…ÛŒØªÙˆØ§Ù†ÛŒØ¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø§ Ù‡Ø± Ø­Ø¬Ù…ÛŒ (Ø¹Ú©Ø³ , ÙÛŒÙ„Ù… , Ú¯ÛŒÙ , Ø§Ø³ØªÛŒÚ©Ø± Ùˆ ...) Ø¯Ø± Ø±Ø¨Ø§Øª Ø§Ù¾Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯\n\nğŸ“¤ Ù‡Ù…ÛŒÙ† Ø§Ù„Ø§Ù† ÙØ§ÛŒÙ„Ø§ØªÙˆ Ø§Ù¾Ù„ÙˆØ¯ Ú©Ù† Ùˆ Ù„Ø°ØªØ´Ùˆ Ø¨Ø¨Ø±!\n\nğŸ¤– @$usernamebot\nğŸ“¢ @{$Config['channel']}",
        'reply_to_message_id' => $message_id,
        'parse_mode' => "html",
        'reply_markup' => $menu
    ]);
    
    // ... Ø¨Ù‚ÛŒÙ‡ Ú©Ø¯
}// ØªØ§Ø¨Ø¹ Ø¨Ø±Ø±Ø³ÛŒ Ø§Ù…Ú©Ø§Ù† Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø²Ø±Ú¯
function canHandleLargeFiles() {
    // Ø¨Ø±Ø±Ø³ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³Ø±ÙˆØ± Ø¨Ø±Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø²Ø±Ú¯
    $max_upload = ini_get('upload_max_filesize');
    $max_post = ini_get('post_max_size');
    $memory_limit = ini_get('memory_limit');
    
    return [
        'upload_max_filesize' => $max_upload,
        'post_max_size' => $max_post,
        'memory_limit' => $memory_limit,
        'can_handle_large' => true // Ù‡Ù…ÛŒØ´Ù‡ true Ú†ÙˆÙ† Ø§Ø² file_id Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
    ];
}

// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø¨Ø®Ø´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø±Ø¨Ø§Øª Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ù…ÛŒÙ†
elseif ($text == "ğŸ–¥ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³Ø±ÙˆØ±") {
    if (isAdmin($from_id)) {
        $server_info = canHandleLargeFiles();
        $info_message = "ğŸ–¥ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³Ø±ÙˆØ±:\n\n";
        $info_message .= "ğŸ“ upload_max_filesize: " . $server_info['upload_max_filesize'] . "\n";
        $info_message .= "ğŸ“® post_max_size: " . $server_info['post_max_size'] . "\n";
        $info_message .= "ğŸ’¾ memory_limit: " . $server_info['memory_limit'] . "\n";
        $info_message .= "ğŸš€ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø²Ø±Ú¯: âœ… ÙØ¹Ø§Ù„\n";
        $info_message .= "ğŸ“Š Ø­Ø¯Ø§Ú©Ø«Ø± Ø­Ø¬Ù…: Ù†Ø§Ù…Ø­Ø¯ÙˆØ¯ (Ù…Ø·Ø§Ø¨Ù‚ Ø¨Ø§ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª ØªÙ„Ú¯Ø±Ø§Ù…)";
        
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => $info_message,
            'reply_to_message_id' => $message_id
        ]);
    }
}if (isAdmin($from_id)) {
    $panel = json_encode(['keyboard' => [
        [['text' => "ğŸ‘¤ Ø§Ù…Ø§Ø± Ø±Ø¨Ø§Øª"]],
        [['text' => "ğŸ‘¥ Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§"]],
        [['text' => "â° Ù…Ø¯ÛŒØ±ÛŒØª Ø­Ø°Ù Ø®ÙˆØ¯Ú©Ø§Ø±"], ['text' => "ğŸ–¥ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³Ø±ÙˆØ±"]],
        [['text' => "ğŸ“ª Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ù‡Ù…Ù‡"], ['text' => "ğŸ“ª ÙÙˆØ±ÙˆØ§Ø±Ø¯ Ø¨Ù‡ Ù‡Ù…Ù‡"]],
        [['text' => "ğŸ”™"]]
        ], 'resize_keyboard' => true
    ]);
}# Ø¯Ø± ÙØ§ÛŒÙ„ php.ini Ø§ÛŒÙ† ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯:
upload_max_filesize = 2G
post_max_size = 2G
memory_limit = 1G
max_execution_time = 300// Ø§ÙØ²Ø§ÛŒØ´ Ø²Ù…Ø§Ù† Ø§Ø¬Ø±Ø§ Ø¨Ø±Ø§ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø²Ø±Ú¯
set_time_limit(300); // 5 Ø¯Ù‚ÛŒÙ‚Ù‡

// Ù…Ø¯ÛŒØ±ÛŒØª Ø­Ø§ÙØ¸Ù‡ Ø¨Ù‡ØªØ±
ini_set('memory_limit', '1G');// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø¨Ø®Ø´ Ø§ÛŒØ¬Ø§Ø¯ Ø¬Ø¯Ø§ÙˆÙ„
if ($MySQLi->query("SELECT * FROM `file_metadata`") == false) {
    mysqli_query($MySQLi, "CREATE TABLE `file_metadata` (
        `id` int(11) NOT NULL AUTO_INCREMENT PRIMARY KEY,
        `file_code` varchar(50) NOT NULL UNIQUE,
        `file_id` varchar(200) NOT NULL,
        `user_id` bigint(20) NOT NULL,
        `caption` text CHARACTER SET utf8mb4,
        `custom_title` varchar(255) DEFAULT NULL,
        `description` text CHARACTER SET utf8mb4,
        `tags` varchar(500) DEFAULT NULL,
        `is_public` tinyint(1) DEFAULT 1,
        `created_at` timestamp DEFAULT CURRENT_TIMESTAMP,
        `updated_at` timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
        INDEX `file_code` (`file_code`),
        INDEX `user_id` (`user_id`)
    )");
}// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø¨Ø®Ø´ ØªÙˆØ§Ø¨Ø¹
function saveFileMetadata($file_code, $file_id, $user_id, $caption = '', $custom_title = null) {
    global $MySQLi;
    
    $caption = mysqli_real_escape_string($MySQLi, $caption);
    $custom_title = mysqli_real_escape_string($MySQLi, $custom_title);
    
    return mysqli_query($MySQLi, 
        "INSERT INTO `file_metadata` 
        (`file_code`, `file_id`, `user_id`, `caption`, `custom_title`) 
        VALUES ('{$file_code}', '{$file_id}', '{$user_id}', '{$caption}', '{$custom_title}')
        ON DUPLICATE KEY UPDATE 
        `caption` = '{$caption}',
        `custom_title` = '{$custom_title}',
        `updated_at` = CURRENT_TIMESTAMP"
    );
}

function getFileMetadata($file_code) {
    global $MySQLi;
    
    $result = mysqli_fetch_assoc(mysqli_query($MySQLi,
        "SELECT * FROM `file_metadata` WHERE `file_code` = '{$file_code}'"
    ));
    
    return $result ?: [];
}

function updateFileCaption($file_code, $new_caption) {
    global $MySQLi;
    
    $new_caption = mysqli_real_escape_string($MySQLi, $new_caption);
    
    // Ø¢Ù¾Ø¯ÛŒØª Ù‡Ù… Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ùˆ Ù‡Ù… Ø¯Ø± ÙØ§ÛŒÙ„
    $metadata = getFileMetadata($file_code);
    if ($metadata) {
        file_put_contents("files/{$metadata['file_id']}", $new_caption);
    }
    
    return mysqli_query($MySQLi,
        "UPDATE `file_metadata` 
         SET `caption` = '{$new_caption}', `updated_at` = CURRENT_TIMESTAMP 
         WHERE `file_code` = '{$file_code}'"
    );
}

function deleteFileCompletely($file_code, $user_id) {
    global $MySQLi;
    
    // Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙØ§ÛŒÙ„
    $file_data = mysqli_fetch_assoc(mysqli_query($MySQLi,
        "SELECT * FROM `dbfile` WHERE `code` = '{$file_code}' AND `user_id` = '{$user_id}'"
    ));
    
    if ($file_data) {
        // Ø­Ø°Ù Ø§Ø² Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø§ØµÙ„ÛŒ
        mysqli_query($MySQLi, "DELETE FROM `dbfile` WHERE `code` = '{$file_code}'");
        
        // Ø­Ø°Ù Ù…ØªØ§Ø¯ÛŒØªØ§
        mysqli_query($MySQLi, "DELETE FROM `file_metadata` WHERE `file_code` = '{$file_code}'");
        
        // Ø­Ø°Ù ØªØ¹Ø§Ù…Ù„Ø§Øª
        mysqli_query($MySQLi, "DELETE FROM `file_interactions` WHERE `file_code` = '{$file_code}'");
        
        // Ø­Ø°Ù ÙØ§ÛŒÙ„ Ú©Ù¾Ø´Ù† (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
        if (file_exists("files/{$file_data['file_id']}")) {
            unlink("files/{$file_data['file_id']}");
        }
        
        return true;
    }
    
    return false;
}// Ù…Ù†ÙˆÛŒ Ù…Ø¯ÛŒØ±ÛŒØª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
$file_management = json_encode(['keyboard' => [
    [['text' => "âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ù¾Ø´Ù†"], ['text' => "ğŸ“ ØªØºÛŒÛŒØ± Ø¹Ù†ÙˆØ§Ù†"]],
    [['text' => "ğŸ· Ø§ÙØ²ÙˆØ¯Ù† ØªÚ¯"], ['text' => "ğŸ‘ ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ø¹Ù…ÙˆÙ…ÛŒ"]],
    [['text' => "ğŸ—‘ Ø­Ø°Ù Ú©Ø§Ù…Ù„ ÙØ§ÛŒÙ„"]],
    [['text' => "ğŸ”™ Ø¨Ø±Ú¯Ø´Øª"]]
    ], 'resize_keyboard' => true
]);// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ
elseif ($text == "ğŸ›  Ù…Ø¯ÛŒØ±ÛŒØª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§") {
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "ğŸ›  Ù…Ø¯ÛŒØ±ÛŒØª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø´Ù…Ø§\n\nØ§Ø² Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯:",
        'reply_to_message_id' => $message_id,
        'reply_markup' => $file_management
    ]);
    $MySQLi->query("UPDATE `user` SET `step` = 'file_management' WHERE `id` = '{$from_id}' LIMIT 1");
}

// ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ù¾Ø´Ù†
elseif ($text == "âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ù¾Ø´Ù†") {
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ù¾Ø´Ù† ÙØ§ÛŒÙ„\n\nÙ„Ø·ÙØ§Ù‹ Ø´Ù†Ø§Ø³Ù‡ ÙØ§ÛŒÙ„ Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯:",
        'reply_to_message_id' => $message_id,
        'reply_markup' => $back
    ]);
    $MySQLi->query("UPDATE `user` SET `step` = 'edit_caption_code' WHERE `id` = '{$from_id}' LIMIT 1");
}

// ØªØºÛŒÛŒØ± Ø¹Ù†ÙˆØ§Ù†
elseif ($text == "ğŸ“ ØªØºÛŒÛŒØ± Ø¹Ù†ÙˆØ§Ù†") {
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "ğŸ“ ØªØºÛŒÛŒØ± Ø¹Ù†ÙˆØ§Ù† ÙØ§ÛŒÙ„\n\nÙ„Ø·ÙØ§Ù‹ Ø´Ù†Ø§Ø³Ù‡ ÙØ§ÛŒÙ„ Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯:",
        'reply_to_message_id' => $message_id,
        'reply_markup' => $back
    ]);
    $MySQLi->query("UPDATE `user` SET `step` = 'edit_title_code' WHERE `id` = '{$from_id}' LIMIT 1");
}

// Ø­Ø°Ù Ú©Ø§Ù…Ù„ ÙØ§ÛŒÙ„
elseif ($text == "ğŸ—‘ Ø­Ø°Ù Ú©Ø§Ù…Ù„ ÙØ§ÛŒÙ„") {
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "ğŸ—‘ Ø­Ø°Ù Ú©Ø§Ù…Ù„ ÙØ§ÛŒÙ„\n\nØ§ÛŒÙ† Ø¹Ù…Ù„ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø³Øª!\nÙ„Ø·ÙØ§Ù‹ Ø´Ù†Ø§Ø³Ù‡ ÙØ§ÛŒÙ„ Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯:",
        'reply_to_message_id' => $message_id,
        'reply_markup' => $back
    ]);
    $MySQLi->query("UPDATE `user` SET `step` = 'delete_file_code' WHERE `id` = '{$from_id}' LIMIT 1");
}// Ù¾Ø±Ø¯Ø§Ø²Ø´ ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ù¾Ø´Ù†
elseif ($user['step'] == 'edit_caption_code') {
    $file_data = mysqli_fetch_assoc(mysqli_query($MySQLi,
        "SELECT * FROM `dbfile` WHERE `code` = '{$text}' AND `user_id` = '{$from_id}'"
    ));
    
    if ($file_data) {
        $current_metadata = getFileMetadata($text);
        $current_caption = $current_metadata['caption'] ?: 'Ø¨Ø¯ÙˆÙ† Ú©Ù¾Ø´Ù†';
        
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ù¾Ø´Ù† ÙØ§ÛŒÙ„\n\nÚ©Ù¾Ø´Ù† ÙØ¹Ù„ÛŒ:\n{$current_caption}\n\nÙ„Ø·ÙØ§Ù‹ Ú©Ù¾Ø´Ù† Ø¬Ø¯ÛŒØ¯ Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯:",
            'reply_to_message_id' => $message_id,
            'reply_markup' => $back
        ]);
        
        $MySQLi->query("UPDATE `user` SET `step` = 'edit_caption_text', `code` = '{$text}' WHERE `id` = '{$from_id}' LIMIT 1");
    } else {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "âŒ ÙØ§ÛŒÙ„ ÛŒØ§ÙØª Ù†Ø´Ø¯ ÛŒØ§ Ø´Ù…Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯!",
            'reply_to_message_id' => $message_id
        ]);
    }
}

elseif ($user['step'] == 'edit_caption_text') {
    $file_code = $user['code'];
    
    if (updateFileCaption($file_code, $text)) {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "âœ… Ú©Ù¾Ø´Ù† ÙØ§ÛŒÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯!",
            'reply_to_message_id' => $message_id,
            'reply_markup' => $file_management
        ]);
    } else {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "âŒ Ø®Ø·Ø§ Ø¯Ø± ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ù¾Ø´Ù†!",
            'reply_to_message_id' => $message_id
        ]);
    }
    
    $MySQLi->query("UPDATE `user` SET `step` = 'file_management', `code` = '' WHERE `id` = '{$from_id}' LIMIT 1");
}

// Ù¾Ø±Ø¯Ø§Ø²Ø´ ØªØºÛŒÛŒØ± Ø¹Ù†ÙˆØ§Ù†
elseif ($user['step'] == 'edit_title_code') {
    $file_data = mysqli_fetch_assoc(mysqli_query($MySQLi,
        "SELECT * FROM `dbfile` WHERE `code` = '{$text}' AND `user_id` = '{$from_id}'"
    ));
    
    if ($file_data) {
        $current_metadata = getFileMetadata($text);
        $current_title = $current_metadata['custom_title'] ?: 'Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù† Ø³ÙØ§Ø±Ø´ÛŒ';
        
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "ğŸ“ ØªØºÛŒÛŒØ± Ø¹Ù†ÙˆØ§Ù† ÙØ§ÛŒÙ„\n\nØ¹Ù†ÙˆØ§Ù† ÙØ¹Ù„ÛŒ:\n{$current_title}\n\nÙ„Ø·ÙØ§Ù‹ Ø¹Ù†ÙˆØ§Ù† Ø¬Ø¯ÛŒØ¯ Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯:",
            'reply_to_message_id' => $message_id,
            'reply_markup' => $back
        ]);
        
        $MySQLi->query("UPDATE `user` SET `step` = 'edit_title_text', `code` = '{$text}' WHERE `id` = '{$from_id}' LIMIT 1");
    } else {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "âŒ ÙØ§ÛŒÙ„ ÛŒØ§ÙØª Ù†Ø´Ø¯ ÛŒØ§ Ø´Ù…Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯!",
            'reply_to_message_id' => $message_id
        ]);
    }
}

elseif ($user['step'] == 'edit_title_text') {
    $file_code = $user['code'];
    
    $new_title = mysqli_real_escape_string($MySQLi, $text);
    mysqli_query($MySQLi,
        "UPDATE `file_metadata` 
         SET `custom_title` = '{$new_title}', `updated_at` = CURRENT_TIMESTAMP 
         WHERE `file_code` = '{$file_code}'"
    );
    
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "âœ… Ø¹Ù†ÙˆØ§Ù† ÙØ§ÛŒÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªØºÛŒÛŒØ± Ú©Ø±Ø¯!",
        'reply_to_message_id' => $message_id,
        'reply_markup' => $file_management
    ]);
    
    $MySQLi->query("UPDATE `user` SET `step` = 'file_management', `code` = '' WHERE `id` = '{$from_id}' LIMIT 1");
}

// Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø­Ø°Ù Ú©Ø§Ù…Ù„ ÙØ§ÛŒÙ„
elseif ($user['step'] == 'delete_file_code') {
    $file_code = $text;
    
    if (deleteFileCompletely($file_code, $from_id)) {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "âœ… ÙØ§ÛŒÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯!",
            'reply_to_message_id' => $message_id,
            'reply_markup' => $file_management
        ]);
    } else {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "âŒ Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù ÙØ§ÛŒÙ„!",
            'reply_to_message_id' => $message_id
        ]);
    }
    
    $MySQLi->query("UPDATE `user` SET `step` = 'file_management', `code` = '' WHERE `id` = '{$from_id}' LIMIT 1");
}// ØªØºÛŒÛŒØ± Ø¯Ø± ØªÙ…Ø§Ù… Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ø¢Ù¾Ù„ÙˆØ¯ Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù…ØªØ§Ø¯ÛŒØªØ§
// Ù…Ø«Ø§Ù„ Ø¨Ø±Ø§ÛŒ document:
if(isset($message->document)) {
    $file_id = $message->document->file_id;
    $file_size = $message->document->file_size;
    $file = mysqli_fetch_assoc(mysqli_query($MySQLi, "SELECT * FROM `dbfile` WHERE `file_id` = '{$file_id}' LIMIT 1"));
    
    if(!$file) {
        // Ø°Ø®ÛŒØ±Ù‡ Ú©Ù¾Ø´Ù† Ø¯Ø± ÙØ§ÛŒÙ„
        file_put_contents("files/$file_id", $message->caption ?: '');
        
        $code = RandomString();
        $size = convert($file_size);
        $time = date('h:i:s');
        $date = date('Y/m/d');
        
        // Ø°Ø®ÛŒØ±Ù‡ Ù…ØªØ§Ø¯ÛŒØªØ§ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³
        saveFileMetadata($code, $file_id, $from_id, $message->caption ?: '');
        
        // Ø«Ø¨Øª ØªØ¹Ø§Ù…Ù„
        recordInteraction($code, $from_id, 'view');
        $interaction_keyboard = getInteractionKeyboard($code, $from_id);
        
        $caption = getAdvancedCaption([
            'code' => $code,
            'file' => 'document',
            'file_size' => $file_size,
            'dl' => 1,
            'caption' => $message->caption
        ]);
        
        $success_message = WSBot('senddocument', [
            'chat_id' => $chat_id,
            'document' => $file_id,
            'caption' => $caption,
            'reply_to_message_id' => $message_id,
            'parse_mode' => "html",
            'reply_markup' => $interaction_keyboard
        ]);
        
        $MySQLi->query("INSERT INTO `dbfile` (`code`, `file_id`, `file`, `password`, `file_size`, `user_id`, `date`, `time`, `dl`) VALUES ('{$code}', '{$file_id}', 'document', '', '{$file_size}', '{$from_id}', '{$date}', '{$time}', '1')");
        
        if (!$user) {
            $MySQLi->query("INSERT INTO `user` (`id`, `step`, `upload`, `code`) VALUES ('{$from_id}', 'none', '0', '')");
        } else {
            $MySQLi->query("UPDATE `user` SET `upload` = `upload` + 1 WHERE `id` = '{$from_id}' LIMIT 1");
        }
    }
    // ... Ø¨Ù‚ÛŒÙ‡ Ú©Ø¯
}function getAdvancedCaption($file_data, $include_stats = true) {
    global $usernamebot;
    
    $stats = $include_stats ? getFileStats($file_data['code']) : ['views' => 0, 'likes' => 0, 'dislikes' => 0];
    $file_size = convert($file_data['file_size']);
    $dl = number_format($file_data['dl']);
    
    // Ø¯Ø±ÛŒØ§ÙØª Ù…ØªØ§Ø¯ÛŒØªØ§ Ø§Ø¶Ø§ÙÛŒ
    $metadata = getFileMetadata($file_data['code']);
    $custom_title = $metadata['custom_title'] ?? null;
    $caption = $metadata['caption'] ?? ($file_data['caption'] ?? '');
    
    $final_caption = "";
    
    // Ø¹Ù†ÙˆØ§Ù† Ø³ÙØ§Ø±Ø´ÛŒ ÛŒØ§ Ù¾ÛŒØ´â€ŒÙØ±Ø¶
    if ($custom_title) {
        $final_caption .= "ğŸ¬ " . $custom_title . "\n";
    } else {
        $final_caption .= "ğŸ¬ " . doc($file_data['file']) . "\n";
    }
    
    $final_caption .= "ğŸ’¾ Ø­Ø¬Ù…: " . $file_size . "\n";
    $final_caption .= "â° Ù…Ø¯Øª Ø²Ù…Ø§Ù†: 1:34:59\n";
    $final_caption .= "ğŸ“º Ú©ÛŒÙÛŒØª: 480p BluRay\n";
    $final_caption .= "ğŸ Ø²ÛŒØ±Ù†ÙˆÛŒØ³: ÙØ§Ø±Ø³ÛŒ Ù‡Ø§Ø±Ø¯Ø³Ø§Ø¨\n\n";
    
    // Ú©Ù¾Ø´Ù† Ú©Ø§Ø±Ø¨Ø±
    if ($caption) {
        $final_caption .= "ğŸ“ ØªÙˆØ¶ÛŒØ­Ø§Øª:\n" . $caption . "\n\n";
    }
    
    if ($include_stats) {
        $final_caption .= "ğŸ“Š Ø¢Ù…Ø§Ø± ØªØ¹Ø§Ù…Ù„:\n";
        $final_caption .= "ğŸ‘ Ø¨Ø§Ø²Ø¯ÛŒØ¯: " . formatNumber($stats['views']) . "\n";
        $final_caption .= "ğŸ‘ Ù„Ø§ÛŒÚ©: " . formatNumber($stats['likes']) . " | ğŸ‘ Ø¯ÛŒØ³Ù„Ø§ÛŒÚ©: " . formatNumber($stats['dislikes']) . "\n";
        $final_caption .= "ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯: " . $dl . "\n\n";
    }
    
    $final_caption .= "ğŸ’¡ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ù¾Ø®Ø´:\n";
    $final_caption .= "â€¢ Android: MX Player\n";
    $final_caption .= "â€¢ iOS: VLC Player\n";
    $final_caption .= "â€¢ Windows: Pot Player\n\n";
    
    $final_caption .= "ğŸ”— @" . $usernamebot . " | @LOVEMOVE11";
    
    return $final_caption;
}// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ Ù…Ø¯ÛŒØ±ÛŒØª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
$menu = json_encode(['keyboard' => [
    [['text' => "ğŸ“‚ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø§Ù¾Ù„ÙˆØ¯"], ['text' =>"ğŸ« Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ"]],
    [['text' =>"ğŸ«Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ"], ['text' => "ğŸ“¥ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‚Ø§Ø¨Ù„ Ø¯Ø§Ù†Ù„ÙˆØ¯"]],
    [['text' => "ğŸ”¥ Ù¾Ø±Ø·Ø±ÙØ¯Ø§Ø±ØªØ±ÛŒÙ†â€ŒÙ‡Ø§"], ['text' => "ğŸ›  Ù…Ø¯ÛŒØ±ÛŒØª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§"]],
    [['text' => "ğŸ” ØªÙ†Ø¸ÛŒÙ… Ù¾Ø³ÙˆØ±Ø¯"], ['text' => "ğŸ—‘ Ø­Ø°Ù ÙØ§ÛŒÙ„"]],
    [['text' => "ğŸ—‚ Ú©Ø¯ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ ÙØ§ÛŒÙ„"]]
    ], 'resize_keyboard' => true
]);// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¯Ø³ØªÙˆØ± Ø±ÛŒÙ¾Ù„Ø§ÛŒ Ø¨Ø±Ø§ÛŒ ÙˆÛŒØ±Ø§ÛŒØ´ Ø³Ø±ÛŒØ¹
elseif (strpos($text, '/editcaption') === 0 && isset($message->reply_to_message)) {
    $reply_message = $message->reply_to_message;
    
    // Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ù¾ÛŒØ§Ù… Ø±ÛŒÙ¾Ù„Ø§ÛŒ Ø´Ø¯Ù‡ Ø­Ø§ÙˆÛŒ ÙØ§ÛŒÙ„ Ø§Ø³Øª
    if (isset($reply_message->document) || isset($reply_message->video) || 
        isset($reply_message->photo) || isset($reply_message->audio) || 
        isset($reply_message->voice)) {
        
        // Ø§Ø³ØªØ®Ø±Ø§Ø¬ file_id Ø§Ø² Ù¾ÛŒØ§Ù… Ø±ÛŒÙ¾Ù„Ø§ÛŒ Ø´Ø¯Ù‡
        if (isset($reply_message->document)) {
            $file_id = $reply_message->document->file_id;
        } elseif (isset($reply_message->video)) {
            $file_id = $reply_message->video->file_id;
        } elseif (isset($reply_message->photo)) {
            $photo = $reply_message->photo;
            $file_id = $photo[count($photo)-1]->file_id;
        } elseif (isset($reply_message->audio)) {
            $file_id = $reply_message->audio->file_id;
        } elseif (isset($reply_message->voice)) {
            $file_id = $reply_message->voice->file_id;
        }
        
        // ÛŒØ§ÙØªÙ† file_code Ø§Ø² file_id
        $file_data = mysqli_fetch_assoc(mysqli_query($MySQLi,
            "SELECT * FROM `dbfile` WHERE `file_id` = '{$file_id}' AND `user_id` = '{$from_id}'"
        ));
        
        if ($file_data) {
            $new_caption = str_replace('/editcaption', '', $text);
            if (updateFileCaption($file_data['code'], trim($new_caption))) {
                WSBot('sendmessage', [
                    'chat_id' => $chat_id,
                    'text' => "âœ… Ú©Ù¾Ø´Ù† ÙØ§ÛŒÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯!",
                    'reply_to_message_id' => $message_id
                ]);
            }
        } else {
            WSBot('sendmessage', [
                'chat_id' => $chat_id,
                'text' => "âŒ ÙØ§ÛŒÙ„ ÛŒØ§ÙØª Ù†Ø´Ø¯ ÛŒØ§ Ø´Ù…Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯!",
                'reply_to_message_id' => $message_id
            ]);
        }
    }
}// Ù…Ù†ÙˆÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¹Ø§Ø¯ÛŒ - Ø­Ø°Ù Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø¢Ù¾Ù„ÙˆØ¯
if (isAdmin($from_id)) {
    $menu = json_encode(['keyboard' => [
        [['text' => "ğŸ“‚ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø§Ù¾Ù„ÙˆØ¯"], ['text' =>"ğŸ« Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ"]],
        [['text' =>"ğŸ«Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ"], ['text' => "ğŸ“¥ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‚Ø§Ø¨Ù„ Ø¯Ø§Ù†Ù„ÙˆØ¯"]],
        [['text' => "ğŸ”¥ Ù¾Ø±Ø·Ø±ÙØ¯Ø§Ø±ØªØ±ÛŒÙ†â€ŒÙ‡Ø§"], ['text' => "ğŸ›  Ù…Ø¯ÛŒØ±ÛŒØª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§"]],
        [['text' => "ğŸ” ØªÙ†Ø¸ÛŒÙ… Ù¾Ø³ÙˆØ±Ø¯"], ['text' => "ğŸ—‘ Ø­Ø°Ù ÙØ§ÛŒÙ„"]],
        [['text' => "ğŸ‘¤ Ù…Ø¯ÛŒØ±ÛŒØª"], ['text' => "ğŸ—‚ Ú©Ø¯ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ ÙØ§ÛŒÙ„"]]
        ], 'resize_keyboard' => true
    ]);
} else {
    // Ù…Ù†ÙˆÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¹Ø§Ø¯ÛŒ ÙÙ‚Ø· Ø´Ø§Ù…Ù„ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ùˆ Ø¬Ø³ØªØ¬Ùˆ
    $menu = json_encode(['keyboard' => [
        [['text' => "ğŸ” Ø¬Ø³ØªØ¬ÙˆÛŒ ÙØ§ÛŒÙ„"], ['text' => "ğŸ“¥ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‚Ø§Ø¨Ù„ Ø¯Ø§Ù†Ù„ÙˆØ¯"]],
        [['text' => "ğŸ”¥ Ù¾Ø±Ø·Ø±ÙØ¯Ø§Ø±ØªØ±ÛŒÙ†â€ŒÙ‡Ø§"], ['text' => "ğŸ« Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ"]],
        [['text' => "ğŸ“š Ø±Ø§Ù‡Ù†Ù…Ø§"]]
        ], 'resize_keyboard' => true
    ]);
}// ØªØºÛŒÛŒØ± Ù¾ÛŒØ§Ù… start Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¹Ø§Ø¯ÛŒ
if (preg_match('/^\/(start)$/i', $text) or $text == "ğŸ”™") {
    $admin_status = "";
    if (isAdmin($from_id)) {
        if ($from_id == 414816264) {
            $admin_status = "\n\nğŸ‘‘ Ø´Ù…Ø§ Ø§Ø¯Ù…ÛŒÙ† Ø§ØµÙ„ÛŒ Ø§ÛŒÙ† Ø±Ø¨Ø§Øª Ù‡Ø³ØªÛŒØ¯!";
        } else {
            $admin_status = "\n\nâš¡ Ø´Ù…Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ø¯Ù…ÛŒÙ† Ø¯Ø§Ø±ÛŒØ¯!";
        }
        
        $welcome_text = "ğŸ‘¤ Ø³Ù„Ø§Ù… <code>$first_name</code>\nğŸ¤– Ø¨Ù‡ Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ø±Ø¨Ø§Øª Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!{$admin_status}";
    } else {
        $welcome_text = "ğŸ‘¤ Ø³Ù„Ø§Ù… <code>$first_name</code>\nğŸ¤– Ø¨Ù‡ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø§ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!\n\nğŸ“š Ø¯Ø± Ø§ÛŒÙ† Ø±Ø¨Ø§Øª Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù Ø±Ø§ Ø¬Ø³ØªØ¬Ùˆ Ùˆ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯.\n\nğŸ” Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Ø§Ø² Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯:";
    }
    
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => $welcome_text . "\n\nğŸ¤– @$usernamebot\nğŸ“¢ @{$Config['channel']}",
        'reply_to_message_id' => $message_id,
        'parse_mode' => "html",
        'reply_markup' => $menu
    ]);
    
    if (!$user) {
        $MySQLi->query("INSERT INTO `user` (`id`, `step`, `upload`, `code`) VALUES ('{$from_id}', 'none', '0', '')");
    } else {
        $MySQLi->query("UPDATE `user` SET `step` = 'none', `code` = '' WHERE `id` = '{$from_id}' LIMIT 1");
    }
}// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø¯Ù…ÛŒÙ† Ù‚Ø¨Ù„ Ø§Ø² Ù‡Ø± Ø¢Ù¾Ù„ÙˆØ¯
if(isset($message->document)) {
    // Ø¨Ø±Ø±Ø³ÛŒ Ø¢ÛŒØ§ Ú©Ø§Ø±Ø¨Ø± Ø§Ø¯Ù…ÛŒÙ† Ø§Ø³Øª
    if (!isAdmin($from_id)) {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "âŒ Ø´Ù…Ø§ Ù…Ø¬ÙˆØ² Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ Ù†Ø¯Ø§Ø±ÛŒØ¯!\n\nÙÙ‚Ø· Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§ÛŒ Ø±Ø¨Ø§Øª Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ ÙØ§ÛŒÙ„ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†Ù†Ø¯.",
            'reply_to_message_id' => $message_id
        ]);
        exit();
    }
    
    // Ø¨Ù‚ÛŒÙ‡ Ú©Ø¯Ù‡Ø§ÛŒ Ø¢Ù¾Ù„ÙˆØ¯ ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§
    $file_id = $message->document->file_id;
    $file_size = $message->document->file_size;
    // ... Ø¨Ù‚ÛŒÙ‡ Ú©Ø¯ Ø¢Ù¾Ù„ÙˆØ¯
}

// Ù‡Ù…ÛŒÙ† Ø¨Ø±Ø±Ø³ÛŒ Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø§Ù†ÙˆØ§Ø¹ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¯ÛŒÚ¯Ø± Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯:
// - video
// - photo  
// - voice
// - audio
// - sticker
// - Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§ÛŒÙ†Ø¯Ú©Ø³ Ø¨Ø±Ø§ÛŒ Ø¬Ø³ØªØ¬ÙˆÛŒ Ø¨Ù‡ØªØ±
if ($MySQLi->query("SELECT * FROM `search_index`") == false) {
    mysqli_query($MySQLi, "CREATE TABLE `search_index` (
        `id` int(11) NOT NULL AUTO_INCREMENT PRIMARY KEY,
        `file_code` varchar(50) NOT NULL,
        `search_text` text CHARACTER SET utf8mb4,
        `file_type` varchar(20) NOT NULL,
        `is_public` tinyint(1) DEFAULT 1,
        INDEX `search_text` (`search_text`(255)),
        INDEX `file_type` (`file_type`)
    )");
}// ØªÙˆØ§Ø¨Ø¹ Ø¬Ø³ØªØ¬Ùˆ
function addToSearchIndex($file_code, $caption, $file_type, $custom_title = null) {
    global $MySQLi;
    
    $search_text = $custom_title ? $custom_title . ' ' . $caption : $caption;
    $search_text = mysqli_real_escape_string($MySQLi, $search_text);
    
    return mysqli_query($MySQLi, 
        "INSERT INTO `search_index` 
        (`file_code`, `search_text`, `file_type`) 
        VALUES ('{$file_code}', '{$search_text}', '{$file_type}')
        ON DUPLICATE KEY UPDATE `search_text` = '{$search_text}'"
    );
}

function searchFiles($query, $limit = 10) {
    global $MySQLi;
    
    $query = mysqli_real_escape_string($MySQLi, $query);
    $results = mysqli_query($MySQLi,
        "SELECT si.*, fm.custom_title, fm.caption, d.file_size, d.dl
         FROM `search_index` si
         LEFT JOIN `file_metadata` fm ON si.file_code = fm.file_code
         LEFT JOIN `dbfile` d ON si.file_code = d.code
         WHERE si.search_text LIKE '%{$query}%' 
         AND si.is_public = 1
         ORDER BY d.dl DESC
         LIMIT {$limit}"
    );
    
    $files = [];
    while ($row = mysqli_fetch_assoc($results)) {
        $files[] = $row;
    }
    return $files;
}// Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¬Ø³ØªØ¬Ùˆ
elseif ($text == "ğŸ” Ø¬Ø³ØªØ¬ÙˆÛŒ ÙØ§ÛŒÙ„") {
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "ğŸ” Ø¬Ø³ØªØ¬ÙˆÛŒ ÙØ§ÛŒÙ„\n\nÙ„Ø·ÙØ§Ù‹ Ú©Ù„Ù…Ù‡ Ú©Ù„ÛŒØ¯ÛŒ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯:",
        'reply_to_message_id' => $message_id,
        'reply_markup' => $back
    ]);
    $MySQLi->query("UPDATE `user` SET `step` = 'search_files' WHERE `id` = '{$from_id}' LIMIT 1");
}

elseif ($user['step'] == 'search_files') {
    $results = searchFiles($text, 10);
    
    if (count($results) > 0) {
        $message = "ğŸ” Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ Ø¨Ø±Ø§ÛŒ: \"{$text}\"\n\n";
        
        foreach ($results as $index => $file) {
            $message .= ($index + 1) . ". ğŸ“ " . ($file['custom_title'] ?: doc($file['file_type'])) . "\n";
            $message .= "   ğŸ“Š Ø¯Ø§Ù†Ù„ÙˆØ¯: " . formatNumber($file['dl']) . "\n";
            $message .= "   ğŸ’¾ Ø­Ø¬Ù…: " . convert($file['file_size']) . "\n";
            $message .= "   ğŸ“¥ /dl_" . $file['file_code'] . "\nâ–â–â–â–â–\n";
        }
        
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => $message,
            'reply_to_message_id' => $message_id
        ]);
    } else {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "âŒ Ù‡ÛŒÚ† Ù†ØªÛŒØ¬Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ø¬Ø³ØªØ¬ÙˆÛŒ \"{$text}\" ÛŒØ§ÙØª Ù†Ø´Ø¯.",
            'reply_to_message_id' => $message_id
        ]);
    }
    
    $MySQLi->query("UPDATE `user` SET `step` = 'none' WHERE `id` = '{$from_id}' LIMIT 1");
}// Ø¯Ø± Ø¨Ø®Ø´ Ø§Ø±Ø³Ø§Ù„ ÙØ§ÛŒÙ„ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†ØŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ù…Ù„â€ŒØªØ±ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ù‡ÛŒØ¯
function getPublicCaption($file_data) {
    global $usernamebot;
    
    $metadata = getFileMetadata($file_data['code']);
    $stats = getFileStats($file_data['code']);
    
    $caption = "";
    
    if ($metadata['custom_title']) {
        $caption .= "ğŸ¬ " . $metadata['custom_title'] . "\n";
    } else {
        $caption .= "ğŸ“ " . doc($file_data['file']) . "\n";
    }
    
    $caption .= "ğŸ’¾ Ø­Ø¬Ù…: " . convert($file_data['file_size']) . "\n";
    $caption .= "ğŸ“Š Ø¯Ø§Ù†Ù„ÙˆØ¯: " . formatNumber($file_data['dl']) . "\n";
    $caption .= "ğŸ‘ Ø¨Ø§Ø²Ø¯ÛŒØ¯: " . formatNumber($stats['views']) . "\n";
    $caption .= "ğŸ‘ Ù„Ø§ÛŒÚ©: " . formatNumber($stats['likes']) . "\n\n";
    
    if ($metadata['caption']) {
        $caption .= "ğŸ“ ØªÙˆØ¶ÛŒØ­Ø§Øª:\n" . $metadata['caption'] . "\n\n";
    }
    
    $caption .= "ğŸ”— @" . $usernamebot;
    
    return $caption;
}// ÙˆÙ‚ØªÛŒ Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ù„ÛŒÙ†Ú© ÙØ§ÛŒÙ„ Ù…ÛŒâ€ŒØ¢ÛŒØ¯ØŒ ÙÙ‚Ø· Ø§Ø¬Ø§Ø²Ù‡ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯
elseif(strpos($text, "/start _") !== false) {
    $idFile = str_replace("/start _", null, $text);
    $dataFile = mysqli_fetch_assoc(mysqli_query($MySQLi, "SELECT * FROM `dbfile` WHERE `code` = '{$idFile}' LIMIT 1"));
    
    // Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ ÙØ§ÛŒÙ„ public Ø§Ø³Øª
    $metadata = getFileMetadata($idFile);
    if (!$metadata || $metadata['is_public'] == 0) {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "âŒ Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª ÛŒØ§ Ø­Ø°Ù Ø´Ø¯Ù‡ Ø§Ø³Øª.",
            'reply_to_message_id' => $message_id
        ]);
        exit();
    }
    
    // Ø¨Ù‚ÛŒÙ‡ Ú©Ø¯ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±
    // ...
}elseif ($text == "ğŸ“š Ø±Ø§Ù‡Ù†Ù…Ø§") {
    $help_text = "ğŸ“š Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø±Ø¨Ø§Øª\n\n";
    $help_text .= "ğŸ” **Ø¬Ø³ØªØ¬ÙˆÛŒ ÙØ§ÛŒÙ„**:\n";
    $help_text .= "Ø¨Ø±Ø§ÛŒ ÛŒØ§ÙØªÙ† ÙØ§ÛŒÙ„ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø§Ø² Ø¯Ú©Ù…Ù‡ Ø¬Ø³ØªØ¬Ùˆ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.\n\n";
    $help_text .= "ğŸ“¥ **Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ§ÛŒÙ„**:\n";
    $help_text .= "Ù¾Ø³ Ø§Ø² ÛŒØ§ÙØªÙ† ÙØ§ÛŒÙ„ØŒ Ø±ÙˆÛŒ Ø¢Ù† Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ ØªØ§ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´ÙˆØ¯.\n\n";
    $help_text .= "ğŸ”¥ **Ù¾Ø±Ø·Ø±ÙØ¯Ø§Ø±ØªØ±ÛŒÙ†â€ŒÙ‡Ø§**:\n";
    $help_text .= "ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ø¨Ø§Ø²Ø¯ÛŒØ¯ Ùˆ Ù¾Ø±Ø·Ø±ÙØ¯Ø§Ø± Ø±Ø§ Ø¨Ø¨ÛŒÙ†ÛŒØ¯.\n\n";
    $help_text .= "ğŸ“± **Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ**:\n";
    $help_text .= "Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø§ Ø¯ÙˆØ³ØªØ§Ù† Ø®ÙˆØ¯ Ø¨Ù‡ Ø§Ø´ØªØ±Ø§Ú© Ø¨Ú¯Ø°Ø§Ø±ÛŒØ¯.\n\n";
    $help_text .= "ğŸ’¡ **Ù†Ú©Ø§Øª**:\n";
    $help_text .= "â€¢ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø¯Ø§Ø¦Ù…ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯\n";
    $help_text .= "â€¢ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø¨Ø¯ÙˆÙ† Ù…Ø­Ø¯ÙˆØ¯ÛŒØª ØªØ¹Ø¯Ø§Ø¯\n";
    $help_text .= "â€¢ Ú©ÛŒÙÛŒØª Ø§ØµÙ„ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø­ÙØ¸ Ù…ÛŒâ€ŒØ´ÙˆØ¯\n\n";
    $help_text .= "ğŸ¤– @$usernamebot";
    
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => $help_text,
        'reply_to_message_id' => $message_id,
        'parse_mode' => "Markdown"
    ]);
}// ÙˆÙ‚ØªÛŒ Ø§Ø¯Ù…ÛŒÙ† ÙØ§ÛŒÙ„ Ø¢Ù¾Ù„ÙˆØ¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŒ Ø¨Ù‡ Ø§ÛŒÙ†Ø¯Ú©Ø³ Ø¬Ø³ØªØ¬Ùˆ Ø§Ø¶Ø§ÙÙ‡ Ø´ÙˆØ¯
// Ø¨Ø¹Ø¯ Ø§Ø² Ù‡Ø± Ø¢Ù¾Ù„ÙˆØ¯ Ù…ÙˆÙÙ‚ ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ†:
addToSearchIndex($code, $message->caption ?: '', $file_data['file'], $custom_title);// Ø§ÛŒØ¬Ø§Ø¯ Ø¬Ø¯ÙˆÙ„ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§
if ($MySQLi->query("SELECT * FROM `file_categories`") == false) {
    mysqli_query($MySQLi, "CREATE TABLE `file_categories` (
        `id` int(11) NOT NULL AUTO_INCREMENT PRIMARY KEY,
        `name` varchar(100) NOT NULL,
        `description` text,
        `created_by` bigint(20) NOT NULL,
        `created_at` timestamp DEFAULT CURRENT_TIMESTAMP
    )");
    
    // Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶
    mysqli_query($MySQLi, "INSERT INTO `file_categories` (`name`, `description`, `created_by`) VALUES 
        ('ÙÛŒÙ„Ù…', 'ÙÛŒÙ„Ù…â€ŒÙ‡Ø§ÛŒ Ø³ÛŒÙ†Ù…Ø§ÛŒÛŒ Ùˆ Ø³Ø±ÛŒØ§Ù„', 414816264),
        ('Ù…ÙˆØ²ÛŒÚ©', 'Ø¢Ù‡Ù†Ú¯â€ŒÙ‡Ø§ Ùˆ Ù…ÙˆØ³ÛŒÙ‚ÛŒ', 414816264),
        ('Ø¹Ú©Ø³', 'Ø¹Ú©Ø³â€ŒÙ‡Ø§ Ùˆ ØªØµØ§ÙˆÛŒØ±', 414816264),
        ('Ø³Ù†Ø¯', 'ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…ØªÙ†ÛŒ Ùˆ PDF', 414816264)
    ");
}

// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ÙÛŒÙ„Ø¯ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¨Ù‡ Ù…ØªØ§Ø¯ÛŒØªØ§
if ($MySQLi->query("SELECT category_id FROM `file_metadata`") == false) {
    mysqli_query($MySQLi, "ALTER TABLE `file_metadata` ADD `category_id` int(11) DEFAULT NULL");
}// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø¨Ø®Ø´ Ø§ÛŒØ¬Ø§Ø¯ Ø¬Ø¯Ø§ÙˆÙ„
if ($MySQLi->query("SELECT * FROM `bot_settings`") == false) {
    mysqli_query($MySQLi, "CREATE TABLE `bot_settings` (
        `id` int(11) NOT NULL AUTO_INCREMENT PRIMARY KEY,
        `setting_key` varchar(50) NOT NULL UNIQUE,
        `setting_value` tinyint(1) DEFAULT 1,
        `description` varchar(255) DEFAULT NULL,
        `updated_at` timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
    )");
    
    // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶
    mysqli_query($MySQLi, "INSERT INTO `bot_settings` (`setting_key`, `setting_value`, `description`) VALUES 
        ('search_enabled', 1, 'ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯Ù† Ø¬Ø³ØªØ¬Ùˆ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¹Ø§Ø¯ÛŒ'),
        ('popular_enabled', 1, 'ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯Ù† Ù¾Ø±Ø·Ø±ÙØ¯Ø§Ø±ØªØ±ÛŒÙ†â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¹Ø§Ø¯ÛŒ'),
        ('share_enabled', 1, 'ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯Ù† Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¹Ø§Ø¯ÛŒ'),
        ('help_enabled', 0, 'ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯Ù† Ø±Ø§Ù‡Ù†Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¹Ø§Ø¯ÛŒ')
    ");
}// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø¨Ø®Ø´ ØªÙˆØ§Ø¨Ø¹
function getBotSetting($key) {
    global $MySQLi;
    
    $result = mysqli_fetch_assoc(mysqli_query($MySQLi,
        "SELECT `setting_value` FROM `bot_settings` WHERE `setting_key` = '{$key}'"
    ));
    
    return $result ? $result['setting_value'] : 1;
}

function updateBotSetting($key, $value) {
    global $MySQLi;
    
    return mysqli_query($MySQLi,
        "UPDATE `bot_settings` 
         SET `setting_value` = '{$value}', `updated_at` = CURRENT_TIMESTAMP 
         WHERE `setting_key` = '{$key}'"
    );
}

function getSettingsStatus() {
    $settings = [
        'search' => getBotSetting('search_enabled'),
        'popular' => getBotSetting('popular_enabled'),
        'share' => getBotSetting('share_enabled'),
        'help' => getBotSetting('help_enabled')
    ];
    
    return $settings;
}// Ù…Ù†ÙˆÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±Ø¨Ø§Øª
$settings_menu = json_encode(['keyboard' => [
    [['text' => "ğŸ” ÙØ¹Ø§Ù„/ØºÛŒØ±ÙØ¹Ø§Ù„ Ø¬Ø³ØªØ¬Ùˆ"], ['text' => "ğŸ”¥ ÙØ¹Ø§Ù„/ØºÛŒØ±ÙØ¹Ø§Ù„ Ù¾Ø±Ø·Ø±ÙØ¯Ø§Ø±ØªØ±ÛŒÙ†â€ŒÙ‡Ø§"]],
    [['text' => "ğŸ“¤ ÙØ¹Ø§Ù„/ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ"]],
    [['text' => "ğŸ“Š Ù…Ø´Ø§Ù‡Ø¯Ù‡ ÙˆØ¶Ø¹ÛŒØª ØªÙ†Ø¸ÛŒÙ…Ø§Øª"]],
    [['text' => "ğŸ”™ Ø¨Ø±Ú¯Ø´Øª"]]
    ], 'resize_keyboard' => true
]);// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø¨Ø®Ø´ Ù¾Ù†Ù„ Ø§Ø¯Ù…ÛŒÙ†
elseif ($text == "âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±Ø¨Ø§Øª") {
    $settings = getSettingsStatus();
    
    $status_text = "âš™ï¸ ÙˆØ¶Ø¹ÛŒØª ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±Ø¨Ø§Øª:\n\n";
    $status_text .= "ğŸ” Ø¬Ø³ØªØ¬Ùˆ: " . ($settings['search'] ? "âœ… ÙØ¹Ø§Ù„" : "âŒ ØºÛŒØ±ÙØ¹Ø§Ù„") . "\n";
    $status_text .= "ğŸ”¥ Ù¾Ø±Ø·Ø±ÙØ¯Ø§Ø±ØªØ±ÛŒÙ†â€ŒÙ‡Ø§: " . ($settings['popular'] ? "âœ… ÙØ¹Ø§Ù„" : "âŒ ØºÛŒØ±ÙØ¹Ø§Ù„") . "\n";
    $status_text .= "ğŸ“¤ Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ: " . ($settings['share'] ? "âœ… ÙØ¹Ø§Ù„" : "âŒ ØºÛŒØ±ÙØ¹Ø§Ù„") . "\n";
    $status_text .= "ğŸ“š Ø±Ø§Ù‡Ù†Ù…Ø§: " . ($settings['help'] ? "âœ… ÙØ¹Ø§Ù„" : "âŒ ØºÛŒØ±ÙØ¹Ø§Ù„") . "\n\n";
    $status_text .= "Ø¨Ø±Ø§ÛŒ ØªØºÛŒÛŒØ± Ù‡Ø± Ù…ÙˆØ±Ø¯ Ø§Ø² Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯:";
    
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => $status_text,
        'reply_to_message_id' => $message_id,
        'reply_markup' => $settings_menu
    ]);
    $MySQLi->query("UPDATE `user` SET `step` = 'bot_settings' WHERE `id` = '{$from_id}' LIMIT 1");
}

// Ù…Ø¯ÛŒØ±ÛŒØª ÙØ¹Ø§Ù„/ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§
elseif ($text == "ğŸ” ÙØ¹Ø§Ù„/ØºÛŒØ±ÙØ¹Ø§Ù„ Ø¬Ø³ØªØ¬Ùˆ") {
    $current_status = getBotSetting('search_enabled');
    $new_status = $current_status ? 0 : 1;
    
    if (updateBotSetting('search_enabled', $new_status)) {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "âœ… Ù‚Ø§Ø¨Ù„ÛŒØª Ø¬Ø³ØªØ¬Ùˆ " . ($new_status ? "ÙØ¹Ø§Ù„" : "ØºÛŒØ±ÙØ¹Ø§Ù„") . " Ø´Ø¯!",
            'reply_to_message_id' => $message_id,
            'reply_markup' => $settings_menu
        ]);
    }
}

elseif ($text == "ğŸ”¥ ÙØ¹Ø§Ù„/ØºÛŒØ±ÙØ¹Ø§Ù„ Ù¾Ø±Ø·Ø±ÙØ¯Ø§Ø±ØªØ±ÛŒÙ†â€ŒÙ‡Ø§") {
    $current_status = getBotSetting('popular_enabled');
    $new_status = $current_status ? 0 : 1;
    
    if (updateBotSetting('popular_enabled', $new_status)) {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "âœ… Ù‚Ø§Ø¨Ù„ÛŒØª Ù¾Ø±Ø·Ø±ÙØ¯Ø§Ø±ØªØ±ÛŒÙ†â€ŒÙ‡Ø§ " . ($new_status ? "ÙØ¹Ø§Ù„" : "ØºÛŒØ±ÙØ¹Ø§Ù„") . " Ø´Ø¯!",
            'reply_to_message_id' => $message_id,
            'reply_markup' => $settings_menu
        ]);
    }
}

elseif ($text == "ğŸ“¤ ÙØ¹Ø§Ù„/ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ") {
    $current_status = getBotSetting('share_enabled');
    $new_status = $current_status ? 0 : 1;
    
    if (updateBotSetting('share_enabled', $new_status)) {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "âœ… Ù‚Ø§Ø¨Ù„ÛŒØª Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ " . ($new_status ? "ÙØ¹Ø§Ù„" : "ØºÛŒØ±ÙØ¹Ø§Ù„") . " Ø´Ø¯!",
            'reply_to_message_id' => $message_id,
            'reply_markup' => $settings_menu
        ]);
    }
}

elseif ($text == "ğŸ“Š Ù…Ø´Ø§Ù‡Ø¯Ù‡ ÙˆØ¶Ø¹ÛŒØª ØªÙ†Ø¸ÛŒÙ…Ø§Øª") {
    $settings = getSettingsStatus();
    
    $status_text = "ğŸ“Š ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª:\n\n";
    $status_text .= "ğŸ” Ø¬Ø³ØªØ¬Ùˆ: " . ($settings['search'] ? "âœ… ÙØ¹Ø§Ù„" : "âŒ ØºÛŒØ±ÙØ¹Ø§Ù„") . "\n";
    $status_text .= "ğŸ”¥ Ù¾Ø±Ø·Ø±ÙØ¯Ø§Ø±ØªØ±ÛŒÙ†â€ŒÙ‡Ø§: " . ($settings['popular'] ? "âœ… ÙØ¹Ø§Ù„" : "âŒ ØºÛŒØ±ÙØ¹Ø§Ù„") . "\n";
    $status_text .= "ğŸ“¤ Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ: " . ($settings['share'] ? "âœ… ÙØ¹Ø§Ù„" : "âŒ ØºÛŒØ±ÙØ¹Ø§Ù„") . "\n";
    $status_text .= "ğŸ“š Ø±Ø§Ù‡Ù†Ù…Ø§: " . ($settings['help'] ? "âœ… ÙØ¹Ø§Ù„" : "âŒ ØºÛŒØ±ÙØ¹Ø§Ù„") . "\n";
    
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => $status_text,
        'reply_to_message_id' => $message_id,
        'reply_markup' => $settings_menu
    ]);
}// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§Ø¯Ù…ÛŒÙ†
if (isAdmin($from_id)) {
    $panel = json_encode(['keyboard' => [
        [['text' => "ğŸ‘¤ Ø§Ù…Ø§Ø± Ø±Ø¨Ø§Øª"]],
        [['text' => "ğŸ‘¥ Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§"]],
        [['text' => "â° Ù…Ø¯ÛŒØ±ÛŒØª Ø­Ø°Ù Ø®ÙˆØ¯Ú©Ø§Ø±"], ['text' => "âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±Ø¨Ø§Øª"]],
        [['text' => "ğŸ“ª Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ù‡Ù…Ù‡"], ['text' => "ğŸ“ª ÙÙˆØ±ÙˆØ§Ø±Ø¯ Ø¨Ù‡ Ù‡Ù…Ù‡"]],
        [['text' => "ğŸ”™"]]
        ], 'resize_keyboard' => true
    ]);
}// ØªØ§Ø¨Ø¹ Ø§ÛŒØ¬Ø§Ø¯ Ù…Ù†ÙˆÛŒ Ù¾ÙˆÛŒØ§ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¹Ø§Ø¯ÛŒ
function getUserMenu() {
    $settings = getSettingsStatus();
    $menu_items = [];
    
    // Ø¯Ú©Ù…Ù‡ Ø¬Ø³ØªØ¬Ùˆ
    if ($settings['search']) {
        $menu_items[] = [['text' => "ğŸ” Ø¬Ø³ØªØ¬ÙˆÛŒ ÙØ§ÛŒÙ„"]];
    }
    
    // Ø¯Ú©Ù…Ù‡ Ù¾Ø±Ø·Ø±ÙØ¯Ø§Ø±ØªØ±ÛŒÙ†â€ŒÙ‡Ø§
    if ($settings['popular']) {
        if (count($menu_items) > 0 && count($menu_items[count($menu_items)-1]) < 2) {
            $menu_items[count($menu_items)-1][] = ['text' => "ğŸ”¥ Ù¾Ø±Ø·Ø±ÙØ¯Ø§Ø±ØªØ±ÛŒÙ†â€ŒÙ‡Ø§"];
        } else {
            $menu_items[] = [['text' => "ğŸ”¥ Ù¾Ø±Ø·Ø±ÙØ¯Ø§Ø±ØªØ±ÛŒÙ†â€ŒÙ‡Ø§"]];
        }
    }
    
    // Ø¯Ú©Ù…Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‚Ø§Ø¨Ù„ Ø¯Ø§Ù†Ù„ÙˆØ¯ (Ù‡Ù…ÛŒØ´Ù‡ ÙØ¹Ø§Ù„)
    if (count($menu_items) > 0 && count($menu_items[count($menu_items)-1]) < 2) {
        $menu_items[count($menu_items)-1][] = ['text' => "ğŸ“¥ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‚Ø§Ø¨Ù„ Ø¯Ø§Ù†Ù„ÙˆØ¯"];
    } else {
        $menu_items[] = [['text' => "ğŸ“¥ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‚Ø§Ø¨Ù„ Ø¯Ø§Ù†Ù„ÙˆØ¯"]];
    }
    
    // Ø¯Ú©Ù…Ù‡ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ (Ù‡Ù…ÛŒØ´Ù‡ ÙØ¹Ø§Ù„)
    $menu_items[] = [['text' => "ğŸ« Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ"]];
    
    return json_encode(['keyboard' => $menu_items, 'resize_keyboard' => true]);
}

// Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù…Ù†ÙˆÛŒ Ù¾ÙˆÛŒØ§ Ø¯Ø± Ù‚Ø³Ù…Øª start
if (preg_match('/^\/(start)$/i', $text) or $text == "ğŸ”™") {
    $admin_status = "";
    if (isAdmin($from_id)) {
        if ($from_id == 414816264) {
            $admin_status = "\n\nğŸ‘‘ Ø´Ù…Ø§ Ø§Ø¯Ù…ÛŒÙ† Ø§ØµÙ„ÛŒ Ø§ÛŒÙ† Ø±Ø¨Ø§Øª Ù‡Ø³ØªÛŒØ¯!";
        } else {
            $admin_status = "\n\nâš¡ Ø´Ù…Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ø¯Ù…ÛŒÙ† Ø¯Ø§Ø±ÛŒØ¯!";
        }
        
        $welcome_text = "ğŸ‘¤ Ø³Ù„Ø§Ù… <code>$first_name</code>\nğŸ¤– Ø¨Ù‡ Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ø±Ø¨Ø§Øª Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!{$admin_status}";
        $menu_to_use = $menu; // Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ Ø§Ø¯Ù…ÛŒÙ†
    } else {
        $welcome_text = "ğŸ‘¤ Ø³Ù„Ø§Ù… <code>$first_name</code>\nğŸ¤– Ø¨Ù‡ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø§ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!\n\nğŸ“š Ø¯Ø± Ø§ÛŒÙ† Ø±Ø¨Ø§Øª Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù Ø±Ø§ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯.";
        $menu_to_use = getUserMenu(); // Ù…Ù†ÙˆÛŒ Ù¾ÙˆÛŒØ§ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¹Ø§Ø¯ÛŒ
    }
    
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => $welcome_text . "\n\nğŸ¤– @$usernamebot\nğŸ“¢ @{$Config['channel']}",
        'reply_to_message_id' => $message_id,
        'parse_mode' => "html",
        'reply_markup' => $menu_to_use
    ]);
    
    if (!$user) {
        $MySQLi->query("INSERT INTO `user` (`id`, `step`, `upload`, `code`) VALUES ('{$from_id}', 'none', '0', '')");
    } else {
        $MySQLi->query("UPDATE `user` SET `step` = 'none', `code` = '' WHERE `id` = '{$from_id}' LIMIT 1");
    }
}// ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø¬Ø³ØªØ¬Ùˆ Ø§Ú¯Ø± ØºÛŒØ±ÙØ¹Ø§Ù„ Ø¨Ø§Ø´Ø¯
elseif ($text == "ğŸ” Ø¬Ø³ØªØ¬ÙˆÛŒ ÙØ§ÛŒÙ„") {
    if (!getBotSetting('search_enabled')) {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "âŒ Ù‚Ø§Ø¨Ù„ÛŒØª Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª!",
            'reply_to_message_id' => $message_id
        ]);
        exit();
    }
    
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "ğŸ” Ø¬Ø³ØªØ¬ÙˆÛŒ ÙØ§ÛŒÙ„\n\nÙ„Ø·ÙØ§Ù‹ Ú©Ù„Ù…Ù‡ Ú©Ù„ÛŒØ¯ÛŒ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯:",
        'reply_to_message_id' => $message_id,
        'reply_markup' => $back
    ]);
    $MySQLi->query("UPDATE `user` SET `step` = 'search_files' WHERE `id` = '{$from_id}' LIMIT 1");
}

// ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ù¾Ø±Ø·Ø±ÙØ¯Ø§Ø±ØªØ±ÛŒÙ†â€ŒÙ‡Ø§ Ø§Ú¯Ø± ØºÛŒØ±ÙØ¹Ø§Ù„ Ø¨Ø§Ø´Ø¯
elseif ($text == "ğŸ”¥ Ù¾Ø±Ø·Ø±ÙØ¯Ø§Ø±ØªØ±ÛŒÙ†â€ŒÙ‡Ø§") {
    if (!getBotSetting('popular_enabled')) {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "âŒ Ù‚Ø§Ø¨Ù„ÛŒØª Ù¾Ø±Ø·Ø±ÙØ¯Ø§Ø±ØªØ±ÛŒÙ†â€ŒÙ‡Ø§ Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª!",
            'reply_to_message_id' => $message_id
        ]);
        exit();
    }
    
    // Ø¨Ù‚ÛŒÙ‡ Ú©Ø¯ Ù¾Ø±Ø·Ø±ÙØ¯Ø§Ø±ØªØ±ÛŒÙ†â€ŒÙ‡Ø§
    $popular_files = mysqli_query($MySQLi,
        "SELECT f.*, 
                COUNT(CASE WHEN i.interaction_type = 'like' THEN 1 END) as likes,
                COUNT(CASE WHEN i.interaction_type = 'view' THEN 1 END) as views
         FROM `dbfile` f
         LEFT JOIN `file_interactions` i ON f.code = i.file_code
         GROUP BY f.code
         ORDER BY likes DESC, views DESC
         LIMIT 10"
    );
    
    // ... Ø¨Ù‚ÛŒÙ‡ Ú©Ø¯
}

// ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø§Ú¯Ø± ØºÛŒØ±ÙØ¹Ø§Ù„ Ø¨Ø§Ø´Ø¯
elseif (strpos($data, "share_") === 0) {
    if (!getBotSetting('share_enabled')) {
        WSBot('answercallbackquery', [
            'callback_query_id' => $membercall,
            'text' => "âŒ Ù‚Ø§Ø¨Ù„ÛŒØª Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª!",
            'show_alert' => true
        ]);
        exit();
    }
    
    $file_code = str_replace("share_", "", $data);
    $file_data = mysqli_fetch_assoc(mysqli_query($MySQLi, 
        "SELECT * FROM `dbfile` WHERE `code` = '{$file_code}'"
    ));
    
    // ... Ø¨Ù‚ÛŒÙ‡ Ú©Ø¯ Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ
}// âŒ Ú©Ø§Ù…Ù†Øª Ú©Ø±Ø¯Ù† ÛŒØ§ Ø­Ø°Ù Ø¨Ø®Ø´ Ø±Ø§Ù‡Ù†Ù…Ø§
/*
elseif ($text == "ğŸ“š Ø±Ø§Ù‡Ù†Ù…Ø§") {
    $help_text = "ğŸ“š Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø±Ø¨Ø§Øª\n\n";
    // ... Ù…Ø­ØªÙˆØ§ÛŒ Ø±Ø§Ù‡Ù†Ù…Ø§
}
*/// Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ Ø§Ø¯Ù…ÛŒÙ† - Ø­Ø°Ù Ø±Ø§Ù‡Ù†Ù…Ø§
if (isAdmin($from_id)) {
    $menu = json_encode(['keyboard' => [
        [['text' => "ğŸ“‚ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø§Ù¾Ù„ÙˆØ¯"], ['text' =>"ğŸ« Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ"]],
        [['text' =>"ğŸ«Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ"], ['text' => "ğŸ“¥ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‚Ø§Ø¨Ù„ Ø¯Ø§Ù†Ù„ÙˆØ¯"]],
        [['text' => "ğŸ”¥ Ù¾Ø±Ø·Ø±ÙØ¯Ø§Ø±ØªØ±ÛŒÙ†â€ŒÙ‡Ø§"], ['text' => "ğŸ›  Ù…Ø¯ÛŒØ±ÛŒØª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§"]],
        [['text' => "ğŸ” ØªÙ†Ø¸ÛŒÙ… Ù¾Ø³ÙˆØ±Ø¯"], ['text' => "ğŸ—‘ Ø­Ø°Ù ÙØ§ÛŒÙ„"]],
        [['text' => "ğŸ‘¤ Ù…Ø¯ÛŒØ±ÛŒØª"], ['text' => "ğŸ—‚ Ú©Ø¯ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ ÙØ§ÛŒÙ„"]]
        ], 'resize_keyboard' => true
    ]);
}// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø¨Ø®Ø´ Ø§ÛŒØ¬Ø§Ø¯ Ø¬Ø¯Ø§ÙˆÙ„
if ($MySQLi->query("SELECT * FROM `batch_uploads`") == false) {
    mysqli_query($MySQLi, "CREATE TABLE `batch_uploads` (
        `id` int(11) NOT NULL AUTO_INCREMENT PRIMARY KEY,
        `batch_code` varchar(50) NOT NULL,
        `user_id` bigint(20) NOT NULL,
        `title` varchar(255) DEFAULT NULL,
        `description` text,
        `file_count` int(11) DEFAULT 0,
        `created_at` timestamp DEFAULT CURRENT_TIMESTAMP,
        `status` enum('uploading','completed','cancelled') DEFAULT 'uploading'
    )");
}// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø¨Ø®Ø´ ØªÙˆØ§Ø¨Ø¹
function createBatchUpload($user_id, $title = null) {
    global $MySQLi;
    
    $batch_code = RandomString() . '_batch';
    $title = mysqli_real_escape_string($MySQLi, $title);
    
    mysqli_query($MySQLi, 
        "INSERT INTO `batch_uploads` 
        (`batch_code`, `user_id`, `title`) 
        VALUES ('{$batch_code}', '{$user_id}', '{$title}')"
    );
    
    return $batch_code;
}

function addFileToBatch($batch_code, $file_code, $file_type) {
    global $MySQLi;
    
    // Ø¢Ù¾Ø¯ÛŒØª ØªØ¹Ø¯Ø§Ø¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
    mysqli_query($MySQLi,
        "UPDATE `batch_uploads` 
         SET `file_count` = `file_count` + 1 
         WHERE `batch_code` = '{$batch_code}'"
    );
    
    // Ø°Ø®ÛŒØ±Ù‡ Ø§Ø±ØªØ¨Ø§Ø· ÙØ§ÛŒÙ„ Ø¨Ø§ Ø¨Ú†
    mysqli_query($MySQLi,
        "UPDATE `file_metadata` 
         SET `batch_code` = '{$batch_code}' 
         WHERE `file_code` = '{$file_code}'"
    );
}

function completeBatchUpload($batch_code) {
    global $MySQLi;
    
    return mysqli_query($MySQLi,
        "UPDATE `batch_uploads` 
         SET `status` = 'completed' 
         WHERE `batch_code` = '{$batch_code}'"
    );
}

function getBatchFiles($batch_code) {
    global $MySQLi;
    
    $files = mysqli_query($MySQLi,
        "SELECT fm.*, d.file_size, d.dl, d.file as file_type
         FROM `file_metadata` fm
         LEFT JOIN `dbfile` d ON fm.file_code = d.code
         WHERE fm.batch_code = '{$batch_code}'"
    );
    
    $result = [];
    while ($row = mysqli_fetch_assoc($files)) {
        $result[] = $row;
    }
    return $result;
}// Ù…Ù†ÙˆÛŒ Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡
$batch_upload_menu = json_encode(['keyboard' => [
    [['text' => "ğŸ“¦ Ø´Ø±ÙˆØ¹ Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ Ø¬Ø¯ÛŒØ¯"]],
    [['text' => "ğŸ“ Ø§ÙØ²ÙˆØ¯Ù† Ø¹Ù†ÙˆØ§Ù† Ø¨Ù‡ Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ"]],
    [['text' => "âœ… Ø§ØªÙ…Ø§Ù… Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ"]],
    [['text' => "âŒ Ù„ØºÙˆ Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ"]],
    [['text' => "ğŸ“‹ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¢Ù¾Ù„ÙˆØ¯Ù‡Ø§ÛŒ Ú¯Ø±ÙˆÙ‡ÛŒ"]],
    [['text' => "ğŸ”™ Ø¨Ø±Ú¯Ø´Øª"]]
    ], 'resize_keyboard' => true
]);// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§Ø¯Ù…ÛŒÙ†
elseif ($text == "ğŸ“¦ Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡") {
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "ğŸ“¦ Ø³ÛŒØ³ØªÙ… Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡\n\nØ¨Ø§ Ø§ÛŒÙ† Ø³ÛŒØ³ØªÙ… Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ú†Ù†Ø¯ÛŒÙ† ÙØ§ÛŒÙ„ Ø±Ø§ ÛŒÚ©Ø¬Ø§ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯ Ùˆ Ø¨Ø±Ø§ÛŒ Ù‡Ø± ÙØ§ÛŒÙ„ Ù„ÛŒÙ†Ú© Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ø¯Ø±ÛŒØ§ÙØª Ú©Ù†ÛŒØ¯.",
        'reply_to_message_id' => $message_id,
        'reply_markup' => $batch_upload_menu
    ]);
    $MySQLi->query("UPDATE `user` SET `step` = 'batch_upload' WHERE `id` = '{$from_id}' LIMIT 1");
}

// Ø´Ø±ÙˆØ¹ Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ Ø¬Ø¯ÛŒØ¯
elseif ($text == "ğŸ“¦ Ø´Ø±ÙˆØ¹ Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ Ø¬Ø¯ÛŒØ¯") {
    $batch_code = createBatchUpload($from_id);
    
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "âœ… Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ Ø¬Ø¯ÛŒØ¯ Ø´Ø±ÙˆØ¹ Ø´Ø¯!\n\nğŸ”¸ Ú©Ø¯ Ø¢Ù¾Ù„ÙˆØ¯: <code>{$batch_code}</code>\nğŸ“ Ø§Ú©Ù†ÙˆÙ† ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯.\nâ° Ù¾Ø³ Ø§Ø² Ø§ØªÙ…Ø§Ù… Ø¢Ù¾Ù„ÙˆØ¯ØŒ Ø§Ø² Ø¯Ú©Ù…Ù‡ 'Ø§ØªÙ…Ø§Ù… Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ' Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.",
        'reply_to_message_id' => $message_id,
        'parse_mode' => 'HTML',
        'reply_markup' => $batch_upload_menu
    ]);
    
    $MySQLi->query("UPDATE `user` SET `step` = 'batch_uploading', `code` = '{$batch_code}' WHERE `id` = '{$from_id}' LIMIT 1");
}

// Ø§ÙØ²ÙˆØ¯Ù† Ø¹Ù†ÙˆØ§Ù† Ø¨Ù‡ Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ
elseif ($text == "ğŸ“ Ø§ÙØ²ÙˆØ¯Ù† Ø¹Ù†ÙˆØ§Ù† Ø¨Ù‡ Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ") {
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "ğŸ“ Ø§ÙØ²ÙˆØ¯Ù† Ø¹Ù†ÙˆØ§Ù† Ø¨Ù‡ Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ\n\nÙ„Ø·ÙØ§Ù‹ Ø¹Ù†ÙˆØ§Ù† Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯:",
        'reply_to_message_id' => $message_id,
        'reply_markup' => $back
    ]);
    $MySQLi->query("UPDATE `user` SET `step` = 'batch_add_title' WHERE `id` = '{$from_id}' LIMIT 1");
}

// Ø§ØªÙ…Ø§Ù… Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ
elseif ($text == "âœ… Ø§ØªÙ…Ø§Ù… Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ") {
    $batch_data = mysqli_fetch_assoc(mysqli_query($MySQLi,
        "SELECT * FROM `batch_uploads` 
         WHERE `user_id` = '{$from_id}' AND `status` = 'uploading' 
         ORDER BY `created_at` DESC LIMIT 1"
    ));
    
    if ($batch_data) {
        completeBatchUpload($batch_data['batch_code']);
        $batch_files = getBatchFiles($batch_data['batch_code']);
        
        $message = "âœ… Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯!\n\n";
        $message .= "ğŸ“¦ Ú©Ø¯ Ø¢Ù¾Ù„ÙˆØ¯: <code>{$batch_data['batch_code']}</code>\n";
        $message .= "ğŸ“ ØªØ¹Ø¯Ø§Ø¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§: " . count($batch_files) . "\n\n";
        $message .= "ğŸ”— Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ù†Ù„ÙˆØ¯:\n";
        
        foreach ($batch_files as $index => $file) {
            $message .= ($index + 1) . ". ğŸ“¥ /dl_{$file['file_code']}\n";
        }
        
        $message .= "\nğŸŒ Ù„ÛŒÙ†Ú© Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ù…Ø¬Ù…ÙˆØ¹Ù‡:\n";
        $message .= "https://t.me/" . $usernamebot . "?start=batch_{$batch_data['batch_code']}";
        
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => $message,
            'reply_to_message_id' => $message_id,
            'parse_mode' => 'HTML',
            'reply_markup' => $menu
        ]);
        
        $MySQLi->query("UPDATE `user` SET `step` = 'none', `code` = '' WHERE `id` = '{$from_id}' LIMIT 1");
    } else {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "âŒ Ù‡ÛŒÚ† Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ ÙØ¹Ø§Ù„ÛŒ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯!",
            'reply_to_message_id' => $message_id
        ]);
    }
}// ØªØºÛŒÛŒØ± Ø¯Ø± Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ø¢Ù¾Ù„ÙˆØ¯ Ø¨Ø±Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² Ø­Ø§Ù„Øª Ú¯Ø±ÙˆÙ‡ÛŒ
function handleFileUpload($file_type, $file_id, $file_size, $caption, $from_id, $chat_id, $message_id) {
    global $MySQLi, $usernamebot;
    
    // Ø¨Ø±Ø±Ø³ÛŒ ØªÚ©Ø±Ø§Ø±ÛŒ Ù†Ø¨ÙˆØ¯Ù† ÙØ§ÛŒÙ„
    $file = mysqli_fetch_assoc(mysqli_query($MySQLi, "SELECT * FROM `dbfile` WHERE `file_id` = '{$file_id}' LIMIT 1"));
    
    if(!$file) {
        // Ø°Ø®ÛŒØ±Ù‡ Ú©Ù¾Ø´Ù†
        file_put_contents("files/$file_id", $caption ?: '');
        
        $code = RandomString();
        $size = convert($file_size);
        $time = date('h:i:s');
        $date = date('Y/m/d');
        
        // Ø°Ø®ÛŒØ±Ù‡ Ù…ØªØ§Ø¯ÛŒØªØ§
        saveFileMetadata($code, $file_id, $from_id, $caption ?: '');
        
        // Ø¨Ø±Ø±Ø³ÛŒ Ø§Ú¯Ø± Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ Ù‡Ø³ØªÛŒÙ…
        $user_data = mysqli_fetch_assoc(mysqli_query($MySQLi, 
            "SELECT * FROM `user` WHERE `id` = '{$from_id}'"
        ));
        
        $is_batch = false;
        if ($user_data && strpos($user_data['step'], 'batch_uploading') !== false) {
            addFileToBatch($user_data['code'], $code, $file_type);
            $is_batch = true;
        }
        
        // Ø«Ø¨Øª ØªØ¹Ø§Ù…Ù„
        recordInteraction($code, $from_id, 'view');
        $interaction_keyboard = getInteractionKeyboard($code, $from_id);
        
        $caption_text = getAdvancedCaption([
            'code' => $code,
            'file' => $file_type,
            'file_size' => $file_size,
            'dl' => 1,
            'caption' => $caption
        ]);
        
        // Ø§Ø±Ø³Ø§Ù„ ÙØ§ÛŒÙ„
        $method = 'send' . $file_type;
        $success_message = WSBot($method, [
            'chat_id' => $chat_id,
            $file_type => $file_id,
            'caption' => $caption_text . ($is_batch ? "\n\nğŸ“¦ Ø¨Ø®Ø´ÛŒ Ø§Ø² Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ" : ""),
            'reply_to_message_id' => $message_id,
            'parse_mode' => "html",
            'reply_markup' => $interaction_keyboard
        ]);
        
        // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø§ØµÙ„ÛŒ
        $MySQLi->query("INSERT INTO `dbfile` (`code`, `file_id`, `file`, `password`, `file_size`, `user_id`, `date`, `time`, `dl`) VALUES ('{$code}', '{$file_id}', '{$file_type}', '', '{$file_size}', '{$from_id}', '{$date}', '{$time}', '1')");
        
        // Ø¢Ù¾Ø¯ÛŒØª Ø¢Ù…Ø§Ø± Ú©Ø§Ø±Ø¨Ø±
        if (!$user_data) {
            $MySQLi->query("INSERT INTO `user` (`id`, `step`, `upload`, `code`) VALUES ('{$from_id}', 'none', '0', '')");
        } else {
            $MySQLi->query("UPDATE `user` SET `upload` = `upload` + 1 WHERE `id` = '{$from_id}' LIMIT 1");
        }
        
        // Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… ØªØ£ÛŒÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ
        if ($is_batch) {
            WSBot('sendmessage', [
                'chat_id' => $chat_id,
                'text' => "âœ… ÙØ§ÛŒÙ„ Ø¨Ù‡ Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯!\n\nğŸ“ ØªØ¹Ø¯Ø§Ø¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¢Ù¾Ù„ÙˆØ¯ Ø´Ø¯Ù‡: " . 
                         getBatchFileCount($user_data['code']) . 
                         "\nğŸ”¸ Ø¨Ø±Ø§ÛŒ Ø§ØªÙ…Ø§Ù… Ø¢Ù¾Ù„ÙˆØ¯ Ø§Ø² Ø¯Ú©Ù…Ù‡ 'Ø§ØªÙ…Ø§Ù… Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ' Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.",
                'reply_to_message_id' => $message_id
            ]);
        }
        
        return $code;
    } else {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "â–ªï¸ Ø®Ø·Ø§ , Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ù‚Ø¨Ù„Ø§ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø§Ù¾Ù„ÙˆØ¯ Ø´Ø¯Ù‡ Ø§Ø³Øª ... !",
            'reply_to_message_id' => $message_id
        ]);
        return false;
    }
}

// ØªØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§Ø±Ø´ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ú†
function getBatchFileCount($batch_code) {
    global $MySQLi;
    
    $result = mysqli_fetch_assoc(mysqli_query($MySQLi,
        "SELECT `file_count` FROM `batch_uploads` WHERE `batch_code` = '{$batch_code}'"
    ));
    
    return $result ? $result['file_count'] : 0;
}// Ø³Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ ØªÙ…Ø§Ù… Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ø¢Ù¾Ù„ÙˆØ¯ Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯
if(isset($message->document) && isAdmin($from_id)) {
    $file_id = $message->document->file_id;
    $file_size = $message->document->file_size;
    handleFileUpload('document', $file_id, $file_size, $message->caption, $from_id, $chat_id, $message_id);
}

if(isset($message->video) && isAdmin($from_id)) {
    $file_id = $message->video->file_id;
    $file_size = $message->video->file_size;
    handleFileUpload('video', $file_id, $file_size, $message->caption, $from_id, $chat_id, $message_id);
}

if(isset($message->photo) && isAdmin($from_id)) {
    $photo = $message->photo;
    $file_id = $photo[count($photo)-1]->file_id;
    $file_size = $photo[count($photo)-1]->file_size;
    handleFileUpload('photo', $file_id, $file_size, $message->caption, $from_id, $chat_id, $message_id);
}

// Ù‡Ù…ÛŒÙ†Ø·ÙˆØ± Ø¨Ø±Ø§ÛŒ audio, voice, sticker// Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ batch Ø¯Ø± start
elseif(strpos($text, "/start batch_") !== false) {
    $batch_code = str_replace("/start batch_", "", $text);
    $batch_data = mysqli_fetch_assoc(mysqli_query($MySQLi,
        "SELECT * FROM `batch_uploads` WHERE `batch_code` = '{$batch_code}' AND `status` = 'completed'"
    ));
    
    if ($batch_data) {
        $batch_files = getBatchFiles($batch_code);
        
        $message = "ğŸ“¦ Ù…Ø¬Ù…ÙˆØ¹Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§\n\n";
        $message .= "ğŸ“ ØªØ¹Ø¯Ø§Ø¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§: " . count($batch_files) . "\n";
        $message .= "ğŸ“… ØªØ§Ø±ÛŒØ® Ø¢Ù¾Ù„ÙˆØ¯: " . $batch_data['created_at'] . "\n\n";
        
        if ($batch_data['title']) {
            $message .= "ğŸ· Ø¹Ù†ÙˆØ§Ù†: " . $batch_data['title'] . "\n\n";
        }
        
        $message .= "ğŸ”— Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ù†Ù„ÙˆØ¯:\n";
        
        foreach ($batch_files as $index => $file) {
            $message .= ($index + 1) . ". ğŸ“¥ /dl_{$file['file_code']}\n";
        }
        
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => $message,
            'reply_to_message_id' => $message_id,
            'parse_mode' => 'HTML'
        ]);
    } else {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "âŒ Ù…Ø¬Ù…ÙˆØ¹Ù‡ ÙØ§ÛŒÙ„ ÛŒØ§ÙØª Ù†Ø´Ø¯ ÛŒØ§ Ø­Ø°Ù Ø´Ø¯Ù‡ Ø§Ø³Øª!",
            'reply_to_message_id' => $message_id
        ]);
    }
}// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§Ø¯Ù…ÛŒÙ†
if (isAdmin($from_id)) {
    $menu = json_encode(['keyboard' => [
        [['text' => "ğŸ“‚ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø§Ù¾Ù„ÙˆØ¯"], ['text' =>"ğŸ« Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ"]],
        [['text' => "ğŸ“¦ Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡"], ['text' => "ğŸ“¥ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‚Ø§Ø¨Ù„ Ø¯Ø§Ù†Ù„ÙˆØ¯"]],
        [['text' => "ğŸ”¥ Ù¾Ø±Ø·Ø±ÙØ¯Ø§Ø±ØªØ±ÛŒÙ†â€ŒÙ‡Ø§"], ['text' => "ğŸ›  Ù…Ø¯ÛŒØ±ÛŒØª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§"]],
        [['text' => "ğŸ” ØªÙ†Ø¸ÛŒÙ… Ù¾Ø³ÙˆØ±Ø¯"], ['text' => "ğŸ—‘ Ø­Ø°Ù ÙØ§ÛŒÙ„"]],
        [['text' => "ğŸ‘¤ Ù…Ø¯ÛŒØ±ÛŒØª"], ['text' => "ğŸ—‚ Ú©Ø¯ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ ÙØ§ÛŒÙ„"]]
        ], 'resize_keyboard' => true
    ]);
}// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ÙÛŒÙ„Ø¯ Ø¬Ø¯ÛŒØ¯ Ø¨Ù‡ Ø¬Ø¯ÙˆÙ„ Ù…ØªØ§Ø¯ÛŒØªØ§
if ($MySQLi->query("SELECT batch_code FROM `file_metadata`") == false) {
    mysqli_query($MySQLi, "ALTER TABLE `file_metadata` ADD `batch_code` varchar(50) DEFAULT NULL");
    mysqli_query($MySQLi, "ALTER TABLE `file_metadata` ADD INDEX `batch_code` (`batch_code`)");
}// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ù‡ Ø¬Ø¯ÙˆÙ„ Ø¢Ù¾Ù„ÙˆØ¯Ù‡Ø§ÛŒ Ú¯Ø±ÙˆÙ‡ÛŒ
if ($MySQLi->query("SELECT allow_custom_captions FROM `batch_uploads`") == false) {
    mysqli_query($MySQLi, "ALTER TABLE `batch_uploads` 
        ADD `allow_custom_captions` tinyint(1) DEFAULT 1,
        ADD `default_caption_template` text");
}// ØªÙˆØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ú©Ù¾Ø´Ù†â€ŒÙ†ÙˆÛŒØ³ÛŒ
function getCaptionTemplate() {
    return "ğŸ¬ {title}\nğŸ“º {episode}\nğŸ•’ {duration}\nğŸ“¹ {quality}\nğŸ {subtitle}\n\nğŸ“ {description}";
}

function parseCaptionTemplate($template, $data) {
    $replacements = [
        '{title}' => $data['title'] ?? 'Ø¹Ù†ÙˆØ§Ù† Ù†Ø§Ù…Ø´Ø®Øµ',
        '{episode}' => $data['episode'] ?? 'Ù‚Ø³Ù…Øª Ù†Ø§Ù…Ø´Ø®Øµ',
        '{duration}' => $data['duration'] ?? 'Ø²Ù…Ø§Ù† Ù†Ø§Ù…Ø´Ø®Øµ',
        '{quality}' => $data['quality'] ?? 'Ú©ÛŒÙÛŒØª Ù†Ø§Ù…Ø´Ø®Øµ',
        '{subtitle}' => $data['subtitle'] ?? 'Ø²ÛŒØ±Ù†ÙˆÛŒØ³ Ù†Ø§Ù…Ø´Ø®Øµ',
        '{description}' => $data['description'] ?? 'ØªÙˆØ¶ÛŒØ­Ø§ØªÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡'
    ];
    
    return str_replace(array_keys($replacements), array_values($replacements), $template);
}

function saveCustomCaption($file_id, $caption) {
    return file_put_contents("files/$file_id", $caption);
}// Ù…Ù†ÙˆÛŒ Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø¨Ø§ Ù‚Ø§Ø¨Ù„ÛŒØª Ú©Ù¾Ø´Ù†
$advanced_batch_menu = json_encode(['keyboard' => [
    [['text' => "ğŸ“¦ Ø´Ø±ÙˆØ¹ Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ Ø¬Ø¯ÛŒØ¯"]],
    [['text' => "âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ù¾Ø´Ù†"], ['text' => "ğŸ“ Ù‚Ø§Ù„Ø¨ Ú©Ù¾Ø´Ù† Ù¾ÛŒØ´â€ŒÙØ±Ø¶"]],
    [['text' => "ğŸ¬ Ø§ÙØ²ÙˆØ¯Ù† ÙØ§ÛŒÙ„ Ø¨Ø§ Ú©Ù¾Ø´Ù†"]],
    [['text' => "ğŸ“ Ø§ÙØ²ÙˆØ¯Ù† ÙØ§ÛŒÙ„ Ø³Ø±ÛŒØ¹"]],
    [['text' => "âœ… Ø§ØªÙ…Ø§Ù… Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ"]],
    [['text' => "âŒ Ù„ØºÙˆ Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ"]],
    [['text' => "ğŸ”™ Ø¨Ø±Ú¯Ø´Øª"]]
    ], 'resize_keyboard' => true
]);// Ø´Ø±ÙˆØ¹ Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ Ø¨Ø§ Ú©Ù¾Ø´Ù†
elseif ($text == "ğŸ¬ Ø§ÙØ²ÙˆØ¯Ù† ÙØ§ÛŒÙ„ Ø¨Ø§ Ú©Ù¾Ø´Ù†") {
    $batch_data = mysqli_fetch_assoc(mysqli_query($MySQLi,
        "SELECT * FROM `batch_uploads` 
         WHERE `user_id` = '{$from_id}' AND `status` = 'uploading' 
         ORDER BY `created_at` DESC LIMIT 1"
    ));
    
    if ($batch_data) {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "ğŸ¬ Ø§ÙØ²ÙˆØ¯Ù† ÙØ§ÛŒÙ„ Ø¨Ø§ Ú©Ù¾Ø´Ù† Ú©Ø§Ù…Ù„\n\nÙ„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ ÙØ§ÛŒÙ„ Ø®ÙˆØ¯ Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯ (ÙˆÛŒØ¯ÛŒÙˆØŒ Ø¹Ú©Ø³ØŒ ÙØ§ÛŒÙ„ Ùˆ...)\nØ³Ù¾Ø³ Ú©Ù¾Ø´Ù† Ú©Ø§Ù…Ù„ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ù†Ù…Ø§ÛŒÛŒØ¯.",
            'reply_to_message_id' => $message_id,
            'reply_markup' => $back
        ]);
        
        $MySQLi->query("UPDATE `user` SET `step` = 'waiting_for_file_with_caption' WHERE `id` = '{$from_id}' LIMIT 1");
    } else {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "âŒ Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ Ø¬Ø¯ÛŒØ¯ Ø´Ø±ÙˆØ¹ Ú©Ù†ÛŒØ¯!",
            'reply_to_message_id' => $message_id
        ]);
    }
}

// Ù¾Ø±Ø¯Ø§Ø²Ø´ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ÛŒ Ø¨Ø§ Ú©Ù¾Ø´Ù†
elseif ($user['step'] == 'waiting_for_file_with_caption' && 
       (isset($message->document) || isset($message->video) || isset($message->photo) || 
        isset($message->audio) || isset($message->voice) || isset($message->sticker))) {
    
    // Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙØ§ÛŒÙ„ Ù…ÙˆÙ‚Øª
    $file_type = '';
    $file_id = '';
    $file_size = 0;
    
    if (isset($message->document)) {
        $file_type = 'document';
        $file_id = $message->document->file_id;
        $file_size = $message->document->file_size;
    } elseif (isset($message->video)) {
        $file_type = 'video';
        $file_id = $message->video->file_id;
        $file_size = $message->video->file_size;
    } elseif (isset($message->photo)) {
        $file_type = 'photo';
        $photo = $message->photo;
        $file_id = $photo[count($photo)-1]->file_id;
        $file_size = $photo[count($photo)-1]->file_size;
    } elseif (isset($message->audio)) {
        $file_type = 'audio';
        $file_id = $message->audio->file_id;
        $file_size = $message->audio->file_size;
    } elseif (isset($message->voice)) {
        $file_type = 'voice';
        $file_id = $message->voice->file_id;
        $file_size = $message->voice->file_size;
    } elseif (isset($message->sticker)) {
        $file_type = 'sticker';
        $file_id = $message->sticker->file_id;
        $file_size = $message->sticker->file_size;
    }
    
    // Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙØ§ÛŒÙ„ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ù…ÙˆÙ‚Øª
    $MySQLi->query("UPDATE `user` SET `step` = 'waiting_for_caption', `code` = '{$file_id}', `upload` = '{$file_size}' WHERE `id` = '{$from_id}' LIMIT 1");
    
    // Ø§Ø±Ø³Ø§Ù„ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ú©Ù¾Ø´Ù†â€ŒÙ†ÙˆÛŒØ³ÛŒ
    $caption_guide = "ğŸ“ Ù„Ø·ÙØ§Ù‹ Ú©Ù¾Ø´Ù† ÙØ§ÛŒÙ„ Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯:\n\n";
    $caption_guide .= "ğŸ’¡ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø² Ù‚Ø§Ù„Ø¨ Ø²ÛŒØ± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯:\n\n";
    $caption_guide .= "ğŸ¬ Ø³Ø±ÛŒØ§Ù„ ÙˆÛŒÙ†\n";
    $caption_guide .= "ğŸ“º Wayne S01E08 - ÙØµÙ„ 1 Ù‚Ø³Ù…Øª 8\n";
    $caption_guide .= "ğŸ•’ 34:55\n";
    $caption_guide .= "ğŸ“¹ 720p WEB-DL Ú©ÛŒÙÛŒØª\n";
    $caption_guide .= "ğŸ Ø²ÛŒØ±Ù†ÙˆÛŒØ³ Ú†Ø³Ø¨ÛŒØ¯Ù‡ ÙØ§Ø±Ø³ÛŒ\n\n";
    $caption_guide .= "ğŸ“ ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§Ø¶Ø§ÙÛŒ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)";
    
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => $caption_guide,
        'reply_to_message_id' => $message_id,
        'reply_markup' => json_encode(['keyboard' => [
            [['text' => "Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù‚Ø§Ù„Ø¨ Ù¾ÛŒØ´â€ŒÙØ±Ø¶"]],
            [['text' => "Ù„ØºÙˆ Ø§ÙØ²ÙˆØ¯Ù† Ø§ÛŒÙ† ÙØ§ÛŒÙ„"]]
            ], 'resize_keyboard' => true])
    ]);
}

// Ù¾Ø±Ø¯Ø§Ø²Ø´ Ú©Ù¾Ø´Ù† Ø§Ø±Ø³Ø§Ù„ÛŒ
elseif ($user['step'] == 'waiting_for_caption') {
    $file_id = $user['code'];
    $file_size = $user['upload'];
    
    if ($text == "Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù‚Ø§Ù„Ø¨ Ù¾ÛŒØ´â€ŒÙØ±Ø¶") {
        $caption_data = [
            'title' => 'Ø¹Ù†ÙˆØ§Ù† ÙØ§ÛŒÙ„',
            'episode' => 'Ù‚Ø³Ù…Øª Ù†Ø§Ù…Ø´Ø®Øµ',
            'duration' => 'Ø²Ù…Ø§Ù† Ù†Ø§Ù…Ø´Ø®Øµ',
            'quality' => 'Ú©ÛŒÙÛŒØª Ù†Ø§Ù…Ø´Ø®Øµ',
            'subtitle' => 'Ø²ÛŒØ±Ù†ÙˆÛŒØ³ Ù†Ø§Ù…Ø´Ø®Øµ',
            'description' => 'ØªÙˆØ¶ÛŒØ­Ø§Øª ÙØ§ÛŒÙ„'
        ];
        $caption = parseCaptionTemplate(getCaptionTemplate(), $caption_data);
    } elseif ($text == "Ù„ØºÙˆ Ø§ÙØ²ÙˆØ¯Ù† Ø§ÛŒÙ† ÙØ§ÛŒÙ„") {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "âŒ Ø§ÙØ²ÙˆØ¯Ù† ÙØ§ÛŒÙ„ Ù„ØºÙˆ Ø´Ø¯.",
            'reply_to_message_id' => $message_id,
            'reply_markup' => $advanced_batch_menu
        ]);
        $MySQLi->query("UPDATE `user` SET `step` = 'batch_upload', `code` = '', `upload` = '0' WHERE `id` = '{$from_id}' LIMIT 1");
        exit();
    } else {
        $caption = $text;
    }
    
    // Ù¾Ø±Ø¯Ø§Ø²Ø´ Ùˆ Ø°Ø®ÛŒØ±Ù‡ ÙØ§ÛŒÙ„ Ø¨Ø§ Ú©Ù¾Ø´Ù†
    $batch_data = mysqli_fetch_assoc(mysqli_query($MySQLi,
        "SELECT * FROM `batch_uploads` 
         WHERE `user_id` = '{$from_id}' AND `status` = 'uploading' 
         ORDER BY `created_at` DESC LIMIT 1"
    ));
    
    if ($batch_data) {
        // ØªØ¹ÛŒÛŒÙ† Ù†ÙˆØ¹ ÙØ§ÛŒÙ„
        $file_type = 'document';
        if (isset($message->video)) $file_type = 'video';
        elseif (isset($message->photo)) $file_type = 'photo';
        elseif (isset($message->audio)) $file_type = 'audio';
        elseif (isset($message->voice)) $file_type = 'voice';
        elseif (isset($message->sticker)) $file_type = 'sticker';
        
        // Ù¾Ø±Ø¯Ø§Ø²Ø´ ÙØ§ÛŒÙ„
        $file_code = handleFileUpload($file_type, $file_id, $file_size, $caption, $from_id, $chat_id, $message_id);
        
        if ($file_code) {
            WSBot('sendmessage', [
                'chat_id' => $chat_id,
                'text' => "âœ… ÙØ§ÛŒÙ„ Ø¨Ø§ Ú©Ù¾Ø´Ù† Ø§Ø®ØªØµØ§ØµÛŒ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯!\n\nğŸ“ Ú©Ù¾Ø´Ù†:\n{$caption}",
                'reply_to_message_id' => $message_id,
                'reply_markup' => $advanced_batch_menu
            ]);
        }
    }
    
    $MySQLi->query("UPDATE `user` SET `step` = 'batch_upload', `code` = '', `upload` = '0' WHERE `id` = '{$from_id}' LIMIT 1");
}// ØªÙ†Ø¸ÛŒÙ… Ù‚Ø§Ù„Ø¨ Ú©Ù¾Ø´Ù† Ù¾ÛŒØ´â€ŒÙØ±Ø¶
elseif ($text == "ğŸ“ Ù‚Ø§Ù„Ø¨ Ú©Ù¾Ø´Ù† Ù¾ÛŒØ´â€ŒÙØ±Ø¶") {
    $current_template = getCaptionTemplate();
    
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "ğŸ“ Ù‚Ø§Ù„Ø¨ Ú©Ù¾Ø´Ù† Ù¾ÛŒØ´â€ŒÙØ±Ø¶\n\nÙ‚Ø§Ù„Ø¨ ÙØ¹Ù„ÛŒ:\n{$current_template}\n\nÙ…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡:\n{title} - Ø¹Ù†ÙˆØ§Ù†\n{episode} - Ù‚Ø³Ù…Øª\n{duration} - Ù…Ø¯Øª Ø²Ù…Ø§Ù†\n{quality} - Ú©ÛŒÙÛŒØª\n{subtitle} - Ø²ÛŒØ±Ù†ÙˆÛŒØ³\n{description} - ØªÙˆØ¶ÛŒØ­Ø§Øª\n\nÙ„Ø·ÙØ§Ù‹ Ù‚Ø§Ù„Ø¨ Ø¬Ø¯ÛŒØ¯ Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯:",
        'reply_to_message_id' => $message_id,
        'reply_markup' => $back
    ]);
    
    $MySQLi->query("UPDATE `user` SET `step` = 'set_caption_template' WHERE `id` = '{$from_id}' LIMIT 1");
}

elseif ($user['step'] == 'set_caption_template') {
    // Ø°Ø®ÛŒØ±Ù‡ Ù‚Ø§Ù„Ø¨ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³
    $template = mysqli_real_escape_string($MySQLi, $text);
    
    $batch_data = mysqli_fetch_assoc(mysqli_query($MySQLi,
        "SELECT * FROM `batch_uploads` 
         WHERE `user_id` = '{$from_id}' AND `status` = 'uploading' 
         ORDER BY `created_at` DESC LIMIT 1"
    ));
    
    if ($batch_data) {
        mysqli_query($MySQLi,
            "UPDATE `batch_uploads` 
             SET `default_caption_template` = '{$template}' 
             WHERE `batch_code` = '{$batch_data['batch_code']}'"
        );
    }
    
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "âœ… Ù‚Ø§Ù„Ø¨ Ú©Ù¾Ø´Ù† Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯!",
        'reply_to_message_id' => $message_id,
        'reply_markup' => $advanced_batch_menu
    ]);
    
    $MySQLi->query("UPDATE `user` SET `step` = 'batch_upload' WHERE `id` = '{$from_id}' LIMIT 1");
}function handleFileUpload($file_type, $file_id, $file_size, $caption, $from_id, $chat_id, $message_id) {
    global $MySQLi, $usernamebot;
    
    // Ø¨Ø±Ø±Ø³ÛŒ ØªÚ©Ø±Ø§Ø±ÛŒ Ù†Ø¨ÙˆØ¯Ù† ÙØ§ÛŒÙ„
    $file = mysqli_fetch_assoc(mysqli_query($MySQLi, "SELECT * FROM `dbfile` WHERE `file_id` = '{$file_id}' LIMIT 1"));
    
    if(!$file) {
        // Ø°Ø®ÛŒØ±Ù‡ Ú©Ù¾Ø´Ù†
        saveCustomCaption($file_id, $caption);
        
        $code = RandomString();
        $size = convert($file_size);
        $time = date('h:i:s');
        $date = date('Y/m/d');
        
        // Ø°Ø®ÛŒØ±Ù‡ Ù…ØªØ§Ø¯ÛŒØªØ§
        saveFileMetadata($code, $file_id, $from_id, $caption);
        
        // Ø¨Ø±Ø±Ø³ÛŒ Ø§Ú¯Ø± Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ Ù‡Ø³ØªÛŒÙ…
        $user_data = mysqli_fetch_assoc(mysqli_query($MySQLi, 
            "SELECT * FROM `user` WHERE `id` = '{$from_id}'"
        ));
        
        $is_batch = false;
        $batch_title = "";
        if ($user_data && strpos($user_data['step'], 'batch_uploading') !== false) {
            addFileToBatch($user_data['code'], $code, $file_type);
            $is_batch = true;
            
            // Ø¯Ø±ÛŒØ§ÙØª Ø¹Ù†ÙˆØ§Ù† Ø¨Ú†
            $batch_info = mysqli_fetch_assoc(mysqli_query($MySQLi,
                "SELECT * FROM `batch_uploads` WHERE `batch_code` = '{$user_data['code']}'"
            ));
            $batch_title = $batch_info['title'] ?? '';
        }
        
        // Ø«Ø¨Øª ØªØ¹Ø§Ù…Ù„
        recordInteraction($code, $from_id, 'view');
        $interaction_keyboard = getInteractionKeyboard($code, $from_id);
        
        // Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù¾Ø´Ù† Ù†Ù‡Ø§ÛŒÛŒ
        $final_caption = $caption;
        if ($is_batch && $batch_title) {
            $final_caption = "ğŸ“¦ {$batch_title}\n\n" . $final_caption;
        }
        
        $final_caption .= "\n\nğŸ“¥ ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø§Ù†Ù„ÙˆØ¯: 1\nğŸ”— @" . $usernamebot;
        
        // Ø§Ø±Ø³Ø§Ù„ ÙØ§ÛŒÙ„
        $method = 'send' . $file_type;
        $success_message = WSBot($method, [
            'chat_id' => $chat_id,
            $file_type => $file_id,
            'caption' => $final_caption,
            'reply_to_message_id' => $message_id,
            'parse_mode' => "HTML",
            'reply_markup' => $interaction_keyboard
        ]);
        
        // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø§ØµÙ„ÛŒ
        $MySQLi->query("INSERT INTO `dbfile` (`code`, `file_id`, `file`, `password`, `file_size`, `user_id`, `date`, `time`, `dl`) VALUES ('{$code}', '{$file_id}', '{$file_type}', '', '{$file_size}', '{$from_id}', '{$date}', '{$time}', '1')");
        
        // Ø¢Ù¾Ø¯ÛŒØª Ø¢Ù…Ø§Ø± Ú©Ø§Ø±Ø¨Ø±
        if (!$user_data) {
            $MySQLi->query("INSERT INTO `user` (`id`, `step`, `upload`, `code`) VALUES ('{$from_id}', 'none', '0', '')");
        } else {
            $MySQLi->query("UPDATE `user` SET `upload` = `upload` + 1 WHERE `id` = '{$from_id}' LIMIT 1");
        }
        
        return $code;
    } else {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "â–ªï¸ Ø®Ø·Ø§ , Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ù‚Ø¨Ù„Ø§ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø§Ù¾Ù„ÙˆØ¯ Ø´Ø¯Ù‡ Ø§Ø³Øª ... !",
            'reply_to_message_id' => $message_id
        ]);
        return false;
    }
}// Ø¢Ù¾Ù„ÙˆØ¯ Ø³Ø±ÛŒØ¹ Ø¨Ø¯ÙˆÙ† Ú©Ù¾Ø´Ù†
elseif ($text == "ğŸ“ Ø§ÙØ²ÙˆØ¯Ù† ÙØ§ÛŒÙ„ Ø³Ø±ÛŒØ¹") {
    $batch_data = mysqli_fetch_assoc(mysqli_query($MySQLi,
        "SELECT * FROM `batch_uploads` 
         WHERE `user_id` = '{$from_id}' AND `status` = 'uploading' 
         ORDER BY `created_at` DESC LIMIT 1"
    ));
    
    if ($batch_data) {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "ğŸ“ Ø§ÙØ²ÙˆØ¯Ù† ÙØ§ÛŒÙ„ Ø³Ø±ÛŒØ¹\n\nÙ„Ø·ÙØ§Ù‹ ÙØ§ÛŒÙ„ Ø®ÙˆØ¯ Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯.\nÚ©Ù¾Ø´Ù† Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.",
            'reply_to_message_id' => $message_id,
            'reply_markup' => $back
        ]);
        
        $MySQLi->query("UPDATE `user` SET `step` = 'waiting_for_file_quick' WHERE `id` = '{$from_id}' LIMIT 1");
    } else {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "âŒ Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ Ø¬Ø¯ÛŒØ¯ Ø´Ø±ÙˆØ¹ Ú©Ù†ÛŒØ¯!",
            'reply_to_message_id' => $message_id
        ]);
    }
}

// Ù¾Ø±Ø¯Ø§Ø²Ø´ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø³Ø±ÛŒØ¹
elseif ($user['step'] == 'waiting_for_file_quick' && 
       (isset($message->document) || isset($message->video) || isset($message->photo) || 
        isset($message->audio) || isset($message->voice) || isset($message->sticker))) {
    
    // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ú©Ù¾Ø´Ù† Ù¾ÛŒØ´â€ŒÙØ±Ø¶
    $caption_data = [
        'title' => 'ÙØ§ÛŒÙ„ Ø¬Ø¯ÛŒØ¯',
        'episode' => '',
        'duration' => '',
        'quality' => '',
        'subtitle' => '',
        'description' => 'ØªÙˆØ¶ÛŒØ­Ø§Øª ÙØ§ÛŒÙ„'
    ];
    
    $batch_info = mysqli_fetch_assoc(mysqli_query($MySQLi,
        "SELECT * FROM `batch_uploads` WHERE `batch_code` = '{$user['code']}'"
    ));
    
    $caption = $batch_info['default_caption_template'] ? 
        parseCaptionTemplate($batch_info['default_caption_template'], $caption_data) : 
        parseCaptionTemplate(getCaptionTemplate(), $caption_data);
    
    // Ù¾Ø±Ø¯Ø§Ø²Ø´ ÙØ§ÛŒÙ„
    $file_type = '';
    $file_id = '';
    $file_size = 0;
    
    if (isset($message->document)) {
        $file_type = 'document';
        $file_id = $message->document->file_id;
        $file_size = $message->document->file_size;
    } elseif (isset($message->video)) {
        $file_type = 'video';
        $file_id = $message->video->file_id;
        $file_size = $message->video->file_size;
    }
    // ... Ø§Ù†ÙˆØ§Ø¹ Ø¯ÛŒÚ¯Ø± ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
    
    $file_code = handleFileUpload($file_type, $file_id, $file_size, $caption, $from_id, $chat_id, $message_id);
    
    if ($file_code) {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "âœ… ÙØ§ÛŒÙ„ Ø¨Ù‡ ØµÙˆØ±Øª Ø³Ø±ÛŒØ¹ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯!",
            'reply_to_message_id' => $message_id,
            'reply_markup' => $advanced_batch_menu
        ]);
    }
    
    $MySQLi->query("UPDATE `user` SET `step` = 'batch_upload' WHERE `id` = '{$from_id}' LIMIT 1");
}// ØªØºÛŒÛŒØ± Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ
elseif ($text == "ğŸ“¦ Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡") {
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "ğŸ“¦ Ø³ÛŒØ³ØªÙ… Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡\n\nğŸ· Ø§Ú©Ù†ÙˆÙ† Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ù‡Ø± ÙØ§ÛŒÙ„ Ú©Ù¾Ø´Ù† Ø§Ø®ØªØµØ§ØµÛŒ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯!\n\nğŸ“ Ø§Ù…Ú©Ø§Ù†Ø§Øª Ø¬Ø¯ÛŒØ¯:\nâ€¢ Ú©Ù¾Ø´Ù†â€ŒÙ†ÙˆÛŒØ³ÛŒ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ù‡Ø± ÙØ§ÛŒÙ„\nâ€¢ Ù‚Ø§Ù„Ø¨â€ŒÙ‡Ø§ÛŒ Ù‚Ø§Ø¨Ù„ ØªÙ†Ø¸ÛŒÙ…\nâ€¢ Ø¢Ù¾Ù„ÙˆØ¯ Ø³Ø±ÛŒØ¹ Ø¨Ø§ Ú©Ù¾Ø´Ù† Ù¾ÛŒØ´â€ŒÙØ±Ø¶\nâ€¢ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ù…Ù„ Ù…Ø­ØªÙˆØ§",
        'reply_to_message_id' => $message_id,
        'reply_markup' => $advanced_batch_menu
    ]);
    $MySQLi->query("UPDATE `user` SET `step` = 'batch_upload' WHERE `id` = '{$from_id}' LIMIT 1");
}// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø¬Ù…ÙˆØ¹Ù‡â€ŒÙ‡Ø§
if ($MySQLi->query("SELECT is_series FROM `batch_uploads`") == false) {
    mysqli_query($MySQLi, "ALTER TABLE `batch_uploads` 
        ADD `is_series` tinyint(1) DEFAULT 0,
        ADD `series_name` varchar(255) DEFAULT NULL,
        ADD `season_number` int(11) DEFAULT 1,
        ADD `total_episodes` int(11) DEFAULT 0,
        ADD `can_continue` tinyint(1) DEFAULT 1,
        ADD `parent_batch` varchar(50) DEFAULT NULL");
}// ØªÙˆØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø¬Ù…ÙˆØ¹Ù‡â€ŒÙ‡Ø§
function getSeriesBatches($series_name, $season_number = 1) {
    global $MySQLi;
    
    $series_name = mysqli_real_escape_string($MySQLi, $series_name);
    $batches = mysqli_query($MySQLi,
        "SELECT * FROM `batch_uploads` 
         WHERE `series_name` = '{$series_name}' 
         AND `season_number` = '{$season_number}'
         AND `status` = 'completed'
         ORDER BY `created_at` ASC"
    );
    
    $result = [];
    while ($row = mysqli_fetch_assoc($batches)) {
        $result[] = $row;
    }
    return $result;
}

function continueBatchUpload($batch_code) {
    global $MySQLi;
    
    // ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ø¨Ú† Ø¨Ù‡ Ø­Ø§Ù„Øª Ø¢Ù¾Ù„ÙˆØ¯ Ù…Ø¬Ø¯Ø¯
    mysqli_query($MySQLi,
        "UPDATE `batch_uploads` 
         SET `status` = 'uploading', `updated_at` = CURRENT_TIMESTAMP 
         WHERE `batch_code` = '{$batch_code}'"
    );
    
    return $batch_code;
}

function getSeriesEpisodes($series_name, $season_number = 1) {
    global $MySQLi;
    
    $series_name = mysqli_real_escape_string($MySQLi, $series_name);
    $episodes = mysqli_query($MySQLi,
        "SELECT fm.*, d.file_size, d.dl, d.file as file_type, b.batch_code
         FROM `file_metadata` fm
         LEFT JOIN `dbfile` d ON fm.file_code = d.code
         LEFT JOIN `batch_uploads` b ON fm.batch_code = b.batch_code
         WHERE b.series_name = '{$series_name}' 
         AND b.season_number = '{$season_number}'
         AND b.status = 'completed'
         ORDER BY fm.created_at ASC"
    );
    
    $result = [];
    while ($row = mysqli_fetch_assoc($episodes)) {
        $result[] = $row;
    }
    return $result;
}// Ù…Ù†ÙˆÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø±ÛŒØ§Ù„â€ŒÙ‡Ø§ Ùˆ Ù…Ø¬Ù…ÙˆØ¹Ù‡â€ŒÙ‡Ø§
$series_management = json_encode(['keyboard' => [
    [['text' => "ğŸ“º Ø´Ø±ÙˆØ¹ Ø³Ø±ÛŒØ§Ù„ Ø¬Ø¯ÛŒØ¯"], ['text' => "â• Ø§Ø¯Ø§Ù…Ù‡ Ø³Ø±ÛŒØ§Ù„ Ù…ÙˆØ¬ÙˆØ¯"]],
    [['text' => "ğŸ“‹ Ù„ÛŒØ³Øª Ø³Ø±ÛŒØ§Ù„â€ŒÙ‡Ø§"], ['text' => "ğŸ¬ Ù…Ø¯ÛŒØ±ÛŒØª Ù‚Ø³Ù…Øªâ€ŒÙ‡Ø§"]],
    [['text' => "ğŸ” Ø¬Ø³ØªØ¬ÙˆÛŒ Ø³Ø±ÛŒØ§Ù„"], ['text' => "ğŸ“Š Ø¢Ù…Ø§Ø± Ø³Ø±ÛŒØ§Ù„"]],
    [['text' => "ğŸ”™ Ø¨Ø±Ú¯Ø´Øª"]]
    ], 'resize_keyboard' => true
]);// Ø´Ø±ÙˆØ¹ ÛŒÚ© Ø³Ø±ÛŒØ§Ù„ Ø¬Ø¯ÛŒØ¯
elseif ($text == "ğŸ“º Ø´Ø±ÙˆØ¹ Ø³Ø±ÛŒØ§Ù„ Ø¬Ø¯ÛŒØ¯") {
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "ğŸ“º Ø´Ø±ÙˆØ¹ Ø³Ø±ÛŒØ§Ù„ Ø¬Ø¯ÛŒØ¯\n\nÙ„Ø·ÙØ§Ù‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³Ø±ÛŒØ§Ù„ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:\n\n1. Ù†Ø§Ù… Ø³Ø±ÛŒØ§Ù„\n2. Ø´Ù…Ø§Ø±Ù‡ ÙØµÙ„ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ - Ù¾ÛŒØ´â€ŒÙØ±Ø¶: 1)\n3. ØªØ¹Ø¯Ø§Ø¯ Ù‚Ø³Ù…Øªâ€ŒÙ‡Ø§ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)\n\nğŸ“ Ù…Ø«Ø§Ù„:\nØ³Ø±ÛŒØ§Ù„ ÙˆÛŒÙ†\nÙØµÙ„ 1\n12 Ù‚Ø³Ù…Øª",
        'reply_to_message_id' => $message_id,
        'reply_markup' => $back
    ]);
    
    $MySQLi->query("UPDATE `user` SET `step` = 'new_series_info' WHERE `id` = '{$from_id}' LIMIT 1");
}

elseif ($user['step'] == 'new_series_info') {
    // Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³Ø±ÛŒØ§Ù„
    $lines = explode("\n", $text);
    $series_name = trim($lines[0]);
    $season = 1;
    $total_episodes = 0;
    
    foreach ($lines as $line) {
        if (strpos($line, 'ÙØµÙ„') !== false) {
            preg_match('/\d+/', $line, $matches);
            if ($matches) $season = intval($matches[0]);
        }
        if (strpos($line, 'Ù‚Ø³Ù…Øª') !== false) {
            preg_match('/\d+/', $line, $matches);
            if ($matches) $total_episodes = intval($matches[0]);
        }
    }
    
    $batch_code = createBatchUpload($from_id, $series_name);
    
    // Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³Ø±ÛŒØ§Ù„
    mysqli_query($MySQLi,
        "UPDATE `batch_uploads` 
         SET `is_series` = 1, `series_name` = '{$series_name}', 
             `season_number` = '{$season}', `total_episodes` = '{$total_episodes}'
         WHERE `batch_code` = '{$batch_code}'"
    );
    
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "âœ… Ø³Ø±ÛŒØ§Ù„ Ø¬Ø¯ÛŒØ¯ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯!\n\nğŸ“º Ù†Ø§Ù…: {$series_name}\nğŸ¬ ÙØµÙ„: {$season}\nğŸ“ ØªØ¹Ø¯Ø§Ø¯ Ù‚Ø³Ù…Øªâ€ŒÙ‡Ø§: {$total_episodes}\nğŸ”¸ Ú©Ø¯ Ø³Ø±ÛŒØ§Ù„: <code>{$batch_code}</code>\n\nØ§Ú©Ù†ÙˆÙ† Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ù‚Ø³Ù…Øªâ€ŒÙ‡Ø§ Ø±Ø§ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯.",
        'reply_to_message_id' => $message_id,
        'parse_mode' => 'HTML',
        'reply_markup' => $advanced_batch_menu
    ]);
    
    $MySQLi->query("UPDATE `user` SET `step` = 'batch_upload', `code` = '{$batch_code}' WHERE `id` = '{$from_id}' LIMIT 1");
}// Ø§Ø¯Ø§Ù…Ù‡ Ø³Ø±ÛŒØ§Ù„ Ù…ÙˆØ¬ÙˆØ¯
elseif ($text == "â• Ø§Ø¯Ø§Ù…Ù‡ Ø³Ø±ÛŒØ§Ù„ Ù…ÙˆØ¬ÙˆØ¯") {
    $series_list = mysqli_query($MySQLi,
        "SELECT DISTINCT `series_name`, `season_number` 
         FROM `batch_uploads` 
         WHERE `is_series` = 1 AND `user_id` = '{$from_id}'
         ORDER BY `series_name`, `season_number`"
    );
    
    if (mysqli_num_rows($series_list) > 0) {
        $message = "ğŸ“º Ø§Ù†ØªØ®Ø§Ø¨ Ø³Ø±ÛŒØ§Ù„ Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ø§Ù…Ù‡\n\n";
        $keyboard = ['inline_keyboard' => []];
        
        while ($series = mysqli_fetch_assoc($series_list)) {
            $episode_count = mysqli_fetch_assoc(mysqli_query($MySQLi,
                "SELECT COUNT(*) as count FROM `file_metadata` fm
                 LEFT JOIN `batch_uploads` b ON fm.batch_code = b.batch_code
                 WHERE b.series_name = '{$series['series_name']}' 
                 AND b.season_number = '{$series['season_number']}'"
            ));
            
            $keyboard['inline_keyboard'][] = [
                [
                    'text' => "{$series['series_name']} - ÙØµÙ„ {$series['season_number']} ({$episode_count['count']} Ù‚Ø³Ù…Øª)",
                    'callback_data' => "continue_series_{$series['series_name']}_{$series['season_number']}"
                ]
            ];
        }
        
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => $message,
            'reply_to_message_id' => $message_id,
            'reply_markup' => json_encode($keyboard)
        ]);
    } else {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "âŒ Ù‡ÛŒÚ† Ø³Ø±ÛŒØ§Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ø§Ù…Ù‡ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯!",
            'reply_to_message_id' => $message_id
        ]);
    }
}

// Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø§Ù†ØªØ®Ø§Ø¨ Ø³Ø±ÛŒØ§Ù„ Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ø§Ù…Ù‡
elseif (strpos($data, "continue_series_") === 0) {
    $series_info = str_replace("continue_series_", "", $data);
    list($series_name, $season) = explode("_", $series_info);
    
    // Ø§ÛŒØ¬Ø§Ø¯ Ø¨Ú† Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ø§Ù…Ù‡
    $new_batch_code = createBatchUpload($fromid, $series_name . " - Ø§Ø¯Ø§Ù…Ù‡");
    
    // ØªÙ†Ø¸ÛŒÙ… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³Ø±ÛŒØ§Ù„
    mysqli_query($MySQLi,
        "UPDATE `batch_uploads` 
         SET `is_series` = 1, `series_name` = '{$series_name}', 
             `season_number` = '{$season}', `parent_batch` = '{$series_info}'
         WHERE `batch_code` = '{$new_batch_code}'"
    );
    
    WSBot('editmessagetext', [
        'chat_id' => $chatid,
        'message_id' => $messageid,
        'text' => "âœ… Ø³Ø±ÛŒØ§Ù„ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯!\n\nğŸ“º Ù†Ø§Ù…: {$series_name}\nğŸ¬ ÙØµÙ„: {$season}\nğŸ”¸ Ú©Ø¯ Ø¢Ù¾Ù„ÙˆØ¯ Ø¬Ø¯ÛŒØ¯: <code>{$new_batch_code}</code>\n\nØ§Ú©Ù†ÙˆÙ† Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ù‚Ø³Ù…Øªâ€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø±Ø§ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯.",
        'parse_mode' => 'HTML'
    ]);
    
    // Ø§Ø±Ø³Ø§Ù„ Ù…Ù†ÙˆÛŒ Ø¢Ù¾Ù„ÙˆØ¯
    WSBot('sendmessage', [
        'chat_id' => $chatid,
        'text' => "ğŸ“¦ Ø³ÛŒØ³ØªÙ… Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ - Ø§Ø¯Ø§Ù…Ù‡ Ø³Ø±ÛŒØ§Ù„",
        'reply_markup' => $advanced_batch_menu
    ]);
    
    $MySQLi->query("UPDATE `user` SET `step` = 'batch_upload', `code` = '{$new_batch_code}' WHERE `id` = '{$fromid}' LIMIT 1");
}// ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù‡Ù…Ù‡ Ù‚Ø³Ù…Øªâ€ŒÙ‡Ø§ÛŒ ÛŒÚ© Ø³Ø±ÛŒØ§Ù„
function getSeriesDownloadLinks($series_name, $season_number = 1) {
    $episodes = getSeriesEpisodes($series_name, $season_number);
    
    if (empty($episodes)) {
        return "âŒ Ù‡ÛŒÚ† Ù‚Ø³Ù…ØªÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø³Ø±ÛŒØ§Ù„ ÛŒØ§ÙØª Ù†Ø´Ø¯!";
    }
    
    $message = "ğŸ“º Ø³Ø±ÛŒØ§Ù„: {$series_name} - ÙØµÙ„ {$season_number}\n\n";
    $message .= "ğŸ“ ØªØ¹Ø¯Ø§Ø¯ Ù‚Ø³Ù…Øªâ€ŒÙ‡Ø§: " . count($episodes) . "\n\n";
    $message .= "ğŸ”— Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ù†Ù„ÙˆØ¯:\n\n";
    
    foreach ($episodes as $index => $episode) {
        $episode_number = $index + 1;
        $message .= "{$episode_number}. ğŸ“¥ /dl_{$episode['file_code']}\n";
        
        // Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø®ØªØµØ± Ù‡Ø± Ù‚Ø³Ù…Øª
        if (!empty($episode['custom_title'])) {
            $message .= "   ğŸ¬ " . substr($episode['custom_title'], 0, 30) . "...\n";
        }
        $message .= "   ğŸ‘ " . formatNumber($episode['dl']) . " Ø¯Ø§Ù†Ù„ÙˆØ¯\n";
        $message .= "   â–â–â–â–â–\n";
    }
    
    $message .= "\nğŸŒ Ù„ÛŒÙ†Ú© Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ú©Ù„ Ø³Ø±ÛŒØ§Ù„:\n";
    $message .= "https://t.me/" . $GLOBALS['usernamebot'] . "?start=series_{$series_name}_{$season_number}";
    
    return $message;
}

// Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ø³Ø±ÛŒØ§Ù„
elseif(strpos($text, "/start series_") !== false) {
    $series_info = str_replace("/start series_", "", $text);
    list($series_name, $season) = explode("_", $series_info);
    
    $download_links = getSeriesDownloadLinks($series_name, $season);
    
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => $download_links,
        'reply_to_message_id' => $message_id,
        'parse_mode' => 'HTML'
    ]);
}// Ø¨Ù‡Ø¨ÙˆØ¯ ØªØ§Ø¨Ø¹ Ø§ØªÙ…Ø§Ù… Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ
elseif ($text == "âœ… Ø§ØªÙ…Ø§Ù… Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ") {
    $batch_data = mysqli_fetch_assoc(mysqli_query($MySQLi,
        "SELECT * FROM `batch_uploads` 
         WHERE `user_id` = '{$from_id}' AND `status` = 'uploading' 
         ORDER BY `created_at` DESC LIMIT 1"
    ));
    
    if ($batch_data) {
        completeBatchUpload($batch_data['batch_code']);
        $batch_files = getBatchFiles($batch_data['batch_code']);
        
        $message = "âœ… Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯!\n\n";
        
        if ($batch_data['is_series']) {
            $all_episodes = getSeriesEpisodes($batch_data['series_name'], $batch_data['season_number']);
            $message .= "ğŸ“º Ø³Ø±ÛŒØ§Ù„: {$batch_data['series_name']}\n";
            $message .= "ğŸ¬ ÙØµÙ„: {$batch_data['season_number']}\n";
            $message .= "ğŸ“ ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ Ù‚Ø³Ù…Øªâ€ŒÙ‡Ø§: " . count($all_episodes) . "\n\n";
            $message .= "ğŸ”— Ù„ÛŒÙ†Ú© Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ú©Ù„ Ø³Ø±ÛŒØ§Ù„:\n";
            $message .= "https://t.me/" . $usernamebot . "?start=series_{$batch_data['series_name']}_{$batch_data['season_number']}";
        } else {
            $message .= "ğŸ“¦ Ú©Ø¯ Ø¢Ù¾Ù„ÙˆØ¯: <code>{$batch_data['batch_code']}</code>\n";
            $message .= "ğŸ“ ØªØ¹Ø¯Ø§Ø¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§: " . count($batch_files) . "\n\n";
            $message .= "ğŸ”— Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ù†Ù„ÙˆØ¯:\n";
            
            foreach ($batch_files as $index => $file) {
                $message .= ($index + 1) . ". ğŸ“¥ /dl_{$file['file_code']}\n";
            }
            
            $message .= "\nğŸŒ Ù„ÛŒÙ†Ú© Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ù…Ø¬Ù…ÙˆØ¹Ù‡:\n";
            $message .= "https://t.me/" . $usernamebot . "?start=batch_{$batch_data['batch_code']}";
        }
        
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => $message,
            'reply_to_message_id' => $message_id,
            'parse_mode' => 'HTML',
            'reply_markup' => $menu
        ]);
        
        $MySQLi->query("UPDATE `user` SET `step` = 'none', `code` = '' WHERE `id` = '{$from_id}' LIMIT 1");
    }
}// Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù„ÛŒØ³Øª Ø³Ø±ÛŒØ§Ù„â€ŒÙ‡Ø§
elseif ($text == "ğŸ“‹ Ù„ÛŒØ³Øª Ø³Ø±ÛŒØ§Ù„â€ŒÙ‡Ø§") {
    $series_list = mysqli_query($MySQLi,
        "SELECT `series_name`, `season_number`, COUNT(fm.file_code) as episode_count
         FROM `batch_uploads` b
         LEFT JOIN `file_metadata` fm ON b.batch_code = fm.batch_code
         WHERE b.is_series = 1 AND b.user_id = '{$from_id}' AND b.status = 'completed'
         GROUP BY b.series_name, b.season_number
         ORDER BY b.series_name, b.season_number"
    );
    
    if (mysqli_num_rows($series_list) > 0) {
        $message = "ğŸ“‹ Ù„ÛŒØ³Øª Ø³Ø±ÛŒØ§Ù„â€ŒÙ‡Ø§ÛŒ Ø´Ù…Ø§:\n\n";
        
        while ($series = mysqli_fetch_assoc($series_list)) {
            $message .= "ğŸ“º {$series['series_name']} - ÙØµÙ„ {$series['season_number']}\n";
            $message .= "ğŸ“ ØªØ¹Ø¯Ø§Ø¯ Ù‚Ø³Ù…Øªâ€ŒÙ‡Ø§: {$series['episode_count']}\n";
            $message .= "ğŸ”— /series_{$series['series_name']}_{$series['season_number']}\n";
            $message .= "â–â–â–â–â–â–â–\n";
        }
        
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => $message,
            'reply_to_message_id' => $message_id
        ]);
    } else {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "ğŸ“­ Ø´Ù…Ø§ Ù‡Ù†ÙˆØ² Ù‡ÛŒÚ† Ø³Ø±ÛŒØ§Ù„ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ù†Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯!",
            'reply_to_message_id' => $message_id
        ]);
    }
}

// Ø¯Ø³ØªÙˆØ± Ø³Ø±ÛŒØ¹ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø³Ø±ÛŒØ§Ù„
elseif (strpos($text, "/series_") === 0) {
    $series_info = str_replace("/series_", "", $text);
    list($series_name, $season) = explode("_", $series_info);
    
    $download_links = getSeriesDownloadLinks($series_name, $season);
    
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => $download_links,
        'reply_to_message_id' => $message_id,
        'parse_mode' => 'HTML'
    ]);
}// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…Ù†ÙˆÛŒ Ø³Ø±ÛŒØ§Ù„â€ŒÙ‡Ø§ Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§Ø¯Ù…ÛŒÙ†
if (isAdmin($from_id)) {
    $menu = json_encode(['keyboard' => [
        [['text' => "ğŸ“‚ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø§Ù¾Ù„ÙˆØ¯"], ['text' =>"ğŸ« Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ"]],
        [['text' => "ğŸ“¦ Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡"], ['text' => "ğŸ“º Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø±ÛŒØ§Ù„â€ŒÙ‡Ø§"]],
        [['text' => "ğŸ”¥ Ù¾Ø±Ø·Ø±ÙØ¯Ø§Ø±ØªØ±ÛŒÙ†â€ŒÙ‡Ø§"], ['text' => "ğŸ›  Ù…Ø¯ÛŒØ±ÛŒØª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§"]],
        [['text' => "ğŸ” ØªÙ†Ø¸ÛŒÙ… Ù¾Ø³ÙˆØ±Ø¯"], ['text' => "ğŸ—‘ Ø­Ø°Ù ÙØ§ÛŒÙ„"]],
        [['text' => "ğŸ‘¤ Ù…Ø¯ÛŒØ±ÛŒØª"], ['text' => "ğŸ—‚ Ú©Ø¯ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ ÙØ§ÛŒÙ„"]]
        ], 'resize_keyboard' => true
    ]);
}

// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¯Ø³ØªÙˆØ± Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø±ÛŒØ§Ù„â€ŒÙ‡Ø§
elseif ($text == "ğŸ“º Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø±ÛŒØ§Ù„â€ŒÙ‡Ø§") {
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "ğŸ“º Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø±ÛŒØ§Ù„â€ŒÙ‡Ø§ Ùˆ Ù…Ø¬Ù…ÙˆØ¹Ù‡â€ŒÙ‡Ø§\n\nØ¨Ø§ Ø§ÛŒÙ† Ø³ÛŒØ³ØªÙ… Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø³Ø±ÛŒØ§Ù„â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ù…Ù†Ø¸Ù… Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø±Ø¯Ù‡ Ùˆ Ù‚Ø³Ù…Øªâ€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø±Ø§ Ø¨Ù‡ Ù…Ø¬Ù…ÙˆØ¹Ù‡ Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯.",
        'reply_to_message_id' => $message_id,
        'reply_markup' => $series_management
    ]);
    $MySQLi->query("UPDATE `user` SET `step` = 'series_management' WHERE `id` = '{$from_id}' LIMIT 1");
}// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø¨Ø®Ø´ Ø§ÛŒØ¬Ø§Ø¯ Ø¬Ø¯Ø§ÙˆÙ„
if ($MySQLi->query("SELECT * FROM `video_covers`") == false) {
    mysqli_query($MySQLi, "CREATE TABLE `video_covers` (
        `id` int(11) NOT NULL AUTO_INCREMENT PRIMARY KEY,
        `video_file_code` varchar(50) NOT NULL UNIQUE,
        `cover_file_id` varchar(200) NOT NULL,
        `cover_caption` text CHARACTER SET utf8mb4,
        `user_id` bigint(20) NOT NULL,
        `created_at` timestamp DEFAULT CURRENT_TIMESTAMP,
        INDEX `video_file_code` (`video_file_code`),
        INDEX `user_id` (`user_id`)
    )");
}// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø¨Ø®Ø´ ØªÙˆØ§Ø¨Ø¹
function setVideoCover($video_file_code, $cover_file_id, $user_id, $caption = '') {
    global $MySQLi;
    
    $caption = mysqli_real_escape_string($MySQLi, $caption);
    
    return mysqli_query($MySQLi, 
        "INSERT INTO `video_covers` 
        (`video_file_code`, `cover_file_id`, `user_id`, `cover_caption`) 
        VALUES ('{$video_file_code}', '{$cover_file_id}', '{$user_id}', '{$caption}')
        ON DUPLICATE KEY UPDATE 
        `cover_file_id` = '{$cover_file_id}',
        `cover_caption` = '{$caption}',
        `created_at` = CURRENT_TIMESTAMP"
    );
}

function getVideoCover($video_file_code) {
    global $MySQLi;
    
    $result = mysqli_fetch_assoc(mysqli_query($MySQLi,
        "SELECT * FROM `video_covers` WHERE `video_file_code` = '{$video_file_code}'"
    ));
    
    return $result ?: null;
}

function deleteVideoCover($video_file_code) {
    global $MySQLi;
    
    return mysqli_query($MySQLi,
        "DELETE FROM `video_covers` WHERE `video_file_code` = '{$video_file_code}'"
    );
}

// ØªØ§Ø¨Ø¹ Ø§ÛŒØ¬Ø§Ø¯ Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ ÙˆÛŒØ¯ÛŒÙˆ Ø¨Ø§ Ú©Ø§ÙˆØ±
function sendVideoWithCustomCover($chat_id, $video_file_id, $caption, $cover_file_id = null, $reply_markup = null) {
    $params = [
        'chat_id' => $chat_id,
        'video' => $video_file_id,
        'caption' => $caption,
        'parse_mode' => 'HTML'
    ];
    
    // Ø§Ú¯Ø± Ú©Ø§ÙˆØ± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯ØŒ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†
    if ($cover_file_id) {
        $params['thumb'] = $cover_file_id;
    }
    
    if ($reply_markup) {
        $params['reply_markup'] = $reply_markup;
    }
    
    return WSBot('sendvideo', $params);
}// Ù…Ù†ÙˆÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§ÙˆØ± ÙˆÛŒØ¯ÛŒÙˆÙ‡Ø§
$cover_management = json_encode(['keyboard' => [
    [['text' => "ğŸ–¼ Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§ÙˆØ± Ø¨Ù‡ ÙˆÛŒØ¯ÛŒÙˆ"]],
    [['text' => "ğŸ“ ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§ÙˆØ± Ù…ÙˆØ¬ÙˆØ¯"]],
    [['text' => "ğŸ—‘ Ø­Ø°Ù Ú©Ø§ÙˆØ±"]],
    [['text' => "ğŸ‘€ Ù…Ø´Ø§Ù‡Ø¯Ù‡ ÙˆÛŒØ¯ÛŒÙˆÙ‡Ø§ÛŒ Ø¯Ø§Ø±Ø§ÛŒ Ú©Ø§ÙˆØ±"]],
    [['text' => "ğŸ”™ Ø¨Ø±Ú¯Ø´Øª"]]
    ], 'resize_keyboard' => true
]);// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ù…Ø¯ÛŒØ±ÛŒØª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
elseif ($text == "ğŸ–¼ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§ÙˆØ± ÙˆÛŒØ¯ÛŒÙˆÙ‡Ø§") {
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "ğŸ–¼ Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§ÙˆØ± ÙˆÛŒØ¯ÛŒÙˆÙ‡Ø§\n\nØ¨Ø§ Ø§ÛŒÙ† Ø³ÛŒØ³ØªÙ… Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ø±Ø§ÛŒ ÙˆÛŒØ¯ÛŒÙˆÙ‡Ø§ÛŒ Ø®ÙˆØ¯ Ú©Ø§ÙˆØ± Ø¯Ù„Ø®ÙˆØ§Ù‡ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯ ØªØ§ Ø¬Ø°Ø§Ø¨ÛŒØª Ø¨ØµØ±ÛŒ Ø¨ÛŒØ´ØªØ±ÛŒ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ù†Ø¯.",
        'reply_to_message_id' => $message_id,
        'reply_markup' => $cover_management
    ]);
    $MySQLi->query("UPDATE `user` SET `step` = 'cover_management' WHERE `id` = '{$from_id}' LIMIT 1");
}

// Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§ÙˆØ± Ø¨Ù‡ ÙˆÛŒØ¯ÛŒÙˆ
elseif ($text == "ğŸ–¼ Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§ÙˆØ± Ø¨Ù‡ ÙˆÛŒØ¯ÛŒÙˆ") {
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "ğŸ–¼ Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§ÙˆØ± Ø¨Ù‡ ÙˆÛŒØ¯ÛŒÙˆ\n\nÙ„Ø·ÙØ§Ù‹ Ù…Ø±Ø§Ø­Ù„ Ø²ÛŒØ± Ø±Ø§ Ø¯Ù†Ø¨Ø§Ù„ Ú©Ù†ÛŒØ¯:\n\n1. Ø§Ø¨ØªØ¯Ø§ Ø´Ù†Ø§Ø³Ù‡ ÙˆÛŒØ¯ÛŒÙˆ Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯\n2. Ø³Ù¾Ø³ ØªØµÙˆÛŒØ± Ú©Ø§ÙˆØ± Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯\n3. Ø¯Ø± Ù†Ù‡Ø§ÛŒØª Ú©Ù¾Ø´Ù† Ú©Ø§ÙˆØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ù†Ù…Ø§ÛŒÛŒØ¯\n\nğŸ”¸ Ø´Ù†Ø§Ø³Ù‡ ÙˆÛŒØ¯ÛŒÙˆ Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ú©Ø¯ÛŒ Ø§Ø³Øª Ù…Ø§Ù†Ù†Ø¯: ABC123DEF",
        'reply_to_message_id' => $message_id,
        'reply_markup' => $back
    ]);
    $MySQLi->query("UPDATE `user` SET `step` = 'add_cover_video_code' WHERE `id` = '{$from_id}' LIMIT 1");
}

// Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù…Ø±Ø§Ø­Ù„ Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§ÙˆØ±
elseif ($user['step'] == 'add_cover_video_code') {
    $video_code = $text;
    $video_data = mysqli_fetch_assoc(mysqli_query($MySQLi,
        "SELECT * FROM `dbfile` WHERE `code` = '{$video_code}' AND `user_id` = '{$from_id}' AND `file` = 'video'"
    ));
    
    if ($video_data) {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "âœ… ÙˆÛŒØ¯ÛŒÙˆ Ù¾ÛŒØ¯Ø§ Ø´Ø¯!\n\nğŸ¬ Ø´Ù†Ø§Ø³Ù‡: {$video_code}\nğŸ“ Ø¹Ù†ÙˆØ§Ù†: " . ($video_data['file'] ?? 'ÙˆÛŒØ¯ÛŒÙˆ') . "\n\nÙ„Ø·ÙØ§Ù‹ ØªØµÙˆÛŒØ± Ú©Ø§ÙˆØ± Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯:",
            'reply_to_message_id' => $message_id,
            'reply_markup' => $back
        ]);
        
        $MySQLi->query("UPDATE `user` SET `step` = 'add_cover_image', `code` = '{$video_code}' WHERE `id` = '{$from_id}' LIMIT 1");
    } else {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "âŒ ÙˆÛŒØ¯ÛŒÙˆÛŒÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ø´Ù†Ø§Ø³Ù‡ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯! Ù„Ø·ÙØ§Ù‹ Ø´Ù†Ø§Ø³Ù‡ ØµØ­ÛŒØ­ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:",
            'reply_to_message_id' => $message_id
        ]);
    }
}

elseif ($user['step'] == 'add_cover_image' && isset($message->photo)) {
    $video_code = $user['code'];
    $photo = $message->photo;
    $cover_file_id = $photo[count($photo)-1]->file_id;
    
    // Ø°Ø®ÛŒØ±Ù‡ Ù…ÙˆÙ‚Øª ØªØµÙˆÛŒØ± Ú©Ø§ÙˆØ±
    $MySQLi->query("UPDATE `user` SET `step` = 'add_cover_caption', `upload` = '{$cover_file_id}' WHERE `id` = '{$from_id}' LIMIT 1");
    
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "âœ… ØªØµÙˆÛŒØ± Ú©Ø§ÙˆØ± Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯!\n\nÙ„Ø·ÙØ§Ù‹ Ú©Ù¾Ø´Ù† Ú©Ø§ÙˆØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ):\n\nğŸ’¡ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ ØªÙˆØ¶ÛŒØ­Ø§ØªÛŒ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ú©Ø§ÙˆØ± Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯ ÛŒØ§ Ø§Ø² Enter Ø¨Ú¯Ø°Ø±ÛŒØ¯.",
        'reply_to_message_id' => $message_id,
        'reply_markup' => json_encode(['keyboard' => [
            [['text' => "Ø±Ø¯ Ú©Ø±Ø¯Ù† Ú©Ù¾Ø´Ù†"]],
            [['text' => "ğŸ”™ Ø¨Ø±Ú¯Ø´Øª"]]
            ], 'resize_keyboard' => true])
    ]);
}

elseif ($user['step'] == 'add_cover_caption') {
    $video_code = $user['code'];
    $cover_file_id = $user['upload'];
    $cover_caption = ($text == "Ø±Ø¯ Ú©Ø±Ø¯Ù† Ú©Ù¾Ø´Ù†") ? '' : $text;
    
    if (setVideoCover($video_code, $cover_file_id, $from_id, $cover_caption)) {
        // Ù†Ù…Ø§ÛŒØ´ Ù†Ù…ÙˆÙ†Ù‡
        $video_data = mysqli_fetch_assoc(mysqli_query($MySQLi,
            "SELECT * FROM `dbfile` WHERE `code` = '{$video_code}'"
        ));
        
        $cover_data = getVideoCover($video_code);
        
        // Ø§Ø±Ø³Ø§Ù„ Ú©Ø§ÙˆØ± Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´
        WSBot('sendphoto', [
            'chat_id' => $chat_id,
            'photo' => $cover_file_id,
            'caption' => "âœ… Ú©Ø§ÙˆØ± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯!\n\nğŸ¬ ÙˆÛŒØ¯ÛŒÙˆ: {$video_code}\nğŸ–¼ Ú©Ø§ÙˆØ±: ÙØ¹Ø§Ù„\nğŸ“ ØªÙˆØ¶ÛŒØ­Ø§Øª: " . ($cover_caption ?: 'Ù†Ø¯Ø§Ø±Ø¯'),
            'reply_to_message_id' => $message_id
        ]);
        
        // Ø§Ø±Ø³Ø§Ù„ ÙˆÛŒØ¯ÛŒÙˆ Ø¨Ø§ Ú©Ø§ÙˆØ± Ø¬Ø¯ÛŒØ¯
        $interaction_keyboard = getInteractionKeyboard($video_code, $from_id);
        $video_caption = getAdvancedCaption($video_data);
        
        sendVideoWithCustomCover($chat_id, $video_data['file_id'], $video_caption, $cover_file_id, $interaction_keyboard);
        
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "ğŸ‰ ÙˆÛŒØ¯ÛŒÙˆ Ø¨Ø§ Ú©Ø§ÙˆØ± Ø¬Ø¯ÛŒØ¯ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª!\n\nØ§Ú©Ù†ÙˆÙ† Ú©Ø§Ø±Ø¨Ø±Ø§Ù† ÙˆÛŒØ¯ÛŒÙˆ Ø±Ø§ Ø¨Ø§ Ø§ÛŒÙ† Ú©Ø§ÙˆØ± Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø®ÙˆØ§Ù‡Ù†Ø¯ Ú©Ø±Ø¯.",
            'reply_to_message_id' => $message_id,
            'reply_markup' => $cover_management
        ]);
    } else {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "âŒ Ø®Ø·Ø§ Ø¯Ø± ØªÙ†Ø¸ÛŒÙ… Ú©Ø§ÙˆØ±!",
            'reply_to_message_id' => $message_id
        ]);
    }
    
    $MySQLi->query("UPDATE `user` SET `step` = 'cover_management', `code` = '', `upload` = '0' WHERE `id` = '{$from_id}' LIMIT 1");
}// ØªØºÛŒÛŒØ± Ø¯Ø± ØªØ§Ø¨Ø¹ handleFileUpload Ø¨Ø±Ø§ÛŒ ÙˆÛŒØ¯ÛŒÙˆÙ‡Ø§
function handleFileUpload($file_type, $file_id, $file_size, $caption, $from_id, $chat_id, $message_id) {
    global $MySQLi, $usernamebot;
    
    // Ø¨Ø±Ø±Ø³ÛŒ ØªÚ©Ø±Ø§Ø±ÛŒ Ù†Ø¨ÙˆØ¯Ù† ÙØ§ÛŒÙ„
    $file = mysqli_fetch_assoc(mysqli_query($MySQLi, "SELECT * FROM `dbfile` WHERE `file_id` = '{$file_id}' LIMIT 1"));
    
    if(!$file) {
        // Ø°Ø®ÛŒØ±Ù‡ Ú©Ù¾Ø´Ù†
        saveCustomCaption($file_id, $caption);
        
        $code = RandomString();
        $size = convert($file_size);
        $time = date('h:i:s');
        $date = date('Y/m/d');
        
        // Ø°Ø®ÛŒØ±Ù‡ Ù…ØªØ§Ø¯ÛŒØªØ§
        saveFileMetadata($code, $file_id, $from_id, $caption);
        
        // Ø¨Ø±Ø±Ø³ÛŒ Ø§Ú¯Ø± Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ Ù‡Ø³ØªÛŒÙ…
        $user_data = mysqli_fetch_assoc(mysqli_query($MySQLi, 
            "SELECT * FROM `user` WHERE `id` = '{$from_id}'"
        ));
        
        $is_batch = false;
        $batch_title = "";
        if ($user_data && strpos($user_data['step'], 'batch_uploading') !== false) {
            addFileToBatch($user_data['code'], $code, $file_type);
            $is_batch = true;
            
            $batch_info = mysqli_fetch_assoc(mysqli_query($MySQLi,
                "SELECT * FROM `batch_uploads` WHERE `batch_code` = '{$user_data['code']}'"
            ));
            $batch_title = $batch_info['title'] ?? '';
        }
        
        // Ø«Ø¨Øª ØªØ¹Ø§Ù…Ù„
        recordInteraction($code, $from_id, 'view');
        $interaction_keyboard = getInteractionKeyboard($code, $from_id);
        
        // Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù¾Ø´Ù† Ù†Ù‡Ø§ÛŒÛŒ
        $final_caption = $caption;
        if ($is_batch && $batch_title) {
            $final_caption = "ğŸ“¦ {$batch_title}\n\n" . $final_caption;
        }
        
        $final_caption .= "\n\nğŸ“¥ ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø§Ù†Ù„ÙˆØ¯: 1\nğŸ”— @" . $usernamebot;
        
        // Ø§Ø±Ø³Ø§Ù„ ÙØ§ÛŒÙ„ Ø¨Ø§ ØªÙˆØ¬Ù‡ Ø¨Ù‡ Ù†ÙˆØ¹
        if ($file_type == 'video') {
            // Ø¨Ø±Ø±Ø³ÛŒ Ø¢ÛŒØ§ Ú©Ø§ÙˆØ± Ø¯Ø§Ø±Ø¯ØŸ
            $cover_data = null;
            // Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ù‚Ø¨Ù„Ø§Ù‹ Ú©Ø§ÙˆØ± ØªÙ†Ø¸ÛŒÙ… Ú©Ø±Ø¯Ù‡ Ø¨Ø§Ø´Ø¯ØŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø§Ø² Ø§ÛŒÙ†Ø¬Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†Ø¯
            
            $success_message = sendVideoWithCustomCover($chat_id, $file_id, $final_caption, null, $interaction_keyboard);
        } else {
            // Ø¨Ø±Ø§ÛŒ Ø³Ø§ÛŒØ± Ø§Ù†ÙˆØ§Ø¹ ÙØ§ÛŒÙ„
            $method = 'send' . $file_type;
            $success_message = WSBot($method, [
                'chat_id' => $chat_id,
                $file_type => $file_id,
                'caption' => $final_caption,
                'reply_to_message_id' => $message_id,
                'parse_mode' => "HTML",
                'reply_markup' => $interaction_keyboard
            ]);
        }
        
        // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø§ØµÙ„ÛŒ
        $MySQLi->query("INSERT INTO `dbfile` (`code`, `file_id`, `file`, `password`, `file_size`, `user_id`, `date`, `time`, `dl`) VALUES ('{$code}', '{$file_id}', '{$file_type}', '', '{$file_size}', '{$from_id}', '{$date}', '{$time}', '1')");
        
        // Ø¢Ù¾Ø¯ÛŒØª Ø¢Ù…Ø§Ø± Ú©Ø§Ø±Ø¨Ø±
        if (!$user_data) {
            $MySQLi->query("INSERT INTO `user` (`id`, `step`, `upload`, `code`) VALUES ('{$from_id}', 'none', '0', '')");
        } else {
            $MySQLi->query("UPDATE `user` SET `upload` = `upload` + 1 WHERE `id` = '{$from_id}' LIMIT 1");
        }
        
        return $code;
    } else {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "â–ªï¸ Ø®Ø·Ø§ , Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ù‚Ø¨Ù„Ø§ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø§Ù¾Ù„ÙˆØ¯ Ø´Ø¯Ù‡ Ø§Ø³Øª ... !",
            'reply_to_message_id' => $message_id
        ]);
        return false;
    }
}// Ø¨Ù‡Ø¨ÙˆØ¯ Ø¨Ø®Ø´ Ù†Ù…Ø§ÛŒØ´ ÙˆÛŒØ¯ÛŒÙˆ Ù‡Ù†Ú¯Ø§Ù… Ø¯Ø§Ù†Ù„ÙˆØ¯
elseif(strpos($text, "/start _") !== false) {
    $idFile = str_replace("/start _", null, $text);
    $dataFile = mysqli_fetch_assoc(mysqli_query($MySQLi, "SELECT * FROM `dbfile` WHERE `code` = '{$idFile}' LIMIT 1"));
    
    // ... Ú©Ø¯Ù‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯
    
    if ($dataFile['file'] == 'video') {
        // Ø¨Ø±Ø±Ø³ÛŒ Ø¢ÛŒØ§ Ú©Ø§ÙˆØ± Ø¯Ø§Ø±Ø¯ØŸ
        $cover_data = getVideoCover($idFile);
        $cover_file_id = $cover_data ? $cover_data['cover_file_id'] : null;
        
        $dl = number_format($dataFile['dl']);
        $cap = file_get_contents("files/{$dataFile['file_id']}");
        $final_caption = $cap . PHP_EOL . "ğŸ“¥ ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù‡Ø§ : <code>{$dl}</code>\nğŸ¤– @$usernamebot";
        
        // Ø§Ø±Ø³Ø§Ù„ ÙˆÛŒØ¯ÛŒÙˆ Ø¨Ø§ Ú©Ø§ÙˆØ± Ø¯Ù„Ø®ÙˆØ§Ù‡
        sendVideoWithCustomCover($chat_id, $dataFile['file_id'], $final_caption, $cover_file_id, $menu);
    } else {
        // Ø¨Ø±Ø§ÛŒ Ø³Ø§ÛŒØ± Ø§Ù†ÙˆØ§Ø¹ ÙØ§ÛŒÙ„
        $method = $dataFile['file'];
        $cap = file_get_contents("files/{$dataFile['file_id']}");
        WSBot('send'.$dataFile['file'], [
            'chat_id' => $chat_id,
            "$method" => $dataFile['file_id'],
            'caption' => $cap . PHP_EOL . "ğŸ“¥ ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù‡Ø§ : <code>{$dl}</code>\nğŸ¤– @$usernamebot",
            'reply_to_message_id' => $message_id,
            'parse_mode' => "html",
            'reply_markup' => $menu
        ]);
    }
    
    // ... Ø¨Ù‚ÛŒÙ‡ Ú©Ø¯
}// Ø¯Ø³ØªÙˆØ± Ø±ÛŒÙ¾Ù„Ø§ÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§ÙˆØ± Ø³Ø±ÛŒØ¹
elseif (strpos($text, '/setcover') === 0 && isset($message->reply_to_message)) {
    $reply_message = $message->reply_to_message;
    
    // Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ù¾ÛŒØ§Ù… Ø±ÛŒÙ¾Ù„Ø§ÛŒ Ø´Ø¯Ù‡ Ø­Ø§ÙˆÛŒ ÙˆÛŒØ¯ÛŒÙˆ Ø§Ø³Øª
    if (isset($reply_message->video)) {
        $video_file_id = $reply_message->video->file_id;
        
        // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ú©Ø¯ ÙˆÛŒØ¯ÛŒÙˆ
        $video_data = mysqli_fetch_assoc(mysqli_query($MySQLi,
            "SELECT * FROM `dbfile` WHERE `file_id` = '{$video_file_id}' AND `user_id` = '{$from_id}'"
        ));
        
        if ($video_data) {
            // Ø¨Ø±Ø±Ø³ÛŒ Ø¢ÛŒØ§ Ù¾ÛŒØ§Ù… ÙØ¹Ù„ÛŒ Ø­Ø§ÙˆÛŒ Ø¹Ú©Ø³ Ø§Ø³Øª
            if (isset($message->photo)) {
                $photo = $message->photo;
                $cover_file_id = $photo[count($photo)-1]->file_id;
                
                $cover_caption = str_replace('/setcover', '', $text);
                $cover_caption = trim($cover_caption);
                
                if (setVideoCover($video_data['code'], $cover_file_id, $from_id, $cover_caption)) {
                    WSBot('sendmessage', [
                        'chat_id' => $chat_id,
                        'text' => "âœ… Ú©Ø§ÙˆØ± Ø¨Ø±Ø§ÛŒ ÙˆÛŒØ¯ÛŒÙˆ ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯!",
                        'reply_to_message_id' => $message_id
                    ]);
                    
                    // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´
                    WSBot('sendphoto', [
                        'chat_id' => $chat_id,
                        'photo' => $cover_file_id,
                        'caption' => "ğŸ–¼ Ú©Ø§ÙˆØ± Ø¬Ø¯ÛŒØ¯ ÙˆÛŒØ¯ÛŒÙˆ\n\n" . ($cover_caption ?: 'Ú©Ø§ÙˆØ± Ø¯Ù„Ø®ÙˆØ§Ù‡'),
                        'reply_to_message_id' => $message_id
                    ]);
                }
            } else {
                WSBot('sendmessage', [
                    'chat_id' => $chat_id,
                    'text' => "âŒ Ù„Ø·ÙØ§Ù‹ ÛŒÚ© ØªØµÙˆÛŒØ± Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ú©Ø§ÙˆØ± Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯!",
                    'reply_to_message_id' => $message_id
                ]);
            }
        } else {
            WSBot('sendmessage', [
                'chat_id' => $chat_id,
                'text' => "âŒ ÙˆÛŒØ¯ÛŒÙˆ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯ ÛŒØ§ Ø´Ù…Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯!",
                'reply_to_message_id' => $message_id
            ]);
        }
    } else {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "âŒ Ù„Ø·ÙØ§Ù‹ Ø¨Ù‡ ÛŒÚ© ÙˆÛŒØ¯ÛŒÙˆ Ø±ÛŒÙ¾Ù„Ø§ÛŒ Ú©Ù†ÛŒØ¯!",
            'reply_to_message_id' => $message_id
        ]);
    }
}// Ù…Ø´Ø§Ù‡Ø¯Ù‡ ÙˆÛŒØ¯ÛŒÙˆÙ‡Ø§ÛŒ Ø¯Ø§Ø±Ø§ÛŒ Ú©Ø§ÙˆØ±
elseif ($text == "ğŸ‘€ Ù…Ø´Ø§Ù‡Ø¯Ù‡ ÙˆÛŒØ¯ÛŒÙˆÙ‡Ø§ÛŒ Ø¯Ø§Ø±Ø§ÛŒ Ú©Ø§ÙˆØ±") {
    $videos_with_covers = mysqli_query($MySQLi,
        "SELECT vc.*, d.code as video_code, d.file_size, d.dl, fm.caption as video_caption
         FROM `video_covers` vc
         LEFT JOIN `dbfile` d ON vc.video_file_code = d.code
         LEFT JOIN `file_metadata` fm ON vc.video_file_code = fm.file_code
         WHERE vc.user_id = '{$from_id}'
         ORDER BY vc.created_at DESC"
    );
    
    if (mysqli_num_rows($videos_with_covers) > 0) {
        $message = "ğŸ–¼ ÙˆÛŒØ¯ÛŒÙˆÙ‡Ø§ÛŒ Ø¯Ø§Ø±Ø§ÛŒ Ú©Ø§ÙˆØ±:\n\n";
        
        while ($video = mysqli_fetch_assoc($videos_with_covers)) {
            $message .= "ğŸ¬ Ú©Ø¯ ÙˆÛŒØ¯ÛŒÙˆ: {$video['video_code']}\n";
            $message .= "ğŸ“Š Ø¯Ø§Ù†Ù„ÙˆØ¯: " . formatNumber($video['dl']) . "\n";
            $message .= "ğŸ•’ ØªØ§Ø±ÛŒØ®: " . $video['created_at'] . "\n";
            $message .= "ğŸ“ " . ($video['cover_caption'] ?: 'Ø¨Ø¯ÙˆÙ† ØªÙˆØ¶ÛŒØ­') . "\n";
            $message .= "ğŸ”— /dl_{$video['video_code']}\n";
            $message .= "â–â–â–â–â–â–â–\n";
        }
        
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => $message,
            'reply_to_message_id' => $message_id
        ]);
    } else {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "ğŸ“­ Ù‡ÛŒÚ† ÙˆÛŒØ¯ÛŒÙˆÛŒÛŒ Ø¨Ø§ Ú©Ø§ÙˆØ± Ø¯Ù„Ø®ÙˆØ§Ù‡ Ù†Ø¯Ø§Ø±ÛŒØ¯!",
            'reply_to_message_id' => $message_id
        ]);
    }
}// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§ÙˆØ± Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§Ø¯Ù…ÛŒÙ†
if (isAdmin($from_id)) {
    $menu = json_encode(['keyboard' => [
        [['text' => "ğŸ“‚ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø§Ù¾Ù„ÙˆØ¯"], ['text' =>"ğŸ« Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ"]],
        [['text' => "ğŸ“¦ Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡"], ['text' => "ğŸ“º Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø±ÛŒØ§Ù„â€ŒÙ‡Ø§"]],
        [['text' => "ğŸ–¼ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§ÙˆØ± ÙˆÛŒØ¯ÛŒÙˆÙ‡Ø§"], ['text' => "ğŸ›  Ù…Ø¯ÛŒØ±ÛŒØª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§"]],
        [['text' => "ğŸ”¥ Ù¾Ø±Ø·Ø±ÙØ¯Ø§Ø±ØªØ±ÛŒÙ†â€ŒÙ‡Ø§"], ['text' => "ğŸ” ØªÙ†Ø¸ÛŒÙ… Ù¾Ø³ÙˆØ±Ø¯"]],
        [['text' => "ğŸ—‘ Ø­Ø°Ù ÙØ§ÛŒÙ„"], ['text' => "ğŸ—‚ Ú©Ø¯ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ ÙØ§ÛŒÙ„"]],
        [['text' => "ğŸ‘¤ Ù…Ø¯ÛŒØ±ÛŒØª"]]
        ], 'resize_keyboard' => true
    ]);
}// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø¨Ø®Ø´ Ø§ÛŒØ¬Ø§Ø¯ Ø¬Ø¯Ø§ÙˆÙ„
if ($MySQLi->query("SELECT * FROM `bot_texts`") == false) {
    mysqli_query($MySQLi, "CREATE TABLE `bot_texts` (
        `id` int(11) NOT NULL AUTO_INCREMENT PRIMARY KEY,
        `text_key` varchar(100) NOT NULL UNIQUE,
        `text_value` text CHARACTER SET utf8mb4,
        `description` varchar(255) DEFAULT NULL,
        `category` varchar(50) DEFAULT 'general',
        `updated_at` timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
        `updated_by` bigint(20) DEFAULT NULL
    )");

    // Ù…ØªÙˆÙ† Ù¾ÛŒØ´â€ŒÙØ±Ø¶
    $default_texts = [
        // Ù…ØªÙˆÙ† Ø¹Ù…ÙˆÙ…ÛŒ
        ['welcome_message', 'ğŸ‘¤ Ø³Ù„Ø§Ù… {first_name}\nğŸ¤– Ø¨Ù‡ Ø±Ø¨Ø§Øª Ù…Ø§ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!', 'Ù¾ÛŒØ§Ù… Ø®ÙˆØ´Ø§Ù…Ø¯Ú¯ÙˆÛŒÛŒ Ø¯Ø± Ø§Ø³ØªØ§Ø±Øª', 'general'],
        ['help_message', 'ğŸ“š Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø±Ø¨Ø§Øª\n\nØ¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Ø§Ø² Ù…Ù†ÙˆÛŒ Ø²ÛŒØ± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.', 'Ù¾ÛŒØ§Ù… Ø±Ø§Ù‡Ù†Ù…Ø§', 'general'],
        ['upload_success', 'âœ… ÙØ§ÛŒÙ„ Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¢Ù¾Ù„ÙˆØ¯ Ø´Ø¯!\nÚ©Ø¯ ÙØ§ÛŒÙ„: {file_code}', 'Ù¾ÛŒØ§Ù… Ù…ÙˆÙÙ‚ÛŒØª Ø¢Ù¾Ù„ÙˆØ¯', 'upload'],
        ['file_not_found', 'âŒ ÙØ§ÛŒÙ„ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯.', 'Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ÛŒ Ø¹Ø¯Ù… ÛŒØ§ÙØªÙ† ÙØ§ÛŒÙ„', 'errors'],
        ['admin_only', 'âŒ Ø§ÛŒÙ† Ø¯Ø³ØªÙˆØ± ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§ Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø³Øª.', 'Ù¾ÛŒØ§Ù… Ø¯Ø³ØªØ±Ø³ÛŒ Ù…Ù…Ù†ÙˆØ¹', 'errors'],
        ['need_join_channel', 'âš ï¸ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø±Ø¨Ø§Øª Ø¨Ø§ÛŒØ¯ Ø¯Ø± Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ù…Ø§ Ø¹Ø¶Ùˆ Ø´ÙˆÛŒØ¯.', 'Ù¾ÛŒØ§Ù… Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¹Ø¶ÙˆÛŒØª Ø¯Ø± Ú©Ø§Ù†Ø§Ù„', 'general'],
        
        // Ù…ØªÙˆÙ† Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ
        ['batch_start', 'ğŸ“¦ Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ Ø´Ø±ÙˆØ¹ Ø´Ø¯!\nÚ©Ø¯: {batch_code}', 'Ù¾ÛŒØ§Ù… Ø´Ø±ÙˆØ¹ Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ', 'batch'],
        ['batch_complete', 'âœ… Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯!\nØªØ¹Ø¯Ø§Ø¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§: {file_count}', 'Ù¾ÛŒØ§Ù… Ø§ØªÙ…Ø§Ù… Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ', 'batch'],
        
        // Ù…ØªÙˆÙ† Ù…Ø¯ÛŒØ±ÛŒØª
        ['settings_updated', 'âœ… ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯.', 'Ù¾ÛŒØ§Ù… Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª', 'admin'],
        ['text_updated', 'âœ… Ù…ØªÙ† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯.', 'Ù¾ÛŒØ§Ù… ÙˆÛŒØ±Ø§ÛŒØ´ Ù…ØªÙ†', 'admin']
    ];

    foreach ($default_texts as $text) {
        $key = $text[0];
        $value = mysqli_real_escape_string($MySQLi, $text[1]);
        $desc = mysqli_real_escape_string($MySQLi, $text[2]);
        $category = $text[3];
        mysqli_query($MySQLi, 
            "INSERT INTO `bot_texts` (`text_key`, `text_value`, `description`, `category`) 
             VALUES ('$key', '$value', '$desc', '$category')"
        );
    }
}// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø¨Ø®Ø´ ØªÙˆØ§Ø¨Ø¹
function getBotText($key, $replacements = []) {
    global $MySQLi;
    
    $result = mysqli_fetch_assoc(mysqli_query($MySQLi,
        "SELECT `text_value` FROM `bot_texts` WHERE `text_key` = '{$key}'"
    ));
    
    $text = $result ? $result['text_value'] : "Ù…ØªÙ† '{$key}' ÛŒØ§ÙØª Ù†Ø´Ø¯.";
    
    // Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†ÛŒ Ù…Ù‚Ø§Ø¯ÛŒØ± Ø¯Ø§ÛŒÙ†Ø§Ù…ÛŒÚ©
    foreach ($replacements as $placeholder => $value) {
        $text = str_replace('{' . $placeholder . '}', $value, $text);
    }
    
    // ØªØ¨Ø¯ÛŒÙ„ \n Ø¨Ù‡ Ø®Ø· Ø¬Ø¯ÛŒØ¯
    $text = str_replace('\n', "\n", $text);
    
    return $text;
}

function updateBotText($key, $value, $user_id = null) {
    global $MySQLi;
    
    $value = mysqli_real_escape_string($MySQLi, $value);
    $user_sql = $user_id ? ", `updated_by` = '{$user_id}'" : "";
    
    return mysqli_query($MySQLi,
        "UPDATE `bot_texts` 
         SET `text_value` = '{$value}', `updated_at` = CURRENT_TIMESTAMP {$user_sql}
         WHERE `text_key` = '{$key}'"
    );
}

function getAllBotTexts($category = null) {
    global $MySQLi;
    
    $where = $category ? "WHERE `category` = '{$category}'" : "";
    $texts = mysqli_query($MySQLi, 
        "SELECT * FROM `bot_texts` {$where} ORDER BY `category`, `text_key`"
    );
    
    $result = [];
    while ($row = mysqli_fetch_assoc($texts)) {
        $result[] = $row;
    }
    
    return $result;
}

function getTextCategories() {
    global $MySQLi;
    
    $categories = mysqli_query($MySQLi, 
        "SELECT DISTINCT `category` FROM `bot_texts` ORDER BY `category`"
    );
    
    $result = [];
    while ($row = mysqli_fetch_assoc($categories)) {
        $result[] = $row['category'];
    }
    
    return $result;
}// Ù…Ù†ÙˆÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ØªÙˆÙ† Ø±Ø¨Ø§Øª
$text_management = json_encode(['keyboard' => [
    [['text' => "ğŸ“‹ Ù…Ø´Ø§Ù‡Ø¯Ù‡ ØªÙ…Ø§Ù… Ù…ØªÙˆÙ†"], ['text' => "ğŸ” Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ù…ØªÙˆÙ†"]],
    [['text' => "ğŸ“‚ Ù…ØªÙˆÙ† Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¯Ø³ØªÙ‡"], ['text' => "âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´ Ù…ØªÙ†"]],
    [['text' => "ğŸ†• Ø§ÙØ²ÙˆØ¯Ù† Ù…ØªÙ† Ø¬Ø¯ÛŒØ¯"], ['text' => "ğŸ—‘ Ø­Ø°Ù Ù…ØªÙ†"]],
    [['text' => "ğŸ“¤ Export Ù…ØªÙˆÙ†"], ['text' => "ğŸ“¥ Import Ù…ØªÙˆÙ†"]],
    [['text' => "ğŸ”„ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶"], ['text' => "ğŸ”™ Ø¨Ø±Ú¯Ø´Øª"]]
    ], 'resize_keyboard' => true
]);if (preg_match('/^\/(start)$/i', $text) or $text == "ğŸ”™") {
    $admin_status = "";
    if (isAdmin($from_id)) {
        $admin_status = "\n\n" . getBotText('admin_welcome');
    }
    
    $welcome_text = getBotText('welcome_message', ['first_name' => $first_name]) . $admin_status;
    
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => $welcome_text . "\n\nğŸ¤– @$usernamebot\nğŸ“¢ @{$Config['channel']}",
        'reply_to_message_id' => $message_id,
        'parse_mode' => "html",
        'reply_markup' => $menu_to_use
    ]);
    
    // ... Ø¨Ù‚ÛŒÙ‡ Ú©Ø¯
}// Ø¨Ø¹Ø¯ Ø§Ø² Ø¢Ù¾Ù„ÙˆØ¯ Ù…ÙˆÙÙ‚
$success_message = getBotText('upload_success', [
    'file_code' => $code,
    'file_size' => convert($file_size),
    'file_type' => doc($file_type)
]);

WSBot('sendmessage', [
    'chat_id' => $chat_id,
    'text' => $success_message,
    'reply_to_message_id' => $message_id
]);// Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†ÛŒ ØªÙ…Ø§Ù… Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø®Ø·Ø§
else {
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => getBotText('file_not_found'),
        'reply_to_message_id' => $message_id
    ]);
}// Ø´Ø±ÙˆØ¹ Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ
$batch_message = getBotText('batch_start', ['batch_code' => $batch_code]);

// Ø§ØªÙ…Ø§Ù… Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ
$complete_message = getBotText('batch_complete', [
    'file_count' => count($batch_files),
    'batch_code' => $batch_data['batch_code']
]);// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§Ø¯Ù…ÛŒÙ†
elseif ($text == "ğŸ“ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ØªÙˆÙ† Ø±Ø¨Ø§Øª") {
    $texts_count = mysqli_fetch_assoc(mysqli_query($MySQLi, 
        "SELECT COUNT(*) as total FROM `bot_texts`"
    ));
    
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "ğŸ“ Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª Ù…ØªÙˆÙ† Ø±Ø¨Ø§Øª\n\nğŸ“Š ØªØ¹Ø¯Ø§Ø¯ Ù…ØªÙˆÙ†: {$texts_count['total']}\nğŸ· Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§: " . implode(', ', getTextCategories()) . "\n\nØ§Ø² Ù…Ù†ÙˆÛŒ Ø²ÛŒØ± Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ØªÙˆÙ† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯:",
        'reply_to_message_id' => $message_id,
        'reply_markup' => $text_management
    ]);
    $MySQLi->query("UPDATE `user` SET `step` = 'text_management' WHERE `id` = '{$from_id}' LIMIT 1");
}

// Ù…Ø´Ø§Ù‡Ø¯Ù‡ ØªÙ…Ø§Ù… Ù…ØªÙˆÙ†
elseif ($text == "ğŸ“‹ Ù…Ø´Ø§Ù‡Ø¯Ù‡ ØªÙ…Ø§Ù… Ù…ØªÙˆÙ†") {
    $all_texts = getAllBotTexts();
    
    if (count($all_texts) > 0) {
        $message = "ğŸ“‹ Ù„ÛŒØ³Øª ØªÙ…Ø§Ù… Ù…ØªÙˆÙ† Ø±Ø¨Ø§Øª:\n\n";
        
        foreach ($all_texts as $index => $text_item) {
            $short_value = strlen($text_item['text_value']) > 50 ? 
                substr($text_item['text_value'], 0, 50) . '...' : $text_item['text_value'];
            
            $message .= "ğŸ”‘ **{$text_item['text_key']}**\n";
            $message .= "ğŸ“ {$short_value}\n";
            $message .= "ğŸ· {$text_item['category']}\n";
            $message .= "â„¹ï¸ {$text_item['description']}\n";
            $message .= "â° {$text_item['updated_at']}\n";
            $message .= "â–â–â–â–â–â–â–\n";
        }
        
        // Ø§Ø±Ø³Ø§Ù„ Ø¯Ø± Ú†Ù†Ø¯ Ù¾ÛŒØ§Ù… Ø§Ú¯Ø± Ø·ÙˆÙ„Ø§Ù†ÛŒ Ø¨Ø§Ø´Ø¯
        $messages = str_split($message, 4000);
        foreach ($messages as $msg_part) {
            WSBot('sendmessage', [
                'chat_id' => $chat_id,
                'text' => $msg_part,
                'reply_to_message_id' => $message_id,
                'parse_mode' => 'Markdown'
            ]);
        }
    } else {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "ğŸ“­ Ù‡ÛŒÚ† Ù…ØªÙ†ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯!",
            'reply_to_message_id' => $message_id
        ]);
    }
}

// Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù…ØªÙˆÙ† Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¯Ø³ØªÙ‡
elseif ($text == "ğŸ“‚ Ù…ØªÙˆÙ† Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¯Ø³ØªÙ‡") {
    $categories = getTextCategories();
    $keyboard = ['inline_keyboard' => []];
    
    foreach ($categories as $category) {
        $count = mysqli_fetch_assoc(mysqli_query($MySQLi,
            "SELECT COUNT(*) as count FROM `bot_texts` WHERE `category` = '{$category}'"
        ));
        
        $keyboard['inline_keyboard'][] = [
            [
                'text' => "{$category} ({$count['count']})",
                'callback_data' => "text_category_{$category}"
            ]
        ];
    }
    
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "ğŸ“‚ Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø³ØªÙ‡ Ù…ØªÙˆÙ†\n\nÙ„Ø·ÙØ§Ù‹ Ø¯Ø³ØªÙ‡ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:",
        'reply_to_message_id' => $message_id,
        'reply_markup' => json_encode($keyboard)
    ]);
}

// ÙˆÛŒØ±Ø§ÛŒØ´ Ù…ØªÙ†
elseif ($text == "âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´ Ù…ØªÙ†") {
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´ Ù…ØªÙ† Ø±Ø¨Ø§Øª\n\nÙ„Ø·ÙØ§Ù‹ Ú©Ù„ÛŒØ¯ Ù…ØªÙ† Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯:",
        'reply_to_message_id' => $message_id,
        'reply_markup' => $back
    ]);
    $MySQLi->query("UPDATE `user` SET `step` = 'edit_text_key' WHERE `id` = '{$from_id}' LIMIT 1");
}// Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù…Ø±Ø§Ø­Ù„ ÙˆÛŒØ±Ø§ÛŒØ´ Ù…ØªÙ†
elseif ($user['step'] == 'edit_text_key') {
    $text_key = $text;
    $text_data = mysqli_fetch_assoc(mysqli_query($MySQLi,
        "SELECT * FROM `bot_texts` WHERE `text_key` = '{$text_key}'"
    ));
    
    if ($text_data) {
        $current_text = str_replace("\n", '\n', $text_data['text_value']); // Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¨Ù‡ØªØ±
        
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´ Ù…ØªÙ†: **{$text_key}**\n\nğŸ· Ø¯Ø³ØªÙ‡: {$text_data['category']}\nâ„¹ï¸ ØªÙˆØ¶ÛŒØ­Ø§Øª: {$text_data['description']}\n\nğŸ“ Ù…ØªÙ† ÙØ¹Ù„ÛŒ:\n`{$current_text}`\n\nğŸ’¡ Ø±Ø§Ù‡Ù†Ù…Ø§:\n- Ø§Ø² \\n Ø¨Ø±Ø§ÛŒ Ø®Ø· Ø¬Ø¯ÛŒØ¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯\n- Ø§Ø² {Ù…ØªØºÛŒØ±} Ø¨Ø±Ø§ÛŒ Ù…Ù‚Ø§Ø¯ÛŒØ± Ø¯Ø§ÛŒÙ†Ø§Ù…ÛŒÚ© Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯\n\nÙ„Ø·ÙØ§Ù‹ Ù…ØªÙ† Ø¬Ø¯ÛŒØ¯ Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯:",
            'reply_to_message_id' => $message_id,
            'parse_mode' => 'Markdown',
            'reply_markup' => $back
        ]);
        
        $MySQLi->query("UPDATE `user` SET `step` = 'edit_text_value', `code` = '{$text_key}' WHERE `id` = '{$from_id}' LIMIT 1");
    } else {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "âŒ Ú©Ù„ÛŒØ¯ Ù…ØªÙ† ÛŒØ§ÙØª Ù†Ø´Ø¯! Ù„Ø·ÙØ§Ù‹ Ù…Ø¬Ø¯Ø¯Ø§Ù‹å°è¯• Ú©Ù†ÛŒØ¯:",
            'reply_to_message_id' => $message_id
        ]);
    }
}

elseif ($user['step'] == 'edit_text_value') {
    $text_key = $user['code'];
    
    if (updateBotText($text_key, $text, $from_id)) {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => getBotText('text_updated') . "\n\nğŸ”‘ Ú©Ù„ÛŒØ¯: `{$text_key}`\nğŸ“ Ù…ØªÙ† Ø¬Ø¯ÛŒØ¯:\n" . getBotText($text_key),
            'reply_to_message_id' => $message_id,
            'parse_mode' => 'Markdown',
            'reply_markup' => $text_management
        ]);
    } else {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "âŒ Ø®Ø·Ø§ Ø¯Ø± ÙˆÛŒØ±Ø§ÛŒØ´ Ù…ØªÙ†!",
            'reply_to_message_id' => $message_id
        ]);
    }
    
    $MySQLi->query("UPDATE `user` SET `step` = 'text_management', `code` = '' WHERE `id` = '{$from_id}' LIMIT 1");
}// Ø§ÙØ²ÙˆØ¯Ù† Ù…ØªÙ† Ø¬Ø¯ÛŒØ¯
elseif ($text == "ğŸ†• Ø§ÙØ²ÙˆØ¯Ù† Ù…ØªÙ† Ø¬Ø¯ÛŒØ¯") {
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "ğŸ†• Ø§ÙØ²ÙˆØ¯Ù† Ù…ØªÙ† Ø¬Ø¯ÛŒØ¯\n\nÙ„Ø·ÙØ§Ù‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø±Ø§ Ø¨Ù‡ ÙØ±Ù…Øª Ø²ÛŒØ± Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯:\n\nÚ©Ù„ÛŒØ¯|Ù…ØªÙ†|ØªÙˆØ¶ÛŒØ­Ø§Øª|Ø¯Ø³ØªÙ‡\n\nğŸ“ Ù…Ø«Ø§Ù„:\nmy_custom_text|Ø³Ù„Ø§Ù… Ø§ÛŒÙ† Ù…ØªÙ† Ø¬Ø¯ÛŒØ¯ Ø§Ø³Øª|ØªÙˆØ¶ÛŒØ­Ø§Øª Ø¨Ø±Ø§ÛŒ Ù…ØªÙ† Ø¬Ø¯ÛŒØ¯|general",
        'reply_to_message_id' => $message_id,
        'reply_markup' => $back
    ]);
    $MySQLi->query("UPDATE `user` SET `step` = 'add_new_text' WHERE `id` = '{$from_id}' LIMIT 1");
}

elseif ($user['step'] == 'add_new_text') {
    $parts = explode('|', $text);
    if (count($parts) >= 3) {
        $key = trim($parts[0]);
        $value = trim($parts[1]);
        $description = trim($parts[2]);
        $category = count($parts) >= 4 ? trim($parts[3]) : 'general';
        
        // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ú©Ù„ÛŒØ¯
        $exists = mysqli_fetch_assoc(mysqli_query($MySQLi,
            "SELECT id FROM `bot_texts` WHERE `text_key` = '{$key}'"
        ));
        
        if (!$exists) {
            $value_escaped = mysqli_real_escape_string($MySQLi, $value);
            $desc_escaped = mysqli_real_escape_string($MySQLi, $description);
            
            mysqli_query($MySQLi,
                "INSERT INTO `bot_texts` (`text_key`, `text_value`, `description`, `category`, `updated_by`) 
                 VALUES ('{$key}', '{$value_escaped}', '{$desc_escaped}', '{$category}', '{$from_id}')"
            );
            
            WSBot('sendmessage', [
                'chat_id' => $chat_id,
                'text' => "âœ… Ù…ØªÙ† Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÙØ²ÙˆØ¯Ù‡ Ø´Ø¯!\n\nğŸ”‘ Ú©Ù„ÛŒØ¯: `{$key}`\nğŸ“ Ù…ØªÙ†: {$value}\nğŸ· Ø¯Ø³ØªÙ‡: {$category}",
                'reply_to_message_id' => $message_id,
                'parse_mode' => 'Markdown',
                'reply_markup' => $text_management
            ]);
        } else {
            WSBot('sendmessage', [
                'chat_id' => $chat_id,
                'text' => "âŒ Ø§ÛŒÙ† Ú©Ù„ÛŒØ¯ Ø§Ø² Ù‚Ø¨Ù„ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯!",
                'reply_to_message_id' => $message_id
            ]);
        }
    } else {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "âŒ ÙØ±Ù…Øª Ù†Ø§Ù…Ø¹ØªØ¨Ø±! Ù„Ø·ÙØ§Ù‹ Ø§Ø² ÙØ±Ù…Øª Ù…Ø´Ø®Øµ Ø´Ø¯Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.",
            'reply_to_message_id' => $message_id
        ]);
    }
    
    $MySQLi->query("UPDATE `user` SET `step` = 'text_management' WHERE `id` = '{$from_id}' LIMIT 1");
}// Export Ù…ØªÙˆÙ†
elseif ($text == "ğŸ“¤ Export Ù…ØªÙˆÙ†") {
    $all_texts = getAllBotTexts();
    $export_data = json_encode($all_texts, JSON_UNESCAPED_UNICODE | JSON_PRETTY_PRINT);
    
    // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± ÙØ§ÛŒÙ„ Ù…ÙˆÙ‚Øª
    $filename = "bot_texts_export_" . date('Y-m-d_H-i-s') . ".json";
    file_put_contents($filename, $export_data);
    
    // Ø§Ø±Ø³Ø§Ù„ ÙØ§ÛŒÙ„
    WSBot('senddocument', [
        'chat_id' => $chat_id,
        'document' => new CURLFile(realpath($filename)),
        'caption' => "ğŸ“¤ ÙØ§ÛŒÙ„ Export Ù…ØªÙˆÙ† Ø±Ø¨Ø§Øª\n\nØªØ¹Ø¯Ø§Ø¯ Ù…ØªÙˆÙ†: " . count($all_texts) . "\nØªØ§Ø±ÛŒØ®: " . date('Y-m-d H:i:s'),
        'reply_to_message_id' => $message_id
    ]);
    
    // Ø­Ø°Ù ÙØ§ÛŒÙ„ Ù…ÙˆÙ‚Øª Ù¾Ø³ Ø§Ø² Ø§Ø±Ø³Ø§Ù„
    unlink($filename);
}

// Import Ù…ØªÙˆÙ†
elseif ($text == "ğŸ“¥ Import Ù…ØªÙˆÙ†") {
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "ğŸ“¥ Import Ù…ØªÙˆÙ† Ø±Ø¨Ø§Øª\n\nÙ„Ø·ÙØ§Ù‹ ÙØ§ÛŒÙ„ JSON Ù…ØªÙˆÙ† Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯:",
        'reply_to_message_id' => $message_id,
        'reply_markup' => $back
    ]);
    $MySQLi->query("UPDATE `user` SET `step` = 'import_texts' WHERE `id` = '{$from_id}' LIMIT 1");
}// Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ù…ØªÙˆÙ† Ø¨Ù‡ Ø­Ø§Ù„Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶
elseif ($text == "ğŸ”„ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶") {
    $keyboard = json_encode(['inline_keyboard' => [
        [['text' => "âœ… Ø¨Ù„Ù‡ØŒ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ú©Ù†", 'callback_data' => "reset_texts_confirm"]],
        [['text' => "âŒ Ø®ÛŒØ±ØŒ Ù„ØºÙˆ Ú©Ù†", 'callback_data' => "reset_texts_cancel"]]
    ]]);
    
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "âš ï¸ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ù…ØªÙˆÙ† Ø¨Ù‡ Ø­Ø§Ù„Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶\n\nØ§ÛŒÙ† Ø¹Ù…Ù„ ØªÙ…Ø§Ù… ØªØºÛŒÛŒØ±Ø§Øª Ø´Ù…Ø§ Ø±Ø§ Ø­Ø°Ù Ú©Ø±Ø¯Ù‡ Ùˆ Ù…ØªÙˆÙ† Ø±Ø§ Ø¨Ù‡ Ø­Ø§Ù„Øª Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø§Ø²Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†Ø¯.\n\nØ¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ",
        'reply_to_message_id' => $message_id,
        'reply_markup' => $keyboard
    ]);
}// Ù¾Ø±Ø¯Ø§Ø²Ø´ callbackâ€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù…ØªÙˆÙ†
elseif (strpos($data, "text_category_") === 0) {
    $category = str_replace("text_category_", "", $data);
    $texts = getAllBotTexts($category);
    
    $message = "ğŸ“‚ Ù…ØªÙˆÙ† Ø¯Ø³ØªÙ‡: **{$category}**\n\n";
    
    foreach ($texts as $text_item) {
        $short_value = strlen($text_item['text_value']) > 30 ? 
            substr($text_item['text_value'], 0, 30) . '...' : $text_item['text_value'];
        
        $message .= "ğŸ”‘ `{$text_item['text_key']}`\n";
        $message .= "ğŸ“ {$short_value}\n";
        $message .= "â–â–â–â–â–\n";
    }
    
    WSBot('editmessagetext', [
        'chat_id' => $chatid,
        'message_id' => $messageid,
        'text' => $message,
        'parse_mode' => 'Markdown'
    ]);
}

elseif ($data == "reset_texts_confirm") {
    // Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ù…ØªÙˆÙ† Ù¾ÛŒØ´â€ŒÙØ±Ø¶
    $default_texts = [
        ['welcome_message', 'ğŸ‘¤ Ø³Ù„Ø§Ù… {first_name}\nğŸ¤– Ø¨Ù‡ Ø±Ø¨Ø§Øª Ù…Ø§ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!', 'general'],
        // ... Ø³Ø§ÛŒØ± Ù…ØªÙˆÙ† Ù¾ÛŒØ´â€ŒÙØ±Ø¶
    ];
    
    $reset_count = 0;
    foreach ($default_texts as $text) {
        $value_escaped = mysqli_real_escape_string($MySQLi, $text[1]);
        mysqli_query($MySQLi,
            "UPDATE `bot_texts` 
             SET `text_value` = '{$value_escaped}', `updated_by` = '{$fromid}'
             WHERE `text_key` = '{$text[0]}'"
        );
        $reset_count++;
    }
    
    WSBot('editmessagetext', [
        'chat_id' => $chatid,
        'message_id' => $messageid,
        'text' => "âœ… {$reset_count} Ù…ØªÙ† Ø¨Ù‡ Ø­Ø§Ù„Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø´Ø¯!",
        'reply_markup' => json_encode(['inline_keyboard' => []])
    ]);
}// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…Ø¯ÛŒØ±ÛŒØª Ù…ØªÙˆÙ† Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§Ø¯Ù…ÛŒÙ†
if (isAdmin($from_id)) {
    $menu = json_encode(['keyboard' => [
        [['text' => "ğŸ“‚ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø§Ù¾Ù„ÙˆØ¯"], ['text' =>"ğŸ« Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ"]],
        [['text' => "ğŸ“¦ Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡"], ['text' => "ğŸ“º Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø±ÛŒØ§Ù„â€ŒÙ‡Ø§"]],
        [['text' => "ğŸ–¼ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§ÙˆØ± ÙˆÛŒØ¯ÛŒÙˆÙ‡Ø§"], ['text' => "ğŸ“ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ØªÙˆÙ† Ø±Ø¨Ø§Øª"]],
        [['text' => "ğŸ›  Ù…Ø¯ÛŒØ±ÛŒØª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§"], ['text' => "ğŸ”¥ Ù¾Ø±Ø·Ø±ÙØ¯Ø§Ø±ØªØ±ÛŒÙ†â€ŒÙ‡Ø§"]],
        [['text' => "ğŸ” ØªÙ†Ø¸ÛŒÙ… Ù¾Ø³ÙˆØ±Ø¯"], ['text' => "ğŸ—‘ Ø­Ø°Ù ÙØ§ÛŒÙ„"]],
        [['text' => "ğŸ—‚ Ú©Ø¯ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ ÙØ§ÛŒÙ„"], ['text' => "ğŸ‘¤ Ù…Ø¯ÛŒØ±ÛŒØª"]]
        ], 'resize_keyboard' => true
    ]);
}// Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†ÛŒ ØªÙ…Ø§Ù… Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø«Ø§Ø¨Øª Ø¨Ø§:
getBotText('text_key', ['Ù…ØªØºÛŒØ±' => 'Ù…Ù‚Ø¯Ø§Ø±']);

// Ù…Ø«Ø§Ù„:
getBotText('welcome_message', ['first_name' => $first_name]);
getBotText('upload_success', ['file_code' => $code, 'file_size' => $size]);// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø¨Ø®Ø´ Ø§ÛŒØ¬Ø§Ø¯ Ø¬Ø¯Ø§ÙˆÙ„
if ($MySQLi->query("SELECT * FROM `channel_verification`") == false) {
    mysqli_query($MySQLi, "CREATE TABLE `channel_verification` (
        `id` int(11) NOT NULL AUTO_INCREMENT PRIMARY KEY,
        `channel_username` varchar(100) NOT NULL,
        `verifier_bot_token` varchar(100) NOT NULL,
        `is_active` tinyint(1) DEFAULT 1,
        `created_at` timestamp DEFAULT CURRENT_TIMESTAMP
    )");
    
    // Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶
    mysqli_query($MySQLi, "INSERT INTO `channel_verification` 
        (`channel_username`, `verifier_bot_token`) VALUES 
        ('cliiip_caption', 'TOKEN_BOT_VERIFIER_1'),
        ('LOVEMOVE11', 'TOKEN_BOT_VERIFIER_2')
    ");
}// ØªÙˆØ§Ø¨Ø¹ Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¶ÙˆÛŒØª Ø¨Ø§ Ø±Ø¨Ø§Øª ÙˆØ§Ø³Ø·
function checkMembershipWithVerifier($user_id, $channel_username, $verifier_bot_token = null) {
    if (!$verifier_bot_token) {
        // Ø§Ú¯Ø± ØªÙˆÚ©Ù† Ù…Ø´Ø®Øµ Ù†Ø´Ø¯Ù‡ØŒ Ø§Ø² Ø¬Ø¯ÙˆÙ„ Ø¨Ø®ÙˆØ§Ù†
        global $MySQLi;
        $channel_data = mysqli_fetch_assoc(mysqli_query($MySQLi,
            "SELECT * FROM `channel_verification` 
             WHERE `channel_username` = '{$channel_username}' AND `is_active` = 1"
        ));
        
        if (!$channel_data) return false;
        $verifier_bot_token = $channel_data['verifier_bot_token'];
    }
    
    // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø±Ø¨Ø§Øª ÙˆØ§Ø³Ø· Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¶ÙˆÛŒØª
    $url = "https://api.telegram.org/bot{$verifier_bot_token}/getChatMember";
    $data = [
        'chat_id' => '@' . ltrim($channel_username, '@'),
        'user_id' => $user_id
    ];
    
    $ch = curl_init();
    curl_setopt_array($ch, [
        CURLOPT_URL => $url,
        CURLOPT_RETURNTRANSFER => true,
        CURLOPT_POST => true,
        CURLOPT_POSTFIELDS => $data,
        CURLOPT_TIMEOUT => 5
    ]);
    
    $response = curl_exec($ch);
    curl_close($ch);
    
    $result = json_decode($response, true);
    
    if ($result && $result['ok']) {
        $status = $result['result']['status'];
        return in_array($status, ['member', 'administrator', 'creator']);
    }
    
    return false;
}

// ØªØ§Ø¨Ø¹ Ø¨Ù‡Ø¨ÙˆØ¯ÛŒØ§ÙØªÙ‡ Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¶ÙˆÛŒØª
function join1($user_id) {
    global $Config;
    return checkMembershipWithVerifier($user_id, $Config['channel']);
}

function join2($user_id) {
    // Ú©Ø§Ù†Ø§Ù„ Ø¯ÙˆÙ… - Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø² Ø¬Ø¯ÙˆÙ„ Ø¨Ø®ÙˆØ§Ù†ÛŒØ¯ ÛŒØ§ Ù…Ø³ØªÙ‚ÛŒÙ…Ø§Ù‹ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯
    return checkMembershipWithVerifier($user_id, 'LOVEMOVE11');
}

// ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¶ÙˆÛŒØª Ø¯Ø± Ú†Ù†Ø¯ Ú©Ø§Ù†Ø§Ù„
function checkAllChannelsMembership($user_id) {
    global $MySQLi;
    
    $channels = mysqli_query($MySQLi,
        "SELECT * FROM `channel_verification` WHERE `is_active` = 1"
    );
    
    $results = [];
    while ($channel = mysqli_fetch_assoc($channels)) {
        $is_member = checkMembershipWithVerifier($user_id, $channel['channel_username'], $channel['verifier_bot_token']);
        $results[$channel['channel_username']] = $is_member;
    }
    
    return $results;
}<?php
// verify_bot.php - Ø±Ø¨Ø§Øª ÙˆØ§Ø³Ø· Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¶ÙˆÛŒØª
$config = [
    'token' => 'TOKEN_BOT_VERIFIER_1', // ØªÙˆÚ©Ù† Ø±Ø¨Ø§Øª ÙˆØ§Ø³Ø·
    'admin_id' => 414816264 // Ø¢ÛŒØ¯ÛŒ Ø§Ø¯Ù…ÛŒÙ† Ø§ØµÙ„ÛŒ
];

// Ø¯Ø±ÛŒØ§ÙØª Ø¢Ù¾Ø¯ÛŒØª
$input = file_get_contents('php://input');
$update = json_decode($input, true);

if (isset($update['message'])) {
    $message = $update['message'];
    $chat_id = $message['chat']['id'];
    $text = $message['text'] ?? '';
    $from_id = $message['from']['id'];
    
    // ÙÙ‚Ø· Ù¾Ø§Ø³Ø® Ø¨Ù‡ Ø§Ø¯Ù…ÛŒÙ†
    if ($from_id != $config['admin_id']) {
        // Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¹Ø§Ø¯ÛŒØŒ ÙÙ‚Ø· Ø¯Ø³ØªÙˆØ± /start Ø±Ø§ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ú©Ù†
        if ($text == '/start') {
            sendMessage($chat_id, "ğŸ¤– Ø§ÛŒÙ† Ø±Ø¨Ø§Øª Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¶ÙˆÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.\n\nğŸ” Ø¯Ø³ØªØ±Ø³ÛŒ ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§ Ø§Ù…Ú©Ø§Ù†â€ŒÙ¾Ø°ÛŒØ± Ø§Ø³Øª.", $config['token']);
        }
        exit;
    }
    
    // Ø¯Ø³ØªÙˆØ±Ø§Øª Ø§Ø¯Ù…ÛŒÙ†
    if ($text == '/start') {
        sendMessage($chat_id, "ğŸ¤– Ø±Ø¨Ø§Øª ÙˆØ§Ø³Ø· Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¶ÙˆÛŒØª\n\nØ¯Ø³ØªÙˆØ±Ø§Øª Ù…ÙˆØ¬ÙˆØ¯:\n/check @channel @username - Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¶ÙˆÛŒØª Ú©Ø§Ø±Ø¨Ø±\n/listchannels - Ù„ÛŒØ³Øª Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§", $config['token']);
    }
    elseif (strpos($text, '/check') === 0) {
        $parts = explode(' ', $text);
        if (count($parts) >= 3) {
            $channel = str_replace('@', '', $parts[1]);
            $username = str_replace('@', '', $parts[2]);
            
            // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† user_id Ø§Ø² Ø·Ø±ÛŒÙ‚ username
            $user_id = getUserIdByUsername($username, $config['token']);
            
            if ($user_id) {
                $is_member = checkMembership($user_id, $channel, $config['token']);
                $status = $is_member ? 'âœ… Ø¹Ø¶Ùˆ Ø§Ø³Øª' : 'âŒ Ø¹Ø¶Ùˆ Ù†ÛŒØ³Øª';
                sendMessage($chat_id, "Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¶ÙˆÛŒØª:\n\nğŸ‘¤ Ú©Ø§Ø±Ø¨Ø±: @{$username}\nğŸ“¢ Ú©Ø§Ù†Ø§Ù„: @{$channel}\nğŸ” ÙˆØ¶Ø¹ÛŒØª: {$status}", $config['token']);
            } else {
                sendMessage($chat_id, "âŒ Ú©Ø§Ø±Ø¨Ø± @{$username} ÛŒØ§ÙØª Ù†Ø´Ø¯!", $config['token']);
            }
        } else {
            sendMessage($chat_id, "âŒ ÙØ±Ù…Øª ØµØ­ÛŒØ­: /check @channel @username", $config['token']);
        }
    }
    elseif ($text == '/listchannels') {
        // Ù„ÛŒØ³Øª Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ø±Ø¨Ø§Øª Ø¯Ø± Ø¢Ù†Ù‡Ø§ Ø§Ø¯Ù…ÛŒÙ† Ø§Ø³Øª
        sendMessage($chat_id, "ğŸ“‹ Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ ØªØ­Øª Ù†Ø¸Ø§Ø±Øª:\n\n@cliiip_caption\n@LOVEMOVE11\n\nØ¨Ø±Ø§ÛŒ Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ù†Ø§Ù„ Ø¬Ø¯ÛŒØ¯ØŒ Ø±Ø¨Ø§Øª Ø±Ø§ Ø¯Ø± Ú©Ø§Ù†Ø§Ù„ Ø§Ø¯Ù…ÛŒÙ† Ú©Ù†ÛŒØ¯ Ùˆ Ø³Ù¾Ø³ Ø§Ø² /addchannel Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù†Ù…Ø§ÛŒÛŒØ¯.", $config['token']);
    }
}

// ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ
function sendMessage($chat_id, $text, $token) {
    $url = "https://api.telegram.org/bot{$token}/sendMessage";
    $data = ['chat_id' => $chat_id, 'text' => $text];
    
    $ch = curl_init();
    curl_setopt_array($ch, [
        CURLOPT_URL => $url,
        CURLOPT_POST => true,
        CURLOPT_POSTFIELDS => $data,
        CURLOPT_RETURNTRANSFER => true
    ]);
    curl_exec($ch);
    curl_close($ch);
}

function checkMembership($user_id, $channel, $token) {
    $url = "https://api.telegram.org/bot{$token}/getChatMember";
    $data = [
        'chat_id' => '@' . $channel,
        'user_id' => $user_id
    ];
    
    $ch = curl_init();
    curl_setopt_array($ch, [
        CURLOPT_URL => $url,
        CURLOPT_POST => true,
        CURLOPT_POSTFIELDS => $data,
        CURLOPT_RETURNTRANSFER => true,
        CURLOPT_TIMEOUT => 5
    ]);
    
    $response = curl_exec($ch);
    curl_close($ch);
    
    $result = json_decode($response, true);
    
    if ($result && $result['ok']) {
        $status = $result['result']['status'];
        return in_array($status, ['member', 'administrator', 'creator']);
    }
    
    return false;
}

function getUserIdByUsername($username, $token) {
    // Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø§Ø±Ø¯
    // Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø² Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø®ÙˆØ¯ ÛŒØ§ Ø±ÙˆØ´â€ŒÙ‡Ø§ÛŒ Ø¯ÛŒÚ¯Ø± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
    return null; // Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø´ÙˆØ¯
}
?>// Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†ÛŒ ØªÙˆØ§Ø¨Ø¹ join Ù‚Ø¯ÛŒÙ…ÛŒ Ø¨Ø§ ØªÙˆØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯
function join1($user_id) {
    global $Config, $MySQLi;
    
    // Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø² Ø·Ø±ÛŒÙ‚ Ø±Ø¨Ø§Øª ÙˆØ§Ø³Ø·
    $channel_data = mysqli_fetch_assoc(mysqli_query($MySQLi,
        "SELECT * FROM `channel_verification` 
         WHERE `channel_username` = '{$Config['channel']}' AND `is_active` = 1"
    ));
    
    if ($channel_data) {
        return checkMembershipWithVerifier($user_id, $Config['channel'], $channel_data['verifier_bot_token']);
    }
    
    // Ø±ÙˆØ´ Ù‚Ø¯ÛŒÙ…ÛŒ (ÙØ¹Ù„Ø§Ù‹ Ù†Ú¯Ù‡ Ø¯Ø§Ø±ÛŒØ¯ Ø¨Ø±Ø§ÛŒ compatibilit)
    $truechannel = json_decode(file_get_contents("https://api.telegram.org/bot{$Config['api_token']}/getChatMember?chat_id=@{$Config['channel']}&user_id=".$user_id));
    $tch = $truechannel->result->status;
    return ($tch == 'creator' || $tch == 'administrator' || $tch == 'member');
}

function join2($user_id) {
    return checkMembershipWithVerifier($user_id, 'LOVEMOVE11');
}

// ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø±Ø³ÛŒ Ù‡Ù…Ù‡ Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§
function checkUserMembership($user_id) {
    $results = checkAllChannelsMembership($user_id);
    $all_joined = true;
    
    foreach ($results as $channel => $is_member) {
        if (!$is_member) {
            $all_joined = false;
            break;
        }
    }
    
    return $all_joined;
}// ØªØºÛŒÛŒØ± Ø¯Ø± Ø´Ø±Ø· Ø¬ÙˆÛŒÙ† Ø§Ø¬Ø¨Ø§Ø±ÛŒ
if(!checkUserMembership($from_id)){
    $channels_list = "";
    $channel_results = checkAllChannelsMembership($from_id);
    
    foreach ($channel_results as $channel => $is_member) {
        $status_emoji = $is_member ? "âœ…" : "âŒ";
        $channels_list .= "{$status_emoji} @{$channel}\n";
    }
    
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "âš ï¸ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø±Ø¨Ø§Øª Ø¨Ø§ÛŒØ¯ Ø¯Ø± Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø¹Ø¶Ùˆ Ø¨Ø§Ø´ÛŒØ¯:\n\n{$channels_list}\n\nÙ¾Ø³ Ø§Ø² Ø¹Ø¶ÙˆÛŒØªØŒ Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ Â«âœ… Ø¹Ø¶Ùˆ Ø´Ø¯Ù…Â» Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯.",
        'reply_to_message_id' => $message_id,
        'reply_markup' => $join
    ]);
    exit();
}// Ù…Ù†ÙˆÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ø¬ÙˆÛŒÙ† Ø§Ø¬Ø¨Ø§Ø±ÛŒ
$channel_management = json_encode(['keyboard' => [
    [['text' => "ğŸ“¢ Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ù†Ø§Ù„ Ø¬Ø¯ÛŒØ¯"], ['text' => "ğŸ—‘ Ø­Ø°Ù Ú©Ø§Ù†Ø§Ù„"]],
    [['text' => "ğŸ“‹ Ù„ÛŒØ³Øª Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§"], ['text' => "ğŸ”§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±Ø¨Ø§Øª ÙˆØ§Ø³Ø·"]],
    [['text' => "ğŸ”„ ØªØ³Øª Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¶ÙˆÛŒØª"], ['text' => "âš™ï¸ ÙØ¹Ø§Ù„/ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù†"]],
    [['text' => "ğŸ”™ Ø¨Ø±Ú¯Ø´Øª"]]
    ], 'resize_keyboard' => true
]);// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§Ø¯Ù…ÛŒÙ†
elseif ($text == "ğŸ“¢ Ù…Ø¯ÛŒØ±ÛŒØª Ø¬ÙˆÛŒÙ† Ø§Ø¬Ø¨Ø§Ø±ÛŒ") {
    $channels_count = mysqli_fetch_assoc(mysqli_query($MySQLi,
        "SELECT COUNT(*) as total FROM `channel_verification` WHERE `is_active` = 1"
    ));
    
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "ğŸ“¢ Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª Ø¬ÙˆÛŒÙ† Ø§Ø¬Ø¨Ø§Ø±ÛŒ\n\nğŸ· Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„: {$channels_count['total']}\nğŸ¤– Ø±ÙˆØ´: Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø±Ø¨Ø§Øª ÙˆØ§Ø³Ø·\n\nØ¨Ø§ Ø§ÛŒÙ† Ø³ÛŒØ³ØªÙ…ØŒ Ø±Ø¨Ø§Øª Ø¢Ù¾Ù„ÙˆØ¯Ø± Ù†ÛŒØ§Ø²ÛŒ Ø¨Ù‡ Ø§Ø¯Ù…ÛŒÙ† Ø´Ø¯Ù† Ø¯Ø± Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§ Ù†Ø¯Ø§Ø±Ø¯.",
        'reply_to_message_id' => $message_id,
        'reply_markup' => $channel_management
    ]);
    $MySQLi->query("UPDATE `user` SET `step` = 'channel_management' WHERE `id` = '{$from_id}' LIMIT 1");
}

// Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ù†Ø§Ù„ Ø¬Ø¯ÛŒØ¯
elseif ($text == "ğŸ“¢ Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ù†Ø§Ù„ Ø¬Ø¯ÛŒØ¯") {
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "ğŸ“¢ Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ù†Ø§Ù„ Ø¬Ø¯ÛŒØ¯\n\nÙ„Ø·ÙØ§Ù‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø±Ø§ Ø¨Ù‡ ÙØ±Ù…Øª Ø²ÛŒØ± Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯:\n\nÚ©Ø§Ù†Ø§Ù„|ØªÙˆÚ©Ù† Ø±Ø¨Ø§Øª ÙˆØ§Ø³Ø·\n\nğŸ“ Ù…Ø«Ø§Ù„:\nmy_channel|123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11",
        'reply_to_message_id' => $message_id,
        'reply_markup' => $back
    ]);
    $MySQLi->query("UPDATE `user` SET `step` = 'add_new_channel' WHERE `id` = '{$from_id}' LIMIT 1");
}

elseif ($user['step'] == 'add_new_channel') {
    $parts = explode('|', $text);
    if (count($parts) == 2) {
        $channel = trim($parts[0]);
        $token = trim($parts[1]);
        
        // Ø­Ø°Ù @ Ø§Ø² Ø§ÙˆÙ„ Ù†Ø§Ù… Ú©Ø§Ù†Ø§Ù„
        $channel = ltrim($channel, '@');
        
        // ØªØ³Øª ØªÙˆÚ©Ù† Ø±Ø¨Ø§Øª ÙˆØ§Ø³Ø·
        $test_url = "https://api.telegram.org/bot{$token}/getMe";
        $test_result = json_decode(file_get_contents($test_url), true);
        
        if ($test_result && $test_result['ok']) {
            mysqli_query($MySQLi,
                "INSERT INTO `channel_verification` (`channel_username`, `verifier_bot_token`) 
                 VALUES ('{$channel}', '{$token}')"
            );
            
            WSBot('sendmessage', [
                'chat_id' => $chat_id,
                'text' => "âœ… Ú©Ø§Ù†Ø§Ù„ @{$channel} Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÙØ²ÙˆØ¯Ù‡ Ø´Ø¯!\n\nØ±Ø¨Ø§Øª ÙˆØ§Ø³Ø·: @{$test_result['result']['username']}",
                'reply_to_message_id' => $message_id,
                'reply_markup' => $channel_management
            ]);
        } else {
            WSBot('sendmessage', [
                'chat_id' => $chat_id,
                'text' => "âŒ ØªÙˆÚ©Ù† Ø±Ø¨Ø§Øª ÙˆØ§Ø³Ø· Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª!",
                'reply_to_message_id' => $message_id
            ]);
        }
    } else {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "âŒ ÙØ±Ù…Øª Ù†Ø§Ù…Ø¹ØªØ¨Ø±! Ù„Ø·ÙØ§Ù‹ Ø§Ø² ÙØ±Ù…Øª Ù…Ø´Ø®Øµ Ø´Ø¯Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.",
            'reply_to_message_id' => $message_id
        ]);
    }
    
    $MySQLi->query("UPDATE `user` SET `step` = 'channel_management' WHERE `id` = '{$from_id}' LIMIT 1");
}// ØªØ³Øª Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¶ÙˆÛŒØª
elseif ($text == "ğŸ”„ ØªØ³Øª Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¶ÙˆÛŒØª") {
    WSBot('sendmessage', [
        'chat_id' => $chat_id,
        'text' => "ğŸ”„ ØªØ³Øª Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¶ÙˆÛŒØª\n\nÙ„Ø·ÙØ§Ù‹ Ø¢ÛŒØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø± Ø±Ø§ Ø¨Ø±Ø§ÛŒ ØªØ³Øª Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯:",
        'reply_to_message_id' => $message_id,
        'reply_markup' => $back
    ]);
    $MySQLi->query("UPDATE `user` SET `step` = 'test_membership_user' WHERE `id` = '{$from_id}' LIMIT 1");
}

elseif ($user['step'] == 'test_membership_user') {
    $test_user_id = $text;
    
    if (is_numeric($test_user_id)) {
        $results = checkAllChannelsMembership($test_user_id);
        
        $message = "ğŸ” Ù†ØªØ§ÛŒØ¬ ØªØ³Øª Ø¹Ø¶ÙˆÛŒØª Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± {$test_user_id}:\n\n";
        
        foreach ($results as $channel => $is_member) {
            $status = $is_member ? "âœ… Ø¹Ø¶Ùˆ Ø§Ø³Øª" : "âŒ Ø¹Ø¶Ùˆ Ù†ÛŒØ³Øª";
            $message .= "@{$channel}: {$status}\n";
        }
        
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => $message,
            'reply_to_message_id' => $message_id,
            'reply_markup' => $channel_management
        ]);
    } else {
        WSBot('sendmessage', [
            'chat_id' => $chat_id,
            'text' => "âŒ Ø¢ÛŒØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ÛŒØ¯ Ø¹Ø¯Ø¯ÛŒ Ø¨Ø§Ø´Ø¯!",
            'reply_to_message_id' => $message_id
        ]);
    }
    
    $MySQLi->query("UPDATE `user` SET `step` = 'channel_management' WHERE `id` = '{$from_id}' LIMIT 1");
}// ØªØ§Ø¨Ø¹ Ø§ÛŒØ¬Ø§Ø¯ Ú©ÛŒØ¨ÙˆØ±Ø¯ Ø¬ÙˆÛŒÙ† Ø§Ø¬Ø¨Ø§Ø±ÛŒ Ù¾ÙˆÛŒØ§
function getDynamicJoinKeyboard() {
    global $MySQLi;
    
    $channels = mysqli_query($MySQLi,
        "SELECT * FROM `channel_verification` WHERE `is_active` = 1"
    );
    
    $keyboard = ['inline_keyboard' => []];
    
    while ($channel = mysqli_fetch_assoc($channels)) {
        $keyboard['inline_keyboard'][] = [
            [
                'text' => "ğŸ“¢ Ø¹Ø¶ÙˆÛŒØª Ø¯Ø± @{$channel['channel_username']}",
                'url' => "https://t.me/" . $channel['channel_username']
            ]
        ];
    }
    
    $keyboard['inline_keyboard'][] = [
        [
            'text' => "âœ… Ø¹Ø¶Ùˆ Ø´Ø¯Ù…",
            'callback_data' => "join"
        ]
    ];
    
    return json_encode($keyboard);
}

// Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ú©ÛŒØ¨ÙˆØ±Ø¯ Ù¾ÙˆÛŒØ§ Ø¯Ø± Ù¾ÛŒØ§Ù… Ø¬ÙˆÛŒÙ† Ø§Ø¬Ø¨Ø§Ø±ÛŒ
$join = getDynamicJoinKeyboard();// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…Ø¯ÛŒØ±ÛŒØª Ø¬ÙˆÛŒÙ† Ø§Ø¬Ø¨Ø§Ø±ÛŒ Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§Ø¯Ù…ÛŒÙ†
if (isAdmin($from_id)) {
    $menu = json_encode(['keyboard' => [
        [['text' => "ğŸ“‚ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø§Ù¾Ù„ÙˆØ¯"], ['text' =>"ğŸ« Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ"]],
        [['text' => "ğŸ“¦ Ø¢Ù¾Ù„ÙˆØ¯ Ú¯Ø±ÙˆÙ‡ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡"], ['text' => "ğŸ“º Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø±ÛŒØ§Ù„â€ŒÙ‡Ø§"]],
        [['text' => "ğŸ–¼ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§ÙˆØ± ÙˆÛŒØ¯ÛŒÙˆÙ‡Ø§"], ['text' => "ğŸ“ Ù…Ø¯ÛŒØ±ÛŒØª Ù…ØªÙˆÙ† Ø±Ø¨Ø§Øª"]],
        [['text' => "ğŸ“¢ Ù…Ø¯ÛŒØ±ÛŒØª Ø¬ÙˆÛŒÙ† Ø§Ø¬Ø¨Ø§Ø±ÛŒ"], ['text' => "ğŸ›  Ù…Ø¯ÛŒØ±ÛŒØª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§"]],
        [['text' => "ğŸ”¥ Ù¾Ø±Ø·Ø±ÙØ¯Ø§Ø±ØªØ±ÛŒÙ†â€ŒÙ‡Ø§"], ['text' => "ğŸ” ØªÙ†Ø¸ÛŒÙ… Ù¾Ø³ÙˆØ±Ø¯"]],
        [['text' => "ğŸ—‘ Ø­Ø°Ù ÙØ§ÛŒÙ„"], ['text' => "ğŸ—‚ Ú©Ø¯ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ ÙØ§ÛŒÙ„"]],
        [['text' => "ğŸ‘¤ Ù…Ø¯ÛŒØ±ÛŒØª"]]
        ], 'resize_keyboard' => true
    ]);
}